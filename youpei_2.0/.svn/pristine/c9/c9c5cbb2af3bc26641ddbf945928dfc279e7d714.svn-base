<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>投稿</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/pageloader.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/userContribution.css"/>
    <!--<script type="text/javascript">
        if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
    </script>-->
    <!--  <script>
         var _hmt = _hmt || [];
         (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?548e13b07cb36e38bfd73870368a0253";
           var s = document.getElementsByTagName("script")[0];
           s.parentNode.insertBefore(hm, s);
         })();
     </script> -->
</head>
<body class="kap-loading ty-view-all">
<include file="Common:common"/>
<header class="header">
    <a href="javascript:history.back()" class="back">
        <img src="../../../../Public/images/back.png" alt="">
    </a>
    <h3>投稿</h3>
    <a href="../Index/index.html" class="home" data-icon="Ņ"></a>
</header>
<article class="middle"> 
     <form action="/index.php/Vote/contribution" enctype="multipart/form-data" method="post">
        <section class="works">
            <span>作品标题：</span>
            <input type="text" value="我和小星星" name="title">
            <img src="../../../../Public/images/works.png" alt="">
        </section>
         <section class="works">
            <span>作者尊称：</span>
            <input type="text" value="优小培" name="userName">
            <img src="../../../../Public/images/works.png" alt="">
        </section>
         <section class="works">
            <span>联系电话：</span>
            <input type="tel" value="15019331757" maxlength="11" onchange="testTel(this.value)" name="mobile">
            <img src="../../../../Public/images/works.png" alt="">
        </section>
        <section class="img">
             <img src="../../../../Public/images/works1.jpg" alt="" > 
            <!-- <div class="video"><video src="../../../../Public/music/b.mp4" id="video"></video></div> -->
        </section>
        <section class="upload">
            <a href="###" onclick="firstFile()">点击上传</a>
            <input type="submit" value="提交"/ class="submit">
            <input type="file" name="uploadPicture" id="file" title="上传照片" onchange="getPhoto(this)" style="display: none;" />  
        </section>
    </form>    
    <section class="explain">
        <h3>投稿说明：</h3>
        <p>1.只可上传1幅图片或1个视频。</p>
        <p>2.上传视频建议采用微信短视频后保存上传，视频限制最大12MB。</p>
        <p>3.投稿后请到“个人中心-我的活动”处查看活动进度。</p>
    </section>
</article>
<script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/jweixin-1.0.0.js"></script>
<script>
     function firstFile() { 
            document.getElementById("file").click(); 
        } 

    //    获取url参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    var id = getQueryString('id');
    $.ajax({
        type: "get",
        url: "/index.php/Vote/ajaxUserContribution",
        aysnc: true,
        dataType: "json",
        data:{
            id:id,
        },
        success:function(data){
            console.log(data);
            var title=data.data.share_title;
            var f_title=data.data.share_desc;
            var shareUrl=data.data.share_url;
            var shareImg=data.data.share_img;
            // 调用微信的分享接口
            setTimeout(function(){
                wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: "{$signPackage['appId']}", // 必填，公众号的唯一标识
                    timestamp: "{$signPackage['timestamp']}", // 必填，生成签名的时间戳
                    nonceStr: "{$signPackage['nonceStr']}", // 必填，生成签名的随机串
                    signature: "{$signPackage['signature']}",// 必填，签名，见附录1
                    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideOptionMenu', 'showOptionMenu', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'closeWindow', 'chooseImage', 'uploadImage', 'getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                });
                wx.ready(function () {
                    wx.onMenuShareAppMessage({
                        title: title,
                        desc: f_title,
                        link: shareUrl,
                        imgUrl: shareImg,
                        success: function () {
                            share_record();
                        },
                        cancel: function () {
                            alert('已取消');
                        }
                    });
                    wx.onMenuShareTimeline({
                        title: title,
                        link: shareUrl,
                        imgUrl: shareImg,
                        success: function () {
                            share_record();// 用户确认分享后执行的回调函数
                        },
                        cancel: function () {
                            alert('已取消');// 用户取消分享后执行的回调函数
                        }
                    });

                    function share_record() {
                        var data = new Array();
                        data[id] = getQueryString(id);
                        data[share_user_id] = getQueryString(share_user_id);
                     var url = "{:U('Vote/userContributionRecord')}";
                     $.post(url, data, function (result) {
                     alert(result.message);
                     }, 'json');
                     }
                });
            },1000)
        }
    });

</script>
<script type="text/javascript">  
    // var imgurl = "";  
    // function getPhoto(node) {  
    //     var imgURL = "";  
    //     try{  
    //         var file = null;  
    //         if(node.files && node.files[0] ){  
    //             file = node.files[0];  
    //         }else if(node.files && node.files.item(0)) {  
    //             file = node.files.item(0);  
    //         }  
    //         //Firefox 因安全性问题已无法直接通过input[file].value 获取完整的文件路径  
    //         try{  
    //             imgURL =  file.getAsDataURL();  
    //         }catch(e){  
    //             imgRUL = window.URL.createObjectURL(file);  
    //         }  
    //     }catch(e){  
    //         if (node.files && node.files[0]) {  
    //             var reader = new FileReader();  
    //             reader.onload = function (e) {  
    //                 imgURL = e.target.result;  
    //             };  
    //             reader.readAsDataURL(node.files[0]);  
    //         }  
    //     }  
    //     creatImg(imgRUL);  
    //     return imgURL;  
    // }  
  
    // function creatImg(imgRUL){  
    //     var textHtml = "<img src='"+imgRUL+"' />";  
    //     $(".img").html(textHtml);  
    // } 
     function getPhoto(file){
            if (file.files && file.files[0]){
                var reader = new FileReader();
                reader.onload = function(evt){
                    var url=evt.target.result;
//                  $(".img img").attr("src",evt.target.result)
                   if(url.indexOf("image")>-1){
                        $(".img").html('<img src="'+evt.target.result+'">')
                    }
//                  if(url.indexOf("video")>-1){
//                      jQuery(".img").html('<div class="video"><video src="'+evt.target.result+'" id="video" autoplay></video></div>')
//                       $(".video").click(function(){
//                          $("#video")[0].play();
//                          // $(".video img").hide();
//                      })
//                       // if($("#video")[0].paused){
//                       //    $(".video img").show();
//                       // }
//                  }
                    // console.log(evt.target.result)
                  }
                reader.readAsDataURL(file.files[0]);
            }
            else{
//          	$(".img img").attr("src",evt.target.result)
                    if(url.indexOf("image")>-1){
                        jQuery(".img").html('<img src="'+evt.target.result+'">')
                    }
//                  if(url.indexOf("video")>-1){
//                      $(".img").html('<div class="video"><video src="'+evt.target.result+'" id="video"></video></div>')
//                       $("#video").click(function(){
//                          $("#video")[0].play();
//                          $(".video img").hide();
//                      })
//                       //  if($("#video")[0].paused){
//                       //    $(".video img").show();
//                       // }
//                  }
            }
        }
var testTel=function(value){
	var reg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;
	if(!reg.test(value)){
		alert("你输入的手机号码不正确，请重新输入。")
		return false;
	}
}

</script>  
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->
<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>投票详情</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/pageloader.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/voteDetail.css"/>
    <script type="text/javascript">
        if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
    </script>
    <!--  <script>
         var _hmt = _hmt || [];
         (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?548e13b07cb36e38bfd73870368a0253";
           var s = document.getElementsByTagName("script")[0];
           s.parentNode.insertBefore(hm, s);
         })();
     </script> -->
</head>
<body class="kap-loading ty-view-all">
<include file="Common:common"/>
<header class="header">
    <a href="javascript:history.back()" class="back">
        <img src="../../../../Public/images/back.png" alt="">
    </a>
    <h3>投票详情</h3>
    <a href="../Index/index.html" class="home" data-icon="Ņ"></a>
</header>
<article class="middle">
    <section class="works">
        <div class="type">
            <!-- <img src="../../../../Public/images/voteImage1.jpg" alt="" class="workImg"> -->
        </div>
        <div class="introduce">
           <p class="call"><span>作品名称：<strong class="workName"></strong></span></p>
           <p class="name"><span>作者：<strong class="userName"></strong></span></p>
           <p class="get"><span>已获<a href="###" class="nowNum">0</a>票</span></p>
        </div>
        <div class="vote" style="display: none;">
            <div>
               <span>剩余<a href="###" class="surplus">0</a>票</span>
               <span>投TA</span>
               <p>
                    <a href="###" class="reduce" onclick="reduce(this)">-</a>
                    <input type="text" value="1" class="number" onchange="numChange(this)">
                    <a href="###" class="add" onclick="add(this)">+</a>
                </p>
               <span>票</span>
               <a href="javascript:void(0)" class="confirm">确定</a>
            </div>       
        </div>
    </section>
   
    <section class="others">
        <div class="more" onclick="moreWorks()">
            <img src="../../../../Public/images/otherWorks.png" alt="">
            <span>其他作品</span>
            <a href="javascript:void(0)">更多 ></a>
        </div>
        <div class="img">
            <ul class="imgList">
                <!-- <li onclick="moreWorks()">
                    <a href="javascript:void(0)"><img src="../../../../Public/images/voteImage1.jpg" alt=""></a>
                </li>
                <li onclick="moreWorks()">
                    <a href="javascript:void(0)"><img src="../../../../Public/images/voteImage1.jpg" alt=""></a>
                </li> -->
            </ul>
        </div>
    </section>
    <section class="join" style="display: none;">
        <a href="javascript:void(0)" onclick="join()">我也要参加</a>
    </section>
    <section class="text">
<!--         <p><span>· </span>活动介绍：我和家人绘画比赛，欢迎广大小画家参加。</p>
        <p><span>· </span> 活动奖品：书包、笔记本电脑、IphoneX。</p> -->
    </section>
</article>
<footer class="footer">
    <ul class="icon">
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/voteList.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon1.png"/>
                <span>作品库</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userVote.html">
                <img src="__PUBLIC__/images/voteIcon2.png"/>
                <span>我的投票</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userWorks.html">
                <img src="__PUBLIC__/images/voteIcon3.png"/>
                <span>我的作品</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userBillboard.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon4.png"/>
                <span>榜单</span>
            </a>
        </li>
    </ul>
</footer>
<script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/voteDetail.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/jweixin-1.0.0.js"></script>
<script>
// //    获取url参数
// function GetRequest() {
//     var url = location.search; //获取url中"?"符后的字串
//     var theRequest = new Object();
//     if (url.indexOf("?") != -1) {
//         var str = url.substr(1);
//         strs = str.split("&");
//         for (var i = 0; i < strs.length; i++) {
//             theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
//         }
//     }
//     return theRequest;
// }
// var vote_id=GetRequest().vote_id;
// var id=GetRequest().id;
// function moreWorks(){
//     window.location.href="/index.php/Vote/voteList.html?id="+id+"&vote_id="+vote_id;
// }
// 微信端分享
    $.ajax({
        type: "get",
        url: "/index.php/Vote/voteContribution",
        aysnc: true,
        dataType: "json",
        data:{
            id:id,
        },
        success:function(data){
            // console.log(data);
            var title=data.data.share_title;
            var f_title=data.data.share_desc;
            var shareUrl=data.data.share_url;
            var shareImg=data.data.share_img;
            // 调用微信的分享接口
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: "{$signPackage['appId']}", // 必填，公众号的唯一标识
                timestamp: "{$signPackage['timestamp']}", // 必填，生成签名的时间戳
                nonceStr: "{$signPackage['nonceStr']}", // 必填，生成签名的随机串
                signature: "{$signPackage['signature']}",// 必填，签名，见附录1
                jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideOptionMenu', 'showOptionMenu', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'closeWindow', 'chooseImage', 'uploadImage', 'getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            });
            wx.ready(function () {
                wx.onMenuShareAppMessage({
                    title: title,
                    desc: f_title,
                    link: shareUrl,
                    imgUrl: shareImg,
                    success: function () {
                        share_record();
                    },
                    cancel: function () {
                        alert('已取消');
                    }
                });
                wx.onMenuShareTimeline({
                    title: title,
                    link: shareUrl,
                    imgUrl: shareImg,
                    success: function () {
                        share_record();// 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        alert('已取消');// 用户取消分享后执行的回调函数
                    }
                });

                function share_record() {
                    var data = new Array();
                    data[id] = getQueryString(id);
                    data[share_user_id] = getQueryString(share_user_id);
                 var url = "/index.php/Vote/userContributionRecord";
                 $.post(url, data, function (result) {
                 alert(result.message);
                 }, 'json');
                 }
            });
        }
    });
//     //商品数量加操作
// function add(obj){
//     var prd_num = obj.previousElementSibling;   
//     var num = prd_num.value;
    
//     if(isNaN(num)){
//         num = 1;
//     }else{
//         num = parseInt(num);
//     }
    
//     num+=1;
//     prd_num.value = num;
// }
// //商品数量改变的操作
// function numChange(obj){
//     var num = obj.value;
//     if(isNaN(num)){
//         num = 1;
//     }else if(num==""){
//         num=1;
//     }else if(num<1){
//         num=1;
//     }
//     num = parseInt(num);
//     obj.value = num;
// }
// //商品数量减操作
// function reduce(obj){
//     var prd_num = obj.nextElementSibling;
//     var num = prd_num.value;
//     if(isNaN(num)){
//         num = 1;
//     }else{
//         num = parseInt(num);
//     }
    
//     num-=1;
//     if(num<1){
//         num=1
//     }
//     prd_num.value = num;
// }		
//     $.ajax({
//         type:"get",
//         url:"/index.php/Vote/ajaxVoteDetail",
//         async: true,
//         dataType:"json",
//         data:{
//             id:id
//         },
//         success:function(data){
//             if(data.status==0){
//                 setTimeout(function(){
//                     alert(data.message)
//                     history.back()
//                 },1000)  
//                 return
//             }
//             var vote_count=data.data.work.vote_count;
//             var userCount=data.data.userCount;
//             var username=data.data.work.username;
//             var title=data.data.work.title;
//             var path=data.data.work.path;
//             var desc=data.data.desc;
//             var upload_type=data.data.upload_type;
//             var more=data.data.more;
//             var moreLength=data.data.more.length;
//             $(".nowNum").html(vote_count);
//             $(".workName").html(title);
//             $(".userName").html(username);
//             $(".surplus").html(userCount)
//             if(data.status==1){
//                 if(data.data.voteStatus==1){
//                       $(".introduce").css("border","none")
//                       $(".vote").hide()
//                 }
//                 if(data.data.voteStatus==2){
//                     $(".vote").show();
//                 }
//                 $(".text").html(desc)
//                 if(data.data.isContribute==1){
//                     $(".join").hide()
//                 }
//                 if(data.data.isContribute==2){
//                     if(data.data.isMe==1){
//                         $(".join").show()
//                     }
                    
//                 }
//                 if(upload_type==1){
//                     $(".type").html('<img src="'+path+'" alt=""/>')
//                     for(var i=0; i<moreLength; i++){
//                         $(".imgList").append(
//                             '<li onclick="toVote('+more[i].id+','+more[i].vote_id+')">'+
//                                 '<a href="javascript:void(0)"><img src="'+more[i].path+'" alt=""></a>'+
//                             '</li>'
//                         )
//                     }
//                 }
//                 if(upload_type==2){
//                     $(".type").html('<video src="'+path+'" alt="" autoplay></video>')
//                     for(var j=0; j<moreLength; j++){
//                          $(".imgList").append(
//                             '<li onclick="toVote('+more[j].id+','+more[j].vote_id+')">'+
//                                 '<a href="javascript:void(0)"><video src="'+more[j].path+'" alt="" autoplay></video></a>'+
//                             '</li>'
//                         )
//                      }
//                 }
//             }
            
//         }
//     })
// $(function(){
//     $(".confirm").click(function(){
//         var value=$(".number").val();
//         $.ajax({
//             type:"post",
//             url:"/index.php/Vote/toVote",
//             async:true,
//             dataType:"json",
//             data:{
//                 count:value,
//                 id:id
//             },
//             success:function(data){
//                 if(data.status==0){
//                     alert(data.message)
//                 }
//                 if(data.status==1){
//                     alert(data.message)
//                     document.location.reload();

//                 }
//             }
//         })
//     })
// })
// function join(){
//     window.location.href="/index.php/Vote/contribution.html?vote_id="+vote_id;
// }
//  function toVote(id,vote_id){
//         window.location.href="/index.php/Vote/voteDetail.html?id="+id+"&vote_id="+vote_id;
//     }
</script>
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->




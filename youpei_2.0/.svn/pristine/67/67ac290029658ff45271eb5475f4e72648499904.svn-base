<include file="Common:header"/>
<link rel="stylesheet" href="__PUBLIC__/css/home/toEdit.css">
<div class="container interest-container">
<div class="kap-top ty-menu-top">
    <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
        <span class="title">{$title}<span class="num"></span></span>
        <a href="javascript:void(0);" onclick="history.go(-1);" class="btn left btn-user" title="返回" data-icon="ɒ"></a>
 		<a href="{:U('Index/index',array('current'=>'1'))}" class="btn right btn-user" title="返回首页"
           data-icon="Ņ"></a>
    </div>
</div>
   <section class="scroll">
     <div class="main">
	     <ul>
	     <!-- <dt><span><if condition="$user['addressid'] == 0">完善资料兑奖<else/>确认资料兑奖</if></span></dt> -->
	     <input type="hidden" name="id" id="id" value="{$user['userid']}">
	      <li><span>姓名：</span><input type="text" name="username" id="username" value="{$user['username']}"></li>
	      <li><span>联系电话：</span><input type="num" name="mobile" id="mobile" value="{$user['mobile']}"></li>
	      <li><span>地区：</span>
		     <select id='areaId1' onchange='javascript:getAreaList("areaId2",this.value,0)'>
		       <option value=''>请选择</option>
		       <volist name="areaList" id="vo">
		       <option value='{$vo['areaid']}' <if condition="$user['areaid1'] == $vo['areaid'] ">selected</if>>{$vo['areaname']}</option>
		       </volist>
		     </select>	             
		     <select id='areaId2' onchange='javascript:getAreaList("areaId3",this.value,1);'>
		       <option value=''>请选择</option>
		     </select>

		     <select id='areaId3' onchange="">
		       <option value=''>请选择</option>
		     </select>
	       </li>
	       <li><span>邮寄地址：</span><input type="text" name="address" id="address" value="{$user['address']}"></li>
	     </ul>
      <div class="twobtn">
		   <div class="footerbtn">
			<a class="submit left3" onclick="submituserinfo()">确认</a>
				</div>
			<div class="clr"></div>
			</div>
     </div>
   </section>
</div>
<include file="Common:footer"/>
<script src="__PUBLIC__/js/formValidator/formValidator-4.1.3.js"></script>
<script>
   $(function () {
	   $.formValidator.initConfig({
		   theme:'Default',mode:'AutoTip',formID:"myform",debug:true,submitOnce:true,onSuccess:function(){
			   editAddress();
			   return false;
			},onError:function(msg){
		}});
	   <if condition="$user['addressid'] != 0">
	   getAreaList('areaId2','{$user['areaid1']}',0,'{$user['areaid2']}');
	   getAreaList("areaId3",'{$user.areaid2}',1,'{$user.areaid3}');
	  
	   </if>
   });
  
   function getAreaList(objId,parentId,t,id){
	   var params = {};
	   params.parentId = parentId;
	   $('#'+objId).empty();
	   if(t<1){
		   $('#areaId3').empty();
		   $('#areaId3').html('<option value="">请选择</option>');
	   }
	   var html = [];
	   $.post("{:U('queryByAreasList')}",params,function(data,textStatus){
		    html.push('<option value="">请选择</option>');
			if(data.status=='1' && data.list.length>0){
				var opts = null;
				for(var i=0;i<data.list.length;i++){
					opts = data.list[i];
					html.push('<option value="'+opts.areaid+'" '+((id==opts.areaid)?'selected':'')+'>'+opts.areaname+'</option>');
				}
			}
			$('#'+objId).html(html.join(''));
	   });
   }
   $(function(){
       <PHP>if($areaid1!=0){</PHP>
	   getAreaList("areaid2",'{$areaid1}',0,'{$areaid2}');
	   <PHP>}</PHP>  
	   <PHP>if($areaid2 != 0){</PHP>
	   getAreaList("areaid3",'{$areaid2}',1,'{$areaid3}');
	   <PHP>}</PHP>
	   $('#orderStatus').val({$orderStatus});
   });
</script>
<script src="__PUBLIC__/js/home/toEdit.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
function submituserinfo(){
	var params = {};
	params.id = $("#id").val();
	params.username = $("#username").val();
	params.mobile = $("#mobile").val();
	params.areaId1 = $('#areaId1').val();
	params.areaId2 = $('#areaId2').val();
	params.areaId3 = $('#areaId3').val();
	params.address = $("#address").val();

    if (params.username=="") {
    	alert("姓名不能空");
			return;	
    }
    
    if(params.mobile==""){
			alert("请输入手机号码或固定电话");
			return;		
		}

		if($('#mobile').length>0){
					if(!/^1(3|4|5|7|8){1}\d{9}$/.test(params.mobile)){
						alert("手机号码格式不正确，请重新填写");
						return;
					}
				}

	if(params.areaId1<1){
	   		alert("请选择省");
			return;		
		}
		if(params.areaId2<1){
			alert("请选择市");
			return;		
		}
		if(params.areaId3<1){
			alert("请选择区县");
			return;		
		}
	
		if(params.address==""){
			alert("请输入详细地址");
			return;		
		}
	$.post("{:U('Lottery/confirmsave')}",params,function(res){
        if (res.status==1) {
        	alert(res.msg);
        	location.href = "{:U('Lottery/userAddress')}";
        }
	})
}
</script>

</body>
</html>
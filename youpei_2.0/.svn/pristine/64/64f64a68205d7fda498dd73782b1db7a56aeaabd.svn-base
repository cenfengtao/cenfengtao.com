<!DOCTYPE html>
<html>
<head>
    <title>{$header_title|default="优培圈"}</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Mobile Devices Support @begin -->
    <meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="pragma">
    <meta content="0" http-equiv="expires">
    <meta content="telephone=no, address=no" name="format-detection">
    <meta name="apple-mobile-web-app-capable" content="yes"/> <!-- apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/dialog.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/main_1-0.css">
    <script type="text/javascript" src="__PUBLIC__/js/home/dialog_1-0.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/jweixin-1.0.0.js"></script>
    <link rel="stylesheet" href="__PUBLIC__/Home/css/message.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/comment.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/common.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/kap.css">
    <!--移动端兼容适配 end -->
</head>
<style>
    .text{
        display: block;
        text-indent: 6.5rem;
        line-height: 2rem;
        word-wrap: break-word;
        text-align: left;
    }
    .image{
        position: absolute;
        font-size: 0.8rem;
    }
    .image span{
        line-height:2rem;
    }
    .replys{
        margin-left:3.1rem;
    }
    .image img{
        width: 1.8rem;
        height:1.8rem;
        vertical-align: middle;
    }
    .btn-comment{
        height: 2rem;
        line-height: 1.5rem;
        width: 37%;
        padding: 0 0.625rem;
        font-size: .875rem;
        color: #71ccb0;
        background-color: #fff;
        float: right;
        margin: -3.1rem 0rem 0.5rem 0rem;
        border-radius: .25rem;
        border: 1px solid #71ccb0;
    }
    .kap-mask{
        top:0;
    }
    .isCollect:before {
        color: #f56b85;
    }

    .isCollect {
        display: inline-block;
        width: 25%;
        margin-left: 5%;
        position: relative;
        color: #f56b85;
    }

    .follow {
        display: inline-block;
        width: 25%;
        margin-left: 5%;
        position: relative;
    }
    .article_banner {
        background: url("__PUBLIC__/images/article_banner.png");
        display: block;
        width:100%;
        height:2.5rem;
        background-size: 100%;
    }
</style>
<link href="__PUBLIC__/css/home/style4.css" rel="stylesheet" type="text/css"/>
<body>
<div class="container">
    <div class="header" style="z-index: 11;" data-action="{$Think.ACTION_NAME}">
        <a class="block" href="javascript:void(0)" id="header_go_back"
           data-home-url="{:U('Index/index')}" style="display: none;"></a>
        <h1 style="font-size:20px;">优培圈</h1>
        <a class="block" href="{:U('Index/index')}" id="header_go_home" style="display: none;"></a>
        <notempty name="interests_url">
            <a class="icon_menu block" href="{$interests_url}"></a>
        </notempty>
    </div>
    <div class="banner" style="z-index: 11;">
        <a href="/index.php/index/index.html" class="article_banner"  style="z-index: 11;"></a>
    </div>
    <div id="test" class="banner" style="position: fixed;top:0;width:100%;z-index: 10;"><a href="/index.php/index/index.html" class="article_banner" style="width:100%"></a></div>
    <div class="main plpr0" style="padding: 10px;">
        <section class="scroll">
            <input type="hidden" name="article_id" id="article_id" value="{$article.id}">
            <h1 style="font-size:20px;">{$article['title']|default="优培圈"}</h1>
            <time>{$article.create_time|date="Y-m-d",###} <span>{$article['author']|default=""}</span></time>
            <div class="content">
                <div class="info" style="font-size:14px;" id="content-wrapper">
                    {$article.content}
                </div>
                <if condition="$article['show_liability'] eq 1">
                    <div id="test1">《<font color="#F00"><u>请点击了解免责声明</u></font>》</div>
                </if>
            </div>
            <div class="see-count">阅读&nbsp;&nbsp;{$article.read_count|default="0"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a
                    href="javascript:finger({$article.id},'2')">
                <if condition="$article['isFinger'] gt 0">
                    <img src="__PUBLIC__/images/finger-1.jpg" id="z-{$article['id']}"/>
                    <else/>
                    <img src="__PUBLIC__/images/finger-2.jpg" id="z-{$article['id']}"/>
                </if>
                &nbsp;<span id="finger-{$article.id}">{$article.fingerCount}</span></a>
                <notempty name="isCollect">
                    <a class="isCollect" data-icon="ą" href="javascript:collect({$article.id},'5')">收藏</a>
                    <else/>
                    <a class="follow" data-icon="ą" href="javascript:collect({$article.id},'5')">收藏</a>
                </notempty>
            </div>
        </section>
        <div id="msgBox">
            <button type="button" class="btn-comment" data-icon="Ę">说点什么..</button>
            <div class="lists">
                <h3><span>最新评论</span></h3>
                <ul id="lists-msg">
                    <empty name="comments">
                        <li id="empty">还没有人发表</li>
                        <else/>
                        <volist name="comments" id="val">
                            <notempty name="val['user_id']">
                                <li class="items" >
                                    <div class="first" onclick='getFather("{$val['id']}")'>
                                        <div class="userPic"><img src="{$val['headimgurl']}"/></div>
                                        <div class="content" style="text-align: left;">
                                            <div class="userName"><a href="javascript:;">{$val['username']}</a>:</div>
                                            <div class="msgInfo">{$val['content']}</div>
                                            <div class="times">
                                                <span>{$val['create_time']|date="m-d H:i",###}</span>
                                            </div>
                                        </div>
                                        <div class="finger">
                                            <a href="javascript:finger('{$val.id}','1')">
                                                <if condition="$val['is_finger'] gt 0">
                                                    <img src="__PUBLIC__/images/finger-1.jpg" id="z-{$val.id}"/>
                                                    <else/>
                                                    <img src="__PUBLIC__/images/finger-2.jpg" id="z-{$val.id}"/>
                                                </if>
                                                &nbsp;<span id="finger-{$val.id}">{$val.finger_count}</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div style="clear: both;"></div>

                                    <div class="replys">
                                        <volist id="va" name="val['child']">
                                            <div class="reply" onclick='getFatherId({$va['id']},{$val['id']})'>

                                            <div class="image"><img src="{$va['headImg']}" alt=""><span>回复：</span><img src="{$va['headImgs']}" alt=""></div>

                                            <span class="text">{$va['content']}</span>
                                            </div>
                                        </volist>
                                    </div>

                                </li>

                            </notempty>
                        </volist>
                    </empty>
                </ul>

            </div>

        </div>
    </div>
    <div class="footer_coopyright">
        本活动最终解释权归优培圈所有
    </div>
</div>
<div data-kap="kap-bottomwin" class="kap-bottomwin" style="display:none;">
    <div class="kap-hitarea"></div>
    <div class="kap-win" style="transform: translateY(0px); transition: -webkit-transform 0.2s cubic-bezier(0, 0, 0.25, 1);">
        <div class="kap-content">
            <div class="ty-popbottom">
                <div class="title">
                    发表评论
                    <span class="ask-kf">
                        <span><span class="btn-close" data-icon="ă"></span></span>
                    </span>
                </div>
                <div class="content" style="height: 5.625rem;">
                    <div class="ty-comment-pop">
                        <input type="hidden" name="par_id" value="{$product['id']}">
                        <textarea class="input-textarea btn-comment" id="product_contact_memo" placeholder="说点什么.."></textarea>
                    </div>
                </div>
                <div class="btn-submit" id="addProduct">确定</div>
            </div>
        </div>
    </div>
</div>
<div data-kap="_kap_mask" class="kap-mask kap-mask-on" style="display:none;"></div>

<div class="kap-comment" style="display:none;">
    <div class="kap-hitarea"></div>
    <div class="kap-win"
         style="transform: translateY(0px); transition: -webkit-transform 0.2s cubic-bezier(0, 0, 0.25, 1);">
        <div class="kap-content">
            <div class="ty-popbottom">
                <div class="title">
                    发表评论
                    <span class="ask-kf">
                        <span><span class="btn-close" data-icon="ă"></span></span>
                    </span>
                </div>
                <div class="content" style="height: 5.625rem;">
                    <div class="ty-comment-pop">
                        <textarea class="input-textarea " id="product_contact_meto"
                                  placeholder="说点什么.."></textarea>
                    </div>
                </div>
                <div class="btn-submit" id="addComment" attr_father_id="" attr_type_id="">确定</div>
            </div>
        </div>
    </div>
</div>
<div data-kap="_kap_mask" class="kap-mask  kap-background" style="display:none;"></div>

</body>
<script src="__PUBLIC__/js/home/zepto.min.js"></script>
<script src="__PUBLIC__/vendors/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/layer/layer.js"></script>
<script>
    $('.video_iframe').each(function () {
        var width = document.getElementById("content-wrapper").offsetWidth, height = Math.ceil(3 * width / 4);
        $(this).attr('width', width);
        $(this).attr('height', height);
        var src = $(this).data('src');
        var f = src;
        if ((0 == f.indexOf("http://v.qq.com/iframe/player.html") || 0 == f.indexOf("http://v.qq.com/iframe/preview.html") || 0 == f.indexOf("https://v.qq.com/iframe/player.html") || 0 == f.indexOf("https://v.qq.com/iframe/preview.html"))) {
            var w = f.match(/[\?&]vid\=([^&]*)/), y = w[1];
            src = "http://v.qq.com/iframe/player.html?vid=" + y + '&width=' + width + '&hegiht=' + height + "&auto=0";
            src = src.replace(/^http:/, location.protocol);
            $(this).data('src', src);
        }
    });
    window.onload = function () {
        $("img,audio,iframe").each(function () {
            var src = $(this).data("src");
            if (src) {
                $(this).attr("src", src);
            }
        });
    }
</script>
<script>
    $(function () {
        $('.close').bind('click', function () {
            $('.ad').hide();
        })
    })
    $(function () {
        $('#conBox').on('keyup', function () {
            var txtval = $('#conBox').val().length;
            console.log(txtval);
            var str = parseInt(140 - txtval);
            console.log(str);
            if (str > 0) {
                $('#num_txt1').html(str);
            } else {
                $('#num_txt1').html('0');
                $('#conBox').val($('#conBox').val().substring(0, 140)); //这里意思是当里面的文字小于等于0的时候，那么字数不能再增加，只能是600个字
            }
            //console.log($('#num_txt').html(str));
        });
    })
    //留言弹框
    $(function(){
        $('.btn-comment').click(function () {
            $('.kap-bottomwin').css('display','block');
            $('.kap-mask-on').css('display','block');
        });
        $('.btn-close').click(function () {
            $('.kap-bottomwin').css('display','none');
            $('.kap-mask-on').css('display','none');
        });
    });
    $('#addProduct').click(function () {
        if($('#product_contact_memo').val()==''){
            alert('内容不能为空');
            return;
        }
        if($('#product_contact_memo').val().length<=3){
            alert('请填写不少于3个字');
            return;
        }

        var article_id = $("#article_id").val();
        var data = {
            article_id : article_id,
            content:$('#product_contact_memo').val()
        };
        $.ajax({
            type: 'post',
            url: "{:U('Article/comment')}",
            data: data,
            dataType: 'json',
            success: function (res) {
                if (res.status == 0) {
                    $("#product_contact_memo").val('');
                    return alert(res.msg);
                } else if (res.status == 1) {
                    alert(res.msg);
                    $('.kap-bottomwin').css('display', 'none');
                    $('.kap-mask-on').css('display', 'none');
                    $("#product_contact_memo").val('');
                    $.each(res.data, function (i, value) {
                        $('#lists-msg').append(
                                "<li class='items assign'>"+
                                "<div class='first' onclick='getFather("+ value.id +")'>"+
                                "<div class='userPic'><img src="+ value.headimgurl +" alt=''></div>" +
                                "<div class='content' style='text-align: left;'>" +
                                "<div class='userName'><a href='jacascript:;'>"+ value.username +"</a>:</div>" +
                                "<div class='msgInfo'>"+ value.content +"</div>" +
                                "<div class='times'><span>"+ value.create_time +"</span></div>" +
                                "</div>" +
                                "<div class='finger'>" +
                                "<a href='javascript:finget("+ value.id +",'1')'>" +
                                "<img src='__PUBLIC__/images/finger-2.jpg' alt=''>" +
                                "&nbsp;<span id='finger-"+ value.id +"'>"+ value.finger_count +"</span>" +
                                "</a>" +
                                "</div>"+
                                "</div>" +
                                "<div style='clear: both;'></div>" +
                                "<div class='replys'></div>"+
                                "</li>"
                        );
                    })

                }
            }
        })
    })

    $('.items').click(function () {
        $(this).addClass('assign');
        $(this).siblings('.items').removeClass('assign')
    });

    function getFather(id) {
        $('.kap-background').css('display', 'block');
        $('.kap-comment').css('display', 'block');
        $('.btn-close').click(function () {
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
        });
        $('#addComment').attr('attr_father_id',id);
    }

    function getFatherId(id,type_id) {
        $('.kap-background').css('display', 'block');
        $('.kap-comment').css('display', 'block');
        $('.btn-close').click(function () {
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
        });
        $('#addComment').attr('attr_father_id',id);
        $('#addComment').attr('attr_type_id',type_id);

    }

    $('#addComment').click(function () {
        if ($('#product_contact_meto').val() == '' && $('#product_contact_meto').val() > 0) {
            alert('内容不能为空');
            return;
        }
        if ($('#product_contact_meto').val().length <= 3) {
            alert('请填写不少于3个字');
            return;
        }
        if($('#addComment').attr('attr_father_id') != '' && $('#addComment').attr('attr_type_id') == ''){
            var url = "{:U('Article/childComment')}";
            var article_id = $("#article_id").val();
            var father_id = $('#addComment').attr('attr_father_id');
            var type_id = $('#addComment').attr('attr_father_id');
            var data = {
                article_id : article_id,
                father_id : father_id,
                type_id : type_id,
                content : $('#product_contact_meto').val()
            };
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
            $.post(url, data, function (res) {
                if (res.status == 0) {
                    alert(res.msg);
                } else if (res.status == 1) {
                    alert(res.msg);
                    $('.assign .replys').append(
                            "<div class='reply' onclick='getFatherId("+ res.data['id'] +","+ res.data['type_id'] +")'>" +
                            "<div class='image'><img src='" + res.data['headImg'] + "' alt=''>回复：<img src='" + res.data['headImgs'] + "' alt=''></div><span class='text'>" + res.data['content'] + "</span>" +
                            "</div>"
                    );
                }
            }, 'json');
        }else if($('#addComment').attr('attr_father_id') != '' && $('#addComment').attr('attr_type_id') != '') {
            var url = "{:U('Article/childComment')}";
            var article_id = $("#article_id").val();
            var father_id = $('#addComment').attr('attr_father_id');
            var type_id = $('#addComment').attr('attr_type_id');
            var data = {};
            data.article_id= article_id;
            data.father_id= father_id;
            data.type_id = type_id;
            data.content= $('#product_contact_meto').val();
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
            $.post(url, data, function (res) {
                if (res.status == 0) {
                    alert(res.msg);
                } else if (res.status == 1) {
                    alert(res.msg);
                    $('.assign .replys').append(
                            "<div class='reply' onclick='getFatherId("+ res.data['id'] +","+ res.data['type_id'] +")'>" +
                            "<div class='image'><img src='" + res.data['headImg'] + "' alt=''>回复：<img src='" + res.data['headImgs'] + "' alt=''></div><span class='text'>" + res.data['content'] + "</span>" +
                            "</div>"
                    );
                }
            }, 'json');
        }
    });

    function finger(id, status) {
        $.ajax({
            url: "{:U('finger')}?id=" + id + "&status=" + status,
            dataType: 'json',
            success: function (res) {
                if (res.status == 1) {
                    $("#z-" + id + "").attr('src', '__PUBLIC__/images/finger-1.jpg');
                    $("#finger-" + id + "").html(res.finger);
                } else if (res.status == 2) {
                    $("#z-" + id + "").attr('src', '__PUBLIC__/images/finger-2.jpg');
                    $("#finger-" + id + "").html(res.finger);
                }
            }
        })
    }
    $('#test1').on('click', function () {

        layer.open({
            type: 1
            ,
            offset: 't' //具体配置参考：offset参数项
            ,
            content: '\<\div style="padding:20px;">一、本文收录的部分文字图片来自于互联网，其版权均归原作者所有，本平台只提供参考并不构成任何投资及应用建议。<br\/> 二、如果本平台无意中侵犯了您的版权，敬请告之，核实后，将根据著作权人的要求，立即更正或者删除有关内容,谢谢！联系方式是，邮箱：1569357635@qq.com 。<br\/> 三、本平台通过互联网转载的资源，或是站内作者自己提供的资源，版权均归原作者所有，未经原版权作者许可，任何人不得擅作他用！您可以复制、转载和传播本站的任何信息，但务必在转载时注明来源，尊重其知识产权，并自负版权等法律责任。 \<\/div>'
            ,
            btn: ['我知道了']
            ,
            btnAlign: 'c' //按钮居中
            ,
            shade: 1 //不显示遮罩
            ,
            shadeClose: false
            ,
            yes: function () {
                layer.closeAll();
            }

        });
    });


</script>
<script>
    $(function () {
        $('img').each(function () {
            var src = $(this).attr('src');
            src = src.replace("ooyyee-crm-static.qiniudn.com", "7b1f8s.com1.z0.glb.clouddn.com");
            $(this).attr('src', src);
        });
    });
</script>
<script src="__PUBLIC__/js/sea.js"></script>
<script>
    var assetsVersion = '2.5';
    seajs.config({
        map: [
            [/^(.*\.(?:css|js))(.*)$/i, '$1?v=' + assetsVersion]
        ],
        base: "__PUBLIC__/js",
        alias: {
            "jquery": "jquery-1.10.2.min.js",
            "zepto": "modules/zepto/zepto",
        }
    });
    seajs.use(["main"], function (main) {
        wrapper = document.getElementById('content-wrapper');
        if (wrapper) {
            main.previewImage(wrapper);
        }
    });
</script>
<script type="text/javascript">
    $("window").scroll(function(){
        console.log($(this).scrollTop());
    });
    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: "{$signPackage['appId']}", // 必填，公众号的唯一标识
        timestamp: "{$signPackage['timestamp']}", // 必填，生成签名的时间戳
        nonceStr: "{$signPackage['nonceStr']}", // 必填，生成签名的随机串
        signature: "{$signPackage['signature']}",// 必填，签名，见附录1
        jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideOptionMenu', 'showOptionMenu', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'closeWindow', 'chooseImage', 'uploadImage', 'getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });
    wx.ready(function () {
        wx.onMenuShareAppMessage({
            title: "{$article[title]}",
            desc: "{$article['desc']}",
            link: "{$share_url}",
            imgUrl: "{$share_img}",
            success: function () {
                share_record();
            },
            cancel: function () {
                alert('已取消');
            }
        });
        wx.onMenuShareTimeline({
            title: "{$article[title]}",
            link: "{$share_url}",
            imgUrl: "{$share_img}",
            success: function () {
                share_record();// 用户确认分享后执行的回调函数
            },
            cancel: function () {
                alert('已取消');// 用户取消分享后执行的回调函数
            }
        });
        wx.error(function (res) {
//            alert(JSON.stringify(res));
        });
        function share_record() {
            var art_id = "{$article['id']}";
            var url = "{:U('Article/shareRecord')}";
            $.post(url, {art_id: art_id}, function (result) {
                alert(result.message);
            }, 'json');
        }
    });
    //收藏
    function collect(id, type) {
        $.ajax({
            url: "{:U('collect')}?id=" + id + "&type=" + type,
            dataType: 'json',
            success: function (res) {
                if (res.status == 1) {
                    $('.follow').removeClass().addClass('isCollect');
                } else if (res.status == 2) {
                    $('.isCollect').removeClass().addClass('follow');
                }
            }
        })
    }
</script>
</html>
<include file="Common:header"/>
<style>
    #order_contact_memo{
        width:90%;
        margin:0 auto;
        font-size:1rem;
        height:8rem;
        border:1px solid #FF3366;
        border-radius:10px;
        resize:none;
    }
</style>
<link rel="stylesheet" href="__PUBLIC__/css/home/order.css">
<div id="page_orders_wait" title="{$title}" class="kap-page kap-page-current">
    <div class="kap-top ty-menu-top">
        <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
            <span class="title">{$title}<span class="num"></span></span>
            <a href="javascript:void(0);" onclick="history.go(-1); " class="btn left btn-user" title="返回"
               data-icon="ɒ"></a>
            <a href="{:U('Personal/index',array('current'=>'4'))}" class="btn right btn-user" title="返回个人中心"
               data-icon="Ņ"></a>
        </div>
    </div>

    <div class="ty-page" data-ty-current="0" data-ty-total="0">
        <div class="ty-order-star">
            <div class="org-star">
                <span class="star-span">机构评分</span>
                <ul class="org-star-ul">
                    <li attr-val="1"></li>
                    <li attr-val="2"></li>
                    <li attr-val="3"></li>
                    <li attr-val="4"></li>
                    <li attr-val="5"></li>
                </ul>
            </div>
            <div class="env-star">
                <span class="star-span">环境评分</span>
                <ul class="env-star-ul">
                    <li attr-val="1"></li>
                    <li attr-val="2"></li>
                    <li attr-val="3"></li>
                    <li attr-val="4"></li>
                    <li attr-val="5"></li>
                </ul>
            </div>
            <div class="quality-star">
                <span class="star-span">质量评分</span>
                <ul class="quality-star-ul">
                    <li attr-val="1"></li>
                    <li attr-val="2"></li>
                    <li attr-val="3"></li>
                    <li attr-val="4"></li>
                    <li attr-val="5"></li>
                </ul>
            </div>
        </div>
        <div class="ty-order-message" style="height: 5.25rem;box-shadow: none;margin-top:4rem;">
            <input type="hidden" name="order_id" value="{$id}">
            <textarea id="order_contact_memo" class="input-textarea" placeholder="客户留言" data-default-msg="" name="memo"
                      data-ty-required="0" data-ty-required-tips=""></textarea>
        </div>
        <button class="submit-comment"><a href="javascript:void(0);" class="btn-order">提交评价</a></button>
    </div>
</div>
<!-- 底部菜单 -->
<div class="kap-bottom ty-menu-bottom" style="display: none">
    <div id="tools_idx" class="ty-tools ty-tools-idx ty-tools-current">
        <a href="{:U('Orders/allOrders')}"
           style="background: url('__PUBLIC__/images/order-icon1.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%; padding-left:1rem;"
           data-icon="">全部</a>
        <a href="{:U('Orders/queryPayByPage')}"
           style="background: url('__PUBLIC__/images/order-icon2.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%; padding-left:1rem;"
           data-icon="" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '发现'])">待付款</a>
        <a href="{:U('Orders/queryDeliveryByPage')}" class="current"
           style="background: url('__PUBLIC__/images/order-icon3.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%; padding-left:1rem;"
           data-icon="" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '消息'])">已付款<i id="new_msg_alert"></i></a>
        <a href="{:U('Orders/queryCancelOrders')}"
           style="background: url('__PUBLIC__/images/order-icon4.png') no-repeat 0.7rem 1.2rem; background-size:15% 30%; padding-left:1rem;"
           onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '我的'])">取消/退款</a>
    </div>
</div>
<include file="Common:footer"/>
<script>
    $(window).load(function () {
        setTimeout(function () {
            $('.kap-bottom').show();
        }, 2000)
    });
    $('.submit-comment').click(function () {
        var org_star = $(".org-star .light").length;
        var env_star = $(".env-star .light").length;
        var quality_star = $(".quality-star .light").length;
        if(org_star <= 0){
            return alert('请对机构评分');
        }
        if(env_star <= 0){
            return alert('请对环境评分');
        }
        if(quality_star <= 0){
            return alert('请对教学质量评分');
        }
        var order_id = $("input[name='order_id']").val();
        var url = "{:U(Orders/addComment)}";
        var data = {
            order_id: order_id,
            content: $('#order_contact_memo').val(),
            org_star: org_star,
            env_star: env_star,
            quality_star: quality_star
        };
        $.post(url, data, function (result) {
            if (result.status == 0) {
                return alert(result.message);
            } else {
                alert(result.message);
                setTimeout(window.location.href = '/index.php/Personal/index', 3000);

            }
        }, 'json');
    });

    $(".org-star li").click(function () {
        var starCount = $(this).attr('attr-val');
        var lis = $(".org-star li");
        for (var i = 0; i < lis.length; i++) {
            lis[i].className = i < starCount ? "light" : '';
        }
    });

    $(".env-star li").click(function () {
        var starCount = $(this).attr('attr-val');
        var lis = $(".env-star li");
        for (var i = 0; i < lis.length; i++) {
            lis[i].className = i < starCount ? "light" : '';
        }
    });

    $(".quality-star li").click(function () {
        var starCount = $(this).attr('attr-val');
        var lis = $(".quality-star li");
        for (var i = 0; i < lis.length; i++) {
            lis[i].className = i < starCount ? "light" : '';
        }
    });
</script>
</body>
</html>
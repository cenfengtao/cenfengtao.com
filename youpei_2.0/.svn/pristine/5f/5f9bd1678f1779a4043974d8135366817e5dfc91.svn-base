// 第三个li起隐藏头冠
$(".chart ul li:gt(2) .hat").hide();

// 底部半圆的切换
 $(".footer ul li>img").css("display","none");
$(".footer ul li>img:eq(3)").css("display","block");
$(" .footer ul li").click(function(){
    $(this).addClass('on').siblings().removeClass("on");
    var index=$(this).index();
    var liLen=$(".footer ul li").length;
    for(var i=0;i<=liLen-1;i++){
        $(".footer ul li>img").eq(i).css("display","none");
    }
    $(this).find("img:eq(0)").css("display","block");
})




//    获取url参数
function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}
var vote_id=GetRequest().vote_id;
  $.ajax({
        type:"get",
        url:"/index.php/Vote/ajaxUserBillboard",
        async: true,
        dataType:"json",
        data:{
          vote_id:vote_id
        },
        success:function(data){
          // console.log(data.data.voteStatus)
          if(data.data.voteStatus==1){
            $(".countdown").html("<h3>活动结束</h3><h3>欢迎下次来参与</h3>")
          }
          var list=data.data.list;
          var listLength=list.length;
          for(var i=0; i<listLength; i++){
            $(".chartList").append(
              '<li onclick="details('+list[i].id+')">'+
                 '<div class="img">'+
                     '<img src="../../../../Public/images/hat.png" alt="" class="hat">'+
                     '<img src="'+list[i].user_img+'" alt="" class="head">'+
                 '</div>'+
                 '<div class="text">'+
                     '<p><i></i>名称：<span>'+list[i].title+'</span></p>'+
                     '<p><i></i>作者：<span>'+list[i].username+'</span></p>'+
                     '<p><i></i>票数：<span class="count">'+list[i].vote_count+'</span></p>'+
                 '</div>'+
                 '<div class="order">'+
                     '<img src="" alt="">'+
                     '<span class="num">'+list[i].ranking+'</span>'+
                 '</div>'+
             '</li>'
            )
          }
          $(".order").eq(0).find("img").attr("src","../../../../Public/images/prize.png")
          $(".order").eq(1).find("img").attr("src","../../../../Public/images/silver.png")
          $(".order").eq(2).find("img").attr("src","../../../../Public/images/bronze.png")
          $(".chart ul li:gt(2) .hat").hide();
          $(".time").attr("value",data.data.endTime)
                 //倒计时
          var time_current = (new Date()).valueOf();//获取当前时间
          $(function () {
              var dateTime = new Date();
              var difference = dateTime.getTime() - time_current;
              setInterval(function () {
                      var endTime = new Date(parseInt($(".time").attr('value')) * 1000);
                      var nowTime = new Date();
                      var nMS = endTime.getTime() - nowTime.getTime() + difference;
                      var myD = Math.floor(nMS / (1000 * 60 * 60 * 24));
                      var myH = Math.floor(nMS / (1000 * 60 * 60)) % 24;
                      var myM = Math.floor(nMS / (1000 * 60)) % 60;
                      var myS = Math.floor(nMS / 1000) % 60;
                      var myMS = Math.floor(nMS / 100) % 10;
                      $(".day").html(myD);
                      $(".hours").html(myH);
                      $(".minute").html(myM);   
                      $(".second").html(myS);
              }, 100);
          });         
        }
    })
  function details(id){
    window.location.href="/index.php/Vote/voteDetail.html?id="+id+"&vote_id="+vote_id;
  }
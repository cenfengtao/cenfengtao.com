<include file="Common:header"/>
<link rel="stylesheet" href="__PUBLIC__/css/home/order.css">
<style>
    .list-order .alert{
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        position: fixed;
        text-align: center;
        font-size: 30px;
        z-index: 10000;
        height: 50px;
    }
    .nav{
        margin-top: 2.5rem;
        position: fixed;
        width: 100%;
        border-top: 6px solid #f1f1f1;
        background: white;
        z-index: 1000;
    }
    .nav ul li{
        height: 2.4rem;
        line-height: 2.4rem;
        width: 20%;
        text-align: center;
        float: left;
    }
    .nav ul li a{
        color: #777777;
        font-size: 0.9rem;
    }
    .nav ul li.on{
        border-bottom: 0.29rem solid #386998;
    }
    .nav ul li.on a{
        color: #386998;
    }
    .ty-page{
        margin-top: 5.1rem;
    }
    .order-list li{
        padding: 0;
        height: 16.3rem;
    }
    .type{
        height: 2.4rem;
        line-height: 2.4rem;
        font-size: 1.2rem;
        padding-left: 1rem;
        color: #386998;
    }
</style>
<div id="page_orders_wait" title="{$title}" class="kap-page kap-page-current">
     <div class="kap-top ty-menu-top">
    <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
        <span class="title">{$title}<span class="num"></span></span>
        <a href="javascript:void(0);" onclick="history.go(-1); " class="btn left btn-user" title="返回" data-icon="ɒ"></a>
        <a href="{:U('Index/index')}" class="btn right btn-user" title="返回个人中心"
           data-icon="Ņ"></a>
    </div>
</div>
<div class="nav">
    <ul>
        <li class="on"><a href="{:U('Orders/allOrders')}" class="current" >全部</a></li>
        <li><a href="{:U('Orders/queryPayByPage')}" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '发现'])">待付款</a></li>
        <li><a href="{:U('Orders/queryDeliveryByPage')}" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '消息'])">待收货<i id="new_msg_alert"></i></a></li>
        <li><a href="{:U('Orders/needCommentList')}" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '消息'])">待评价<i id="new_msg_alert"></i></a></li>
        <li><a href="{:U('Orders/queryCancelOrders')}" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '我的'])">退款/售后</a></li>
    </ul>
</div>
    <div class="ty-page" data-ty-current="0" data-ty-total="0">
        <div class="order-list">
            <ul class="list-order">
                <volist name="list" id="val">
                    <li>
                        <notempty name="val['product_id']">
                            <div class="type">
                                <span>优培教育 ></span>
                            </div>
                            <div class="left"><img src="{$val['pro_pic']}" onclick="getProduct({$val['product_id']})"></div>
                            <div class="rig"><p class="title" onclick="getProduct({$val['product_id']})">{$val['pro_title']}</p></div>
                        </notempty>
                        <notempty name="val['parenting_id']">
                            <div class="left"><img src="{$val['pro_pic']}" onclick="getParenting({$val['parenting_id']})"></div>
                            <div class="rig"><p class="title" onclick="getParenting({$val['parenting_id']})">{$val['pro_title']}</p></div>
                        </notempty>
                        <notempty name="val['activity_id']">
                            <div class="left"><img src="{$val['pro_pic']}" onclick="getActivity({$val['activity_id']})"></div>
                            <div class="rig"><p class="title" onclick="getActivity({$val['activity_id']})">{$val['pro_title']}</p></div>
                        </notempty>
                        <notempty name="val['group_record_id']">
                            <div class="left"><img src="{$val['pro_pic']}" onclick="getGroup({$val['group_record_id']})"></div>
                            <div class="rig"><p class="title" onclick="getGroup({$val['group_record_id']})">{$val['pro_title']}</p></div>
                        </notempty>
                        <p class="desc"><span class="price"><span>￥</span>{$val['price']}</span> &#160;<span>×{$val['amount']}</span></p>
                        <p class="time">{$val['create_time'] | date="Y/m/d",###}
                        <!-- 待付款 -->
                        <if condition="$val['status'] eq 0">
                                <span class="quxiao" onclick="cancelOrder({$val['id']})">取消订单</span>
                                <span class="zhifu" onclick="payAgain({$val['id']})">重新支付</span>
                        </if>
                        <!-- 待收货 -->
                        <if condition="$val['status'] eq 1">
                            <notempty name="val['product_id']">
                                <span class="checkExpress" onclick="checkExpress({$val['id']})">查看物流</span>
                                <span class="appeal" onclick="getProduct({$val['product_id']})">再次购买</span>
                            </notempty>
                            <notempty name="val['parenting_id']">
                                <span class="appeal" onclick="getParenting({$val['parenting_id']})">再次购买</span>
                            </notempty>
                            <notempty name="val['activity_id']">
                                <span class="appeal" onclick="getActivity({$val['activity_id']})">再次购买</span>
                            </notempty>
                            <notempty name="val['group_record_id']">
                                <span class="appeal" onclick="getGroup({$val['group_record_id']})">再次购买</span>
                            </notempty>
                        </if>
                        <if condition="$val['status'] eq 4">
                            <!-- 待评价 -->
                            <notempty name="val['isComment']">
                                <span class="checkExpress" onclick="appeal({$val['id']})">申诉订单</span>
                                <span class="appeal" onclick="addComment({$val['id']})">立即评价</span>
                                <else />
                                <notempty name="val['product_id']">
                                    <span class="appeal" onclick="getProduct({$val['product_id']})">再次购买</span>
                                </notempty>
                                <notempty name="val['parenting_id']">
                                    <span class="appeal" onclick="getParenting({$val['parenting_id']})">再次购买</span>
                                </notempty>
                                <notempty name="val['activity_id']">
                                    <span class="appeal" onclick="getActivity({$val['activity_id']})">再次购买</span>
                                </notempty>
                                <notempty name="val['group_record_id']">
                                    <span class="appeal" onclick="getGroup({$val['group_record_id']})">再次购买</span>
                                </notempty>
                            </notempty>
                        </if>
                        <!-- 已取消 -->
                        <if condition="$val['status'] eq 2">
                            <notempty name="val['product_id']">
                                <span class="appeal" onclick="getProduct({$val['product_id']})">再次购买</span>
                                <span style="position:absolute;right: 1rem;color:#eb647e;">已取消</span>
                            </notempty>
                            <notempty name="val['parenting_id']">
                                <span class="appeal" onclick="getParenting({$val['parenting_id']})">再次购买</span>
                                <span style="position:absolute;right: 1rem;color:#eb647e;">已取消</span>
                            </notempty>
                            <notempty name="val['activity_id']">
                                <span class="appeal" onclick="getActivity({$val['activity_id']})">再次购买</span>
                                <span style="position:absolute;right: 1rem;color:#eb647e;">已取消</span>
                            </notempty>
                            <notempty name="val['group_record_id']">
                                <span class="appeal" onclick="getGroup({$val['group_record_id']})">再次购买</span>
                                <span style="position:absolute;right: 1rem;color:#eb647e;">已取消</span>
                            </notempty>
                        </if>
                        </p>
                    </li>
                </volist>
                <li data-icon="Ĩ" class="item-more" style="display:none;">
                    点击载入更多
                </li>
            </ul>
        </div>
    </div>
</div>
<script>
    $(function(){
        $(".nav li").click(function(){
            $(this).addClass("on").siblings().removeClass("on")
        })
        if($(".list-order li").length==1){
            $(".list-order").append('<p class="alert">你还没有商品哦，赶紧去选购吧！</p>')
        }
    });
    function appeal(id) {
        window.location.href = "{:U('Orders/rejectOrder')}?orderId="+id;
    }
    function addComment(id) {
        window.location.href = "{:U('Orders/addComment')}?id="+id;
    }
    function payAgain(id) {
        var url = "{:U('Orders/payAgain')}";
        $.get(url,{id:id},function (result) {
            if(result.status == 0){
                return alert(result.message);
            } else {
                switch(result.data['pro_type']){
                    case 'product':
                        window.location.href = "{:U('WxPay/jsapiIndex')}?orderId=" + result.data['order_id'];
                        break;
                    case 'parenting':
                        window.location.href = "/index.php/WxPay/jsapiByParenting?orderId=" + result.data['order_id'];
                        break;
                    case 'activity' :
                        window.location.href = "{:U('WxPay/jsapiByActivity')}?orderId="+ result.data['order_id'];
                        break;
                    case 'group' :
                        window.location.href = "{:U('WxPay/jsapiByGroup')}?orderId="+ result.data['order_id'];
                        break;
                    default :
                        return alert('订单错误');
                }
            }
        },'json');
    }
    function cancelOrder(id) {
        if(confirm("确认取消该订单？")){
            var url = "{:U('Orders/cancelOrder')}";
            $.post(url, {order_id: id}, function (result) {
                if (result.status == 0) {
                    return alert(result.msg);
                } else {
                    location.reload();
                }
            }, 'json');
        }
    }
    function deleteOrder(id) {
        var url = "{:U('Orders/deleteOrder')}";
        $.post(url, {order_id: id}, function (result) {
            if (result.status == 0) {
                return alert(result.msg);
            }
            if (result.status == 1) {
                alert(result.msg);
                location.reload();
            }
        }, 'json');
    }
    function getProduct(id) {
        window.location.href = "{:U('Product/productDetails')}?pro_id="+id;
    }

    function getParenting(id) {
        window.location.href = "{:U('Parenting/productDetails')}?par_id="+id;
    }

    function getActivity(id) {
        window.location.href = "{:U('Organization/activityDetail')}?id="+id;
    }

    function getGroup(id) {
        window.location.href = "{:U('Groups/getGroup')}?id="+id;
    }

    function addComment(id) {
        window.location.href = "/index.php/Orders/addComment?id="+id;
    }

    function appeal(id) {
        window.location.href = "{:U('Orders/rejectOrder')}?orderId="+id;
    }

    function checkExpress(id) {
        window.location.href = "/index.php/Orders/checkExpress?id="+id;
    }
</script>
<script>
    $(window).load(function (){
        setTimeout(function () {
            $('.kap-bottom').show();
        },2000)
    });
</script>
<include file="Common:footer"/>
</body>
</html>
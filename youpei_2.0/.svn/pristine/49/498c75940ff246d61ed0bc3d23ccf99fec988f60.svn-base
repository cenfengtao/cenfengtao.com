<!DOCTYPE html>
<html>
<head>
    <title>{$header_title|default="优培圈"}</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Mobile Devices Support @begin -->
    <meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="pragma">
    <meta content="0" http-equiv="expires">
    <meta content="telephone=no, address=no" name="format-detection">
    <meta name="apple-mobile-web-app-capable" content="yes"/> <!-- apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/style_v3.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/dialog.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/main_1-0.css">
    <script type="text/javascript" src="__PUBLIC__/js/home/dialog_1-0.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/home/zepto.min.js"></script>
    <!--移动端兼容适配 end -->
</head>
<body>
<div class="container">
    <div class="header" data-action="{$Think.ACTION_NAME}">
        <a class="block" href="javascript:void(0)" id="header_go_back" data-home-url="{:U('Index/index')}"
           style="display: none;"></a>
        <h1 style="font-size:20px;">{$page_title|default="优培圈"}</h1>
        <a class="block" href="{:U('Index/index')}" id="header_go_home" style="display: none;"></a>
    </div>
    <div class="main">
        <div class="ad_img_v4 center mtb8 ptb3 bdr10" style="box-shadow: 0 5px 8px #dadada;">
            <p class="myfriend-v4">我的学友团</p>
        </div>
        <section class="user-info-v4">
            <ul class="user_list fz18">
<!--                 <li class="clr gray-bg_v4 bdr10 ptb3" style="background: #97c2e0;">
                    <label>总人数</label>
                    <div class="user-total-coupons bdr10 fz18">{$count|default="0"}人</div>
                </li>

                    <li class="clr gray-bg_v4 bdr10 ptb3">
                        <label class="username">你的上级</label>
                        <div class="user-total-coupons bdr10 fz18">{$up_user['username']}</div>
                    </li> -->

            </ul>
        </section>
    </div>
    <section class="manage-v4 w92 friend-v4">
        <table id="tableList">
            <thead>
            <tr>
                <th data-sort="1" class="gray-bg_v4 bdr10 bg568 fz18">我的学生</th>
                <th data-sort="1" class="gray-bg_v4 bdr10 bg798 fz18">加入时间</th>
                <th data-sort="1" class="gray-bg_v4 bdr10 bg96a fz18">他的学生</th>
            </tr>
            </thead>
            <tbody>
            
            <!-- <volist name="children" id="vo">
                <tr onclick="showChildren({$vo.id});"
                <if condition="$vo['child_count'] lt 1">id=''
                    <else/>
                    id="tr_{$vo.id}"
                </if>
                >
                <td>{$vo.username}</td>
                <td>{$vo.create_time|date="Y-m-d",###}</td>
                <td class="last-td last_id{$vo.id}">{$vo.child_count}<img src="__PUBLIC__/images/down.png" alt="">
                </td>
                </tr>
            </volist> -->
            </tbody>
        </table>
    </section>
    <div class="footer_coopyright">
        本活动最终解释权归优培圈所有
    </div>
</div>
</body>
<!-- footer start-->
<script src="__PUBLIC__/js/home/zepto.min.js"></script>
<script>
    $(function () {
        $('img').each(function () {
            var src = $(this).attr('src');
            src = src.replace("ooyyee-crm-static.qiniudn.com", "7b1f8s.com1.z0.glb.clouddn.com");
            $(this).attr('src', src);
        });
    });
</script>
<script src="__PUBLIC__/js/sea.js"></script>
<script>
    var assetsVersion = '2.5';
    seajs.config({
        map: [
            [/^(.*\.(?:css|js))(.*)$/i, '$1?v=' + assetsVersion]
        ],
        base: "__PUBLIC__/js",
        alias: {
            "jquery": "jquery-1.10.2.min.js",
            "zepto": "modules/zepto/zepto",
        }
    });
    seajs.use(["main"], function (main) {
        wrapper = document.getElementById('content-wrapper');
        if (wrapper) {
            main.previewImage(wrapper);
        }
    });
</script>
</html>
<!-- footer end-->
<script>
$.ajax({
    url:'/index.php/Friends/ajaxGetChildren',
    async: true,
    type:"get",
    dataType:"json",
    success:function(data){
        console.log(data)
        if(data.data.up_user==false){
            data.data.up_user="暂无"
        }
        $(".user_list").html(
            '<li class="clr gray-bg_v4 bdr10 ptb3" style="background: #97c2e0;">'+
                '<label>总人数</label>'+
                '<div class="user-total-coupons bdr10 fz18">'+data.data.count+'人</div>'+
            '</li>'+
            '<li class="clr gray-bg_v4 bdr10 ptb3">'+
                '<label class="username">你的上级</label>'+
                '<div class="user-total-coupons bdr10 fz18">'+data.data.up_user+'</div>'+
            '</li>'
        )
        if(data.data.count==0){
            $(".clr").remove();
            alert("您目前还没有任何学友团，快邀请属于你的学友团来助力吧");
        }
        var childrenL=data.data.children.length;
        for(var i=0; i<=childrenL-1; i++){
            var id=data.data.children[i].id;
            var username=data.data.children[i].username;
            var date=data.data.children[i].create_time;
            var child_count=data.data.children[i].child_count;
             $("#tableList tbody").append(
                '<tr onclick="showChildren('+id+')"  class="onclick">'+
                    '<td>'+username+'</td>'+
                    '<td>'+date+'</td>'+
                    '<td class="last-td last_id'+id+'"><span class="num">'+child_count+'</span><img src="__PUBLIC__/images/down.png" alt="">'+
                    '</td>'+
                '</tr>'
            )
             if(child_count!=0){
                document.getElementsByClassName("onclick")[i].id="tr_"+id+"";

             }
//              if(data.data.children[i].children.length>0){
//                     var nextChild=data.data.children[i].children;
//                     var nextChildL=data.data.children[i].children.length;
//                     var tbody='';
//                     for(var s=0; s<=nextChildL-1; s++){
//                     $('#tr_' + id).attr('onclick', 'closeChildren(' + id + ')');
//                     $('.last_id' + id + ' img').attr('src', '__PUBLIC__/images/up.png');
//                     tbody += '<tr class="down-tr del tr-' + id + '" id=""><td>' + nextChild[s].username + '</td><td  style="text-align:center;">' + nextChild[s].create_time + '</td><td> 0 </td></tr>';
//                     }
//                     $("#tr_" + id).after(tbody);
//              }
        }

    }
})







    var friends = {$total_count | default= "1"};
    if (friends == 0) {
        alert("您目前还没有任何学友团，快邀请属于你的学友团来助力吧");
    }
    var bool=true;
    function showChildren(id) {
        // if(bool){
            // var undefined=$("#tr_"+id).attr("id");
            // if(undefined==id){

            // }
            if($("#tr_"+id).attr("id")){
                if(bool){
                    $.ajax({
                        url:'/index.php/Friends/ajaxGetChildren',
                        async: true,
                        type:"get",
                        dataType:"json",
                        success:function(data){
                        //     if(exit=="onclick on"){
                        //    return;
                        // }
                            // console.log(data)
                            var childrenL=data.data.children.length; 
                            for(var j=0; j<=childrenL-1; j++){
                                
                                if(id==data.data.children[j].id){
                                    var nextChild=data.data.children[j].children;
                                    var nextChildL=data.data.children[j].children.length;
                                    if(nextChildL>0){
                                        // if(bool){
                                             var tbody='';
                                            for(var s=0; s<=nextChildL-1; s++){
                                            $('#tr_' + id).attr('onclick', 'closeChildren(' + id + ')');
                                            $('.last_id' + id + ' img').attr('src', '__PUBLIC__/images/up.png');
                                            tbody += '<tr class="down-tr del tr-' + id + '" id=""><td>' + nextChild[s].username + '</td><td  style="text-align:center;">' + nextChild[s].create_time + '</td><td> 0 </td></tr>';
                                            }
                                            $("#tr_" + id).after(tbody);
                                            // bool=false;
    
                                       
                                    }
                                }
                            }

                        }
                    })
                    bool=false;
                }
                
            }
             

        //     bool=false;
        // }
      }  
    //     // var url = "{:U('ajaxGetChildren')}";
    //     // $.post(url, {id: id}, function (data) {
    //     //     if (data.status == 1) {
    //     //         var tbody = '';
    //     //         $.each(data['data'], function (n, value) {
    //     //             if (value.child_count <= 0) {
    //     //                 $('#tr_' + id).attr('onclick', 'closeChildren(' + id + ')');
    //     //                 $('.last_id' + id + ' img').attr('src', '__PUBLIC__/images/up.png');
    //     //                 tbody += '<tr class="down-tr del tr-' + id + '" id=""><td>' + value.username + '</td><td  style="text-align:center;">' + value.create_time + '</td><td>' + value.child_count + '</td></tr>';
    //     //             } else {
    //     //                 tbody += '<tr class="tr-' + id + '" id="tr_' + value.id + '" onclick="showChildren(' + value.id + ');"><td>' + value.username + '</td><td>' + value.create_time + "</td><td>" + value.child_count + '</td></tr>';
    //     //             }
    //     //         });
    //     //         $("#tr_" + id).after(tbody);
    //     //     } else {
    //     //         return alert(data.message);
    //     //     }
    //     // }, 'json');
    function closeChildren(id) {
        // $("#tr_"+id).removeClass("on")
        bool=true;
        $('.tr-' + id).click();
        $('.tr-' + id).remove();
        $('#tr_' + id).attr('onclick', 'showChildren(' + id + ');');
        $('.last_id' + id + ' img').attr('src', '__PUBLIC__/images/down.png');
    }
    function isInArray(arr, id) {
        var b = true;
        for (var i = 0; i < arr.length; i++) {
            if (id == arr[i]) {
                b = false;
                break;
            }
        }
        return b;
    }
</script>
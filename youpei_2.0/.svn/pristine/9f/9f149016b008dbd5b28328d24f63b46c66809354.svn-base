<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>优培圈</title>
    <!-- 向下滑动加载的图片样式，需放在外链的第一位 -->
    <link rel="stylesheet" href="http://www.youpei-exc.com/Public/Home/layer/skin/default/layer.css?v=3.0.3303" id="layuicss-skinlayercss">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/pageloader.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/voteList.css"/>
    <script type="text/javascript" src="__PUBLIC__/Home/js/jweixin-1.0.0.js"></script>
    <style>
       
    </style>
    <script type="text/javascript">
        if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
    </script>
    <!--  <script>
         var _hmt = _hmt || [];
         (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?548e13b07cb36e38bfd73870368a0253";
           var s = document.getElementsByTagName("script")[0];
           s.parentNode.insertBefore(hm, s);
         })();
     </script> -->
</head>
<body class="kap-loading ty-view-all">
<include file="Common:common"/>
<header class="header">
    <a href="/index.php/Vote/voteActivityList.html" class="back" style="width: 2.2rem;">
        <img src="../../../../Public/images/back.png" alt="" style="float: left;margin-top: 0.36rem;margin-right: 0.2rem;">
        <span style="color: gray; font-size: 0.4rem; margin-top: 0.2rem;">活动首页</span>
    </a>
    <h3></h3>
    <a href="../Index/index.html" class="home" data-icon="Ņ"></a>
</header>
<article class="middle">
    <section class="advert">
        <img src="" alt="">
        <a href="###" class="explain bargain">活动说明</a>
    </section>
    <section class="explainBox">
        <div class="explainContent">
            <img src="../../../../Public/images/close.png" alt="" class="closeBtn">
            <h3>说明</h3>
            <div class="desc"></div>
        </div> 
    </section>
    <section class="organization">
        <div>
             <span>主办方：</span>
             <a href="/index.php/Organization/home.html?id=1"><img src="../../../../Public/images/logo1.png" alt="" class="youpei">优培教育</a>
        </div>
       <div>
            <span>协办方：</span>
            <a href="/index.php/Organization/home.html?id=6" class="orgIndex"><img src="../../../../Public/images/logo2.png" alt="" class="help"></a>
       </div>
       
    </section>
    <section class="people">
        <ul>
            <li>
                <span>已报名</span>
                <span><strong class="join">0</strong>人</span>
            </li>
            <li>
                <span>累计投票</span>
                <span><strong class="total">0</strong>票</span>
            </li>
            <li>
                <span>访问量</span>
                <span><strong class="access">0</strong>次</span>
            </li>
        </ul>
    </section>
     <section class="joinWorks" style="display: none;">
        <a href="javascript:void(0)" onclick="" class="judge">果断参赛！</a>
    </section>
    <section class="show">
         <h3>——/ <strong>参</strong> / <strong>赛</strong> / <strong>作</strong> / <strong>品</strong> / <strong>展</strong> / <strong>示</strong> / <strong>区</strong> /——</h3>
    </section>
   
   <!--  <section class="search">
        <input type="text" placeholder="请输入号数" class="find" style="height: 0.8rem; width: 5rem;">
        <span>搜索</span>
    </section> -->
    <section class="worksList">
    	<ul id="content">
    		
    	</ul>
        <p class="alert" style="text-align: center;font-size: 0.5rem;line-height: 1rem;"></p>
    </section>
</article>
<input type="hidden" value="" class="voteStatus">
<footer class="footer">
    <ul class="icon">
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="javascript:void(0);" class="voteList">
                <img src="__PUBLIC__/images/voteIcon1.png"/>
                <span>作品库</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="javascript:void(0);" class="userVote">
                <img src="__PUBLIC__/images/voteIcon2.png"/>
                <span>我的投票</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="javascript:void(0);" class="userWorks">
                <img src="__PUBLIC__/images/voteIcon3.png"/>
                <span>我的作品</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="javascript:void(0);" class="userBillboard">
                <img src="__PUBLIC__/images/voteIcon4.png"/>
                <span>榜单</span>
            </a>
        </li>
    </ul>
</footer>
<script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/voteList.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/lazyload.js" type="text/javascript" charset="utf-8"></script>
<script src="/Public/Home/layer/layer.js"></script>
<script type="text/javascript">  
    function water(){
            var arrBox=$('#content').children('.box');// box对象
            var arrBoxH=[];//数组，用于存储左侧列中的所有块框相加的高度
            var arrBoxR=[];//数组，用于存储右侧列中的所有块框相加的高度
            for(var i=0;i<arrBox.length;i++){      //遍历box
                var boxH=arrBox.eq(i).innerHeight(); //获得box的高度
                if(i==0){
                    arrBox.eq(i).addClass("left"); //第一行中的第一个块box添加左浮动（left是自己写好的有float:left属性的选择器名）
                    arrBoxH[i]=boxH; //第一行中的第一个块box 先添加进数组arrBoxH
                }else if(i==1){
                    arrBox.eq(i).addClass("right");//第一行中的第一个块box添加右浮动
                    arrBoxR[i]=boxH; //第一行中的第二个个块box 先添加进数组arrBoxR
                }else{
                    var leftNum = arrBoxH.reduce(function (x, y) {
                        return x + y;
                    });//计算左侧列的高度
                    var rightNum = arrBoxR.reduce(function (x, y) {
                        return x + y;
                    });//计算右侧列的高度
                    if(leftNum > rightNum) //比较两侧高度大小，决定为该box添加左浮动还是右浮动
                    {
                        arrBox.eq(i).removeClass();
                        arrBox.eq(i).addClass("box right");  //左侧较高为该box添加右浮动
                        arrBoxR[i]=boxH;                     //将高度添加在右侧数组
                    }else {
                        arrBox.eq(i).removeClass();
                        arrBox.eq(i).addClass("box left");  //右侧较高为该box添加左浮动
                        arrBoxH[i]=boxH;                    //将高度添加在左侧数组
                    }
                }
            }
        }
</script>
<script>


    function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}
var vote_id=GetRequest().vote_id;
if(vote_id==10){
    $(".help").attr("src","../../../../Public/images/help.jpg")
    $(".orgIndex").attr("href","javascript:void(0);")
}
 $(function(){   
        $(".explain").click(function(){
            $(".explainBox").slideDown(1000)
        })
        $(".closeBtn").click(function(){
            $(".explainBox").hide()
            var isRead=window.sessionStorage.getItem("isRead")
            if(isRead==2){
                $.ajax({
                    type:"get",
                    url:"/index.php/Vote/read",
                    aysnc:true,
                    dataType:"join",
                    data:{
                         vote_id:vote_id
                    },
                    success:function(){
                        
                    }
                })
            }
        })
    })
$(".voteList").attr("href","/index.php/Vote/voteList.html?vote_id="+vote_id)
$(".userVote").attr("href","/index.php/Vote/userVote.html?vote_id="+vote_id)
$(".userWorks").attr("href","/index.php/Vote/userWorks.html?vote_id="+vote_id)
$(".userBillboard").attr("href","/index.php/Vote/userBillboard.html?vote_id="+vote_id)
 // 微信端分享
    $.ajax({
        type: "get",
        url: "/index.php/Vote/voteListContribution",
        aysnc: true,
        dataType: "json",
        data:{
            vote_id:vote_id,
        },
        success:function(data){
            // console.log(data);
            var title=data.data.share_title;
            var f_title=data.data.share_desc;
            var shareUrl=data.data.share_url;
            var shareImg=data.data.share_img;
            // 调用微信的分享接口
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: "{$signPackage['appId']}", // 必填，公众号的唯一标识
                timestamp: "{$signPackage['timestamp']}", // 必填，生成签名的时间戳
                nonceStr: "{$signPackage['nonceStr']}", // 必填，生成签名的随机串
                signature: "{$signPackage['signature']}",// 必填，签名，见附录1
                jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideOptionMenu', 'showOptionMenu', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'closeWindow', 'chooseImage', 'uploadImage', 'getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            });
            wx.ready(function () {
                wx.onMenuShareAppMessage({
                    title: title,
                    desc: f_title,
                    link: shareUrl,
                    imgUrl: shareImg,
                    success: function () {
                        share_record();
                    },
                    cancel: function () {
                        alert('已取消');
                    }
                });
                wx.onMenuShareTimeline({
                    title: title,
                    link: shareUrl,
                    imgUrl: shareImg,
                    success: function () {
                        share_record();// 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        alert('已取消');// 用户取消分享后执行的回调函数
                    }
                });

                function share_record() {
                    var data = new Array();
                    data[id] = getQueryString(id);
                    data[share_user_id] = getQueryString(share_user_id);
                 var url = "/index.php/Vote/userContributionRecord";
                 $.post(url, data, function (result) {
                 alert(result.message);
                 }, 'json');
                 }
            });
        }
    });
    $.ajax({
        type:"get",
        url:"/index.php/Vote/ajaxVoteList",
        async: true,
        dataType:"json",
        data:{
            vote_id:vote_id
        },
        success:function(data){
            var titles=data.data.title;
            if(titles){
                $(".header h3").html(titles)
            }else{
                $(".header h3").html("投票活动")
            }
            if(data.status==0){
                setTimeout(function(){
                     alert(data.message)
                     history.back()
                },1000) 
            }
            if(data.status==1){
                var read=data.data.isRead;
                window.sessionStorage.setItem("isRead",read)
                if(read==2){
                    $(".explainBox").slideDown(1000)
                }
                $(".advert img").attr("src",data.data.background)
                $(".desc").append(data.data.desc)
                var joinSum=data.data.joinSum;
                var visitSum=data.data.visitSum;
                var voteSum=data.data.voteSum;
                var joinUser=data.data.joinUser;
                var joinUserLength=joinUser.length;
                var upload_type=data.data.upload_type;
                window.sessionStorage.setItem("status",upload_type)
                $(".voteStatus").val(data.data.voteStatus)
                if(data.data.voteStatus==1){
                     if(data.data.isContribute==1){
                        // $(".joinWorks").hide();
                        $(".judge").attr("onclick","endActivity()")
                        $(".judge").css("background","gray");
                        $(".joinWorks").fadeIn(1500)
                    }
                    // setTimeout(function(){
                    //      alert("该活动已结束，欢迎下次来参加!")
                    // })
                    $(".join").html(joinSum);
                    $(".total").html(voteSum);
                    $(".access").html(visitSum);
                    // 图片数据
                    if(upload_type==1){
                        for(var i=0;i<joinUserLength; i++){
                             $("#content").append(
                                '<li onclick="toVote('+joinUser[i].id+')" id="'+joinUser[i].id+'" class="box">'+
                                    '<div class="img">'+
                                         '<img class="lazy" alt="" src="'+joinUser[i].path+'" alt="" onload="water()">'+
                                         '<img class="greenTap" src="../../../../Public/images/greenTap.png"/>'+
                                         '<span class="order">1号</span>'+
                                         // '<span>'+joinUser[i].id+'</span>'+
                                    '</div>'+
                                    '<p class="name">作品名称：<span>'+joinUser[i].title+'</span></p>'+
                                    '<p>作品作者：<span>'+joinUser[i].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span class="getNum"><strong>'+joinUser[i].vote_count+'</strong>票</span>'+
                                        '<span class="vote">给TA投票</span>'+
                                    '</div>'+
                                '</li>')
                        }
                        $("img.lazy").lazyload({effect: "fadeIn"});
                    }
                    // 视频数据
                    if(upload_type==2){
                        for(var j=0;j<joinUserLength; j++){
                             $("#content").append(
                                '<li onclick="toVote('+joinUser[j].id+')" id="'+joinUser[j].id+'" class="box">'+
                                    '<div class="img">'+
                                         '<img src="'+joinUser[j].path+'" alt=""></img>'+
                                         // '<span>'+joinUser[i].id+'</span>'+
                                    '</div>'+
                                    '<p class="name">作品名称：<span>'+joinUser[j].title+'</span></p>'+
                                    '<p>作品作者：<span>'+joinUser[j].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span class="getNum"><strong>'+joinUser[j].vote_count+'</strong>票</span>'+
                                        '<span class="vote">给TA投票</span>'+
                                    '</div>'+
                                '</li>')
                        } 
                        $("img.lazy").lazyload({effect: "fadeIn"});
                    }
                    $(".vote").hide();
                    $(".getNum").css("float","none")
                    $(".text").css("textAlign","center")
                
                }

                if(data.data.voteStatus==2){
                    $(".join").html(joinSum);
                    $(".total").html(voteSum);
                    $(".access").html(visitSum);
                    if(data.data.isContribute==1){
                        // $(".joinWorks").hide();
                        $(".judge").attr("onclick","end()")
                        $(".judge").css("background","gray");
                        $(".joinWorks").fadeIn(1500)
                    }
                    if(data.data.isContribute==2){
                        // $(".joinWorks").show();
                        if(data.data.join==1){
                             $(".judge").attr("onclick","join()")
                             $(".joinWorks").fadeIn(1500);
                        }else if(data.data.join==2){
                            $(".judge").attr("onclick","joined()")
                            $(".joinWorks").hide()
                            // $(".joinWorks").fadeIn(1500);
                        }
                    }
                    // 图片数据
                    if(upload_type==1){
                        for(var i=0;i<joinUserLength; i++){
                           $("#content").append(
                                '<li onclick="toVote('+joinUser[i].id+')" id="'+joinUser[i].id+'" class="box">'+
                                    '<div class="img">'+
                                         '<img class="lazy" alt="" src="'+joinUser[i].path+'" alt="" onload="water()">'+
                                         '<img class="greenTap" src="../../../../Public/images/greenTap.png"/>'+
                                         '<span class="order">1号</span>'+
                                         // '<span>'+joinUser[i].id+'</span>'+
                                    '</div>'+
                                    '<p class="name">作品名称：<span>'+joinUser[i].title+'</span></p>'+
                                    '<p>作品作者：<span>'+joinUser[i].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span class="getNum"><strong>'+joinUser[i].vote_count+'</strong>票</span>'+
                                        '<span class="vote">给TA投票</span>'+
                                    '</div>'+
                                '</li>')
                        }
                        $("img.lazy").lazyload({effect: "fadeIn"});
                    }
                    // 视频数据
                    if(upload_type==2){
                        for(var j=0;j<joinUserLength; j++){
                            $("#content").append(
                                '<li onclick="toVote('+joinUser[j].id+')" id="'+joinUser[j].id+'" class="box">'+
                                    '<div class="img">'+
                                         '<img src="'+joinUser[j].path+'" alt=""></img>'+
                                         // '<span>'+joinUser[i].id+'</span>'+
                                    '</div>'+
                                    '<p class="name">作品名称：<span>'+joinUser[j].title+'</span></p>'+
                                    '<p>作品作者：<span>'+joinUser[j].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span class="getNum"><strong>'+joinUser[j].vote_count+'</strong>票</span>'+
                                        '<span class="vote">给TA投票</span>'+
                                    '</div>'+
                                '</li>')
                        } 
                        $("img.lazy").lazyload({effect: "fadeIn"});
                        $("#content li:even").css("margin-right","4%")
                    }

                }
                if(data.data.voteStatus==3){
                    var year=data.data.start_time.split("-")[0];
                    var month=data.data.start_time.split("-")[1];
                    var day=data.data.start_time.split("-")[2];
                    $(".judge").css("background","gray");
                    $(".joinWorks").fadeIn(1500)
                    $(".judge").click(function(){
                        alert("该活动未开始，将在"+year+"年"+month+"月"+day+"日开始，欢迎到时来参加！")
                    })
                }
            }
            
        }
    })    
    function toVote(id){
        window.location.href="/index.php/Vote/voteDetail.html?id="+id+"&vote_id="+vote_id;
    }
    function join(){
         window.location.href="/index.php/Vote/contribution.html?vote_id="+vote_id;
    }
    function end(){
         alert("该活动已截止投稿，欢迎下次活动时来投稿！")
    }
    function endActivity(){
         alert("该活动已结束，欢迎下次活动来参加！")
    }
    var b=null;
    function a(){
        b=setTimeout(function(){
            $(".bargain").animate({"bottom":"10px"},200,function(){
                $(".bargain").animate({"bottom":"0px"},200)
            });
            a()
        },200)
    }
    a()
    var npage=6;
     $(window).scroll(function () {
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height();
        var windowHeight = $(this).height();
        var upload_type=window.sessionStorage.getItem("status")
        if (scrollTop + windowHeight == scrollHeight) {
            $(this).scrollTop(scrollHeight - 50);
            //加载层
            layer.load();
            setTimeout(function () {
                layer.closeAll('loading');
            }, 1000);
            $.ajax({
                type:"get",
                url:"/index.php/Vote/loadVoteList",
                async: true,
                dataType:"json",
                data:{
                    vote_id:vote_id,
                    page:npage
                },
                success:function(data){
                    if(data.status==1){
                        var data=data.data;
                        var joinUser=data.joinUser;
                        var joinUserLength=data.joinUser.length;
                        if(joinUserLength==0){
                            $(".alert").html("")
                            $(".alert").text("没有更多了")
                         
                        }
                         var voteStatus=$(".voteStatus").val()
                        // 图片数据
                        if(upload_type==1){
                            for(var i=0;i<joinUserLength; i++){
                                 $("#content").append(
                                    '<li onclick="toVote('+joinUser[i].id+')" id="'+joinUser[i].id+'" class="box">'+
                                        '<div class="img">'+
                                             '<img class="lazy" alt="" src="'+joinUser[i].path+'" alt="" onload="water()">'+
                                             '<img class="greenTap" src="../../../../Public/images/greenTap.png"/>'+
                                             '<span class="order">1号</span>'+
                                             // '<span>'+joinUser[i].id+'</span>'+
                                        '</div>'+
                                        '<p class="name">作品名称：<span>'+joinUser[i].title+'</span></p>'+
                                        '<p>作品作者：<span>'+joinUser[i].username+'</span></p>'+
                                        '<div class="text">'+
                                            '<span class="getNum"><strong>'+joinUser[i].vote_count+'</strong>票</span>'+
                                            '<span class="vote">给TA投票</span>'+
                                        '</div>'+
                                    '</li>')
                            }
                            $("img.lazy").lazyload({effect: "fadeIn"});
                        }
                        // 视频数据
                        if(upload_type==2){
                            for(var j=0;j<joinUserLength; j++){
                                 $("#content").append(
                                    '<li onclick="toVote('+joinUser[j].id+')" id="'+joinUser[j].id+'" class="box">'+
                                        '<div class="img">'+
                                             '<img src="'+joinUser[j].path+'" alt=""></img>'+
                                             // '<span>'+joinUser[i].id+'</span>'+
                                        '</div>'+
                                        '<p class="name">作品名称：<span>'+joinUser[j].title+'</span></p>'+
                                        '<p>作品作者：<span>'+joinUser[j].username+'</span></p>'+
                                        '<div class="text">'+
                                            '<span class="getNum"><strong>'+joinUser[j].vote_count+'</strong>票</span>'+
                                            '<span class="vote">给TA投票</span>'+
                                        '</div>'+
                                    '</li>')
                            } 
                            $("img.lazy").lazyload({effect: "fadeIn"});
                            $("#content li:even").css("margin-right","4%")
                        }
                        if(voteStatus==1){
                            $(".vote").hide();
                            $(".getNum").css("float","none")
                            $(".getNum").css("margin-left","0")
                            $(".text").css("textAlign","center")
                        }
                   
                    }

                   
                }
            })
            npage+=6;
        }
         
    })
</script>
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->

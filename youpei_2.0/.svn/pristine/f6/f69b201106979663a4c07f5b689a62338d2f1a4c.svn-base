<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<!-- 投稿 -->
<div id="upload_contribution" style="display: none;">
    <form action="/index.php/Vote/contribution" enctype="multipart/form-data" method="post">
        作品名：<input type="text" name="title"/>
        作者：<input type="text" name="username"/>
        联系电话：<input type="text" name="mobile"/>
        <input type="file" name="image"/>
        <input type="submit" value="提交">
    </form>
</div>

<!-- 作品列表 -->
<ul id="contribution_list">

</ul>
<script type="text/javascript" src="/Public/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript">
    $(function () {
        var param = GetRequest();
        var url = "/index.php/Vote/ajaxVoteDetail";
        $.get(url, param, function (result) {
//            status 0:报错 1:投稿中 2:截止投稿 3:投票中 4:截止投票 5:发布结果 6:结束
            switch (result.status) {
                case 0 :
                    alert(result.message);
                    break;
                case 1:
                    $("#upload_contribution").show();
                    break;
                case 2:
                    //todo
                    break;
                case 3:
                    if (result.data.type == 1) { //图片
                        $.each(result.data.contributions, function (index, value) {
                            $("#contribution_list").append(
                                    "<li>" +
                                    "<img src='" + value.path + "' style='width:13rem;height:17.5rem;'>" +
                                    "<p style='font-size:3rem;'>" + value.title + "</p>" +
                                    "<a href='javascript:toVote(" + value.id + ")' style='font-size:2rem;text-align: center;'>投我一票</a>" +
                                    "</li>"
                            );
                        });
                    }
                    if (result.data.type == 2) { //视频
                        //todo
                    }
            }

        }, 'json');
    });

    //    获取url参数
    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }

    //    投票
    function toVote() {
        var url = "/index.php/Vote/";
    }
</script>
</body>
</html>
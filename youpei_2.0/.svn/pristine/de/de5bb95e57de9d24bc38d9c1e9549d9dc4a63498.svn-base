<include file="Common:header"/>
<link href="__PUBLIC__/Home/css/buy.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/comment.css">
<style>
    .isCollect:before {
        color: #f56b85;
    }

    .isCollect {
        display: inline-block;
        width: 25%;
        margin-left: 5%;
        position: relative;
        color: #f56b85;
    }

    .follow {
        display: inline-block;
        width: 25%;
        margin-left: 5%;
        position: relative;
    }
</style>
<div id="detail_activity" class="kap-page kap-page-current">
    <div class="kap-top ty-menu-top">
        <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
            <span class="title">{$group['title']}<span class="num"></span></span>
            <a href="javascript:void(0);" onclick="history.go(-1);" class="btn left btn-user" title="返回"
               data-icon="ɒ"></a>
        </div>
    </div>
    <div class="ty-page">
        <div class="ty-detail-cover">
            <span class="thumb"
                  style="background-image:url({$group['image']}); background-size:cover"></span>
                <span class="desc-top">
                    <span data-icon="Ć" class="loc"></span>
                </span>
            <div class="desc row">
                <span class="status">组团价: {$group['price']}元</span>
                <div class="tags">
                    <notempty name="group['tagA']"><span class="tag purple">{$group['tagA']}</span></notempty>
                    <notempty name="group['tagB']"><span class="tag orange">{$group['tagB']}</span></notempty>
                    <notempty name="group['tagC']"><span class="tag yellow">{$group['tagC']}</span></notempty>
                    <label class="size red">原价：{$group['original_price']}元</label>
                </div>
            </div>
            <!--<div class="introduce">-->
            <!--<span><nobr>简介：而最引人关注的就是这两年兴起的研学夏令营了。而最引人关注的就是这两年兴起的研学夏令营了。</nobr></span>-->
            <!--</div>-->
            <!--    <span class="share-invite">邀请好友</span> -->
            <div class="border item curriculum">
                <i class="icon1"></i>
                <label>课程表</label>
                <span class="tip" data-icon-after="Ĩ"></span>
            </div>
            <div class="border item peo">
                <b>已有{$userCount}人报名</b>
                <span class="pro" onclick="checkOrderInfo()">立即加入</span>
            </div>
            <div class="clear"></div>
            <div class="border item company" onclick="organ({$organization['id']})">
                <i class="icon2"></i>
                <label>教学单位</label>
                <span class="tip" data-icon-after="Ĩ"></span>
                <a class="lj"><b>了解更多</b></a>
            </div>

            <div class="mechanism">
                <img src="{$organization['picture']}">
                <span>{$organization['org_name']}</span>
                <div class="score" id="descs" style="line-height: 1.3rem;">
                    <span>机构评级</span>
                 <span class="star" data-ty-talent-star="5">
                     <for name="$organization['org_star']" start="0" end="$organization['org_star']" step="1">
                         <i class="on iconfont">Ŧ</i>
                     </for>
                    </span>
                    <span>环境评级</span>
                 <span class="star" data-ty-talent-star="5">
                    <for name="$organization['env_star']" start="0" end="$organization['env_star']" step="1">
                        <i class="on iconfont">Ŧ</i>
                    </for>
                    </span>
                    <span>教学质量</span>
                 <span class="star" data-ty-talent-star="5">
                     <for name="$organization['quality_star']" start="0" end="$organization['quality_star']" step="1">
                         <i class="on iconfont">Ŧ</i>
                     </for>
                    </span>
                </div>
            </div>
        </div>
        <div class="act-tag fixed">
            <a href="javascript:;" id="desc" class="tag detail on">详情</a>
            <a href="javascript:;" id="costc" class="tag price">费用说明</a>
            <a href="javascript:;" id="comment" class="tag qa">咨询&amp;评价</a>
        </div>
        <div class="ty-detail-content">
            <div class="article-title" id="kcxq">
                <span class="title">课程详情</span><img src="__PUBLIC__/images/xianqin.png" height="72" class="kcxq">
            </div>
            <div class="article top">
                <div class="text">{$group['description']}
                    <div id="costs" style="height: 95px;"></div>
                </div>
            </div>
            <div class="article-title"><span data-icon="Ĺ" class="title">费用说明</span><img
                    src="__PUBLIC__/images/xianqin.png" height="72" class="kcxq"></div>
            <div class="article">
                <div class="text">{$group['cost']}</div>
            </div>

            <div class="fav-list">
                <volist id="val" name="headImg" offset="0" length="12">
                    <span class="avatar">
                       <img src="{$val['headImg']}">
                    </span>
                </volist>
                <span class="sum">本次活动共有{$userCount}人已下单</span>
            </div>
            <a data-icon="Ė" class="btn-continue" id="comments"
               href="{:U('Groups/checkOrderInfo',array('groupRecordId' => $groupRecordId))}">赶紧下单</a>
            <div class="article-title article-title2"><span data-icon="ŕ" class="title">咨询&amp;评价</span><img
                    src="__PUBLIC__/images/xianqin.png" height="72" class="kcxq"></div>
            <div class="article">
                <button type="button" class="btn-comment" data-icon="Ę">说点什么..</button>
                <ul class="list-comment">
                    <volist id="val" name="commentList" offset="0" length="15" key="k">
                        <li class="item">
                            <div class="user-comment" onclick="getFather({$val['id']})">
                                <img src="{$val['headImg']}" alt="">
                                <span class="text">{$val['content']}</span>
                            </div>
                            <div class="replys">
                                <volist id="va" name="val['child']">
                                    <div class="reply" onclick='getFatherId("{$va['id']}","{$val['id']}")'>

                                    <div class="image"><img src="{$va['headImg']}" alt="">回复：<img src="{$va['headImgs']}" alt=""></div>

                                    <span class="text">{$va['content']}</span>
                                    </div>
                                </volist>
                            </div>
                        </li>
                    </volist>
                    <!--<li data-icon="Ĩ" class="item-more">-->
                    <!--更多评论-->
                    <!--</li>-->
                </ul>
            </div>
            <!-- 20160218 upadte -->
            <!-- 20160218 upadte end-->
            <span class="ty-reload" onclick="window.location.reload();" data-icon="ɇ">刷新本页面</span>
        </div>

    </div>

</div>
<div class="kap-bottom ty-menu-bottom">
    <div id="tools_detail_activity" class="ty-tools ty-tools-order ty-tools-current">
        <div class="ty-tools-detail-btns">
            <a href="tel:13149069132" data-ty-target="#page_talent_msg" data-ty-tid="0" data-ty-pid="0"
               class="btn btn-detail consult">
                <i class="icon3"></i><br>
                咨询</a>
            <a href="javascript:void(0);" class="btn-detail phone">
                <i class="icon4"></i><br>
                看机构</a>
            <a href="javascript:void(0);" data-ty-target="#page_talent" data-ty-talentid=""
               class="btn-detail shop">
                <i class="icon5"></i><br>
                推荐</a>
            <a href="{:U('Groups/checkOrderInfo',array('groupRecordId' => $groupRecordId))}" class="btn-order">我要报名</a>
        </div>
    </div>
</div>

<div data-kap="kap-bottomwin" class="kap-bottomwin" style="display:none;">
    <div class="kap-hitarea"></div>
    <div class="kap-win"
         style="transform: translateY(0px); transition: -webkit-transform 0.2s cubic-bezier(0, 0, 0.25, 1);">
        <div class="kap-content">
            <div class="ty-popbottom">
                <div class="title">
                    发表评论
                    <span class="ask-kf">
                        <span><span class="btn-close" data-icon="ă"></span></span>
                    </span>
                </div>
                <div class="content" style="height: 5.625rem;">
                    <div class="ty-comment-pop">
                        <input type="hidden" name="group_id" value="{$group['id']}">
                        <textarea class="input-textarea btn-comment" id="product_contact_memo"
                                  placeholder="说点什么.."></textarea>
                    </div>
                </div>
                <div class="btn-submit" id="addProduct">确定</div>
            </div>
        </div>
    </div>
</div>
<div data-kap="_kap_mask" class="kap-mask kap-mask-on" style="display:none;"></div>

<div class="kap-comment" style="display:none;">
    <div class="kap-hitarea"></div>
    <div class="kap-win"
         style="transform: translateY(0px); transition: -webkit-transform 0.2s cubic-bezier(0, 0, 0.25, 1);">
        <div class="kap-content">
            <div class="ty-popbottom">
                <div class="title">
                    发表评论
                    <span class="ask-kf">
                        <span><span class="btn-close" data-icon="ă"></span></span>
                    </span>
                </div>
                <div class="content" style="height: 5.625rem;">
                    <div class="ty-comment-pop">
                        <textarea class="input-textarea " id="product_contact_meto"
                                  placeholder="说点什么.."></textarea>
                    </div>
                </div>
                <div class="btn-submit" id="addComment" attr_father_id="" attr_type_id="">确定</div>
            </div>
        </div>
    </div>
</div>
<div data-kap="_kap_mask" class="kap-mask  kap-background" style="display:none;"></div>
<script>
    $(".act-tag span").on('touchstart mousedown', function (e) {
        e.preventDefault()
        $(".act-tag span").removeClass('on')
        $(this).addClass('on')
        $(".ty-detail-content .tabcon").eq($(this).index()).addClass("curr").siblings().removeClass("curr");
    });
    $(".act-tag span").click(function (e) {
        e.preventDefault();
    });
    $(function () {
        $('.act-tag span').on('touchstart mousedown', function () {
            $('html,body').animate({scrollTop: $('.act-tag').offset().top - 60}, 500);
        });
    });
    $(window).scroll(function () {
        var bar_h = $(".act-tag").height();
        var _top = $(window).scrollTop();
        var tag_top = $("#detail_activity .ty-detail-cover").offset().top + $("#detail_activity .ty-detail-cover").height();
        if (tag_top - _top < bar_h) {
            $(".act-tag").addClass("fixed");
            if ($(".kap-top").hasClass("ty-menu-top-hide")) {
                $(".act-tag").addClass("top");
            } else {
                $(".act-tag").removeClass("top");
            }
        } else {
            $(".act-tag").removeClass("fixed");
        }
    });
    $('#addProduct').click(function () {
        if ($('#product_contact_memo').val() == '') {
            alert('请填写订单评价');
            return;
        }
        if ($('#product_contact_memo').val().length <= 6) {
            alert('请填写不少于6个字');
            return;
        }
        var group_id = $("input[name='group_id']").val();
        var url = "{:U(Groups/getGroup)}";
        var data = {
            group_id: group_id,
            content: $('#product_contact_memo').val()
        };
        $.post(url, data, function (res) {
            if (res.status == 0) {
                return alert(res.msg);
            } else if(res.status == 1){
                alert(res.msg);
                $('.kap-bottomwin').css('display', 'none');
                $('.kap-mask-on').css('display', 'none');
                $("#product_contact_memo").val('');
                $('.list-comment').append(
                        "<li class='item assign'>" +
                        "<div class='user-comment' onclick='getFather(" + res.data['id'] + ")'>"+
                        "<img src='" + res.data['headImg'] + "' alt=''><span class='text'>" + res.data['content'] + "</span>"+
                        "</div>"+
                        "<div class='replys'></div>"+
                        "</li>"
                );
            }
        }, 'json');
    });
    //留言弹框
    $(function () {
        $('.btn-comment').click(function () {
            $('.kap-bottomwin').css('display', 'block');
            $('.kap-mask-on').css('display', 'block');
        });
        $('.btn-close').click(function () {
            $('.kap-bottomwin').css('display', 'none');
            $('.kap-mask-on').css('display', 'none');
        });
    });
    //页内跳转
    $(document).ready(function () {
        $("#desc").click(function () {
            $('html, body').animate({
                scrollTop: $("#descs").offset().top
            }, 1000);
        });
        $("#costc").click(function () {
            $('html, body').animate({
                scrollTop: $("#costs").offset().top
            }, 1000);
        });
        $("#comment").click(function () {
            $('html, body').animate({
                scrollTop: $("#comments").offset().top
            }, 500);
        });
    });

    function checkOrderInfo() {
        window.location.href = "{:U('Groups/checkOrderInfo',array('groupRecordId' => $groupRecordId))}";
    }

    $('.item').click(function () {
        $(this).addClass('assign');
        $(this).siblings('.item').removeClass('assign')
    });

    function getFather(id) {
        $('.kap-background').css('display', 'block');
        $('.kap-comment').css('display', 'block');
        $('.btn-close').click(function () {
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
        });
        $('#addComment').attr('attr_father_id',id);
    }

    function getFatherId(id,type_id) {
        $('.kap-background').css('display', 'block');
        $('.kap-comment').css('display', 'block');
        $('.btn-close').click(function () {
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
        });
        $('#addComment').attr('attr_father_id',id);
        $('#addComment').attr('attr_type_id',type_id);

    }

    $('#addComment').click(function () {
        if ($('#product_contact_meto').val() == '' && $('#product_contact_meto').val() > 0) {
            alert('内容不能为空');
            return;
        }
        if ($('#product_contact_meto').val().length <= 6) {
            alert('请填写不少于6个字');
            return;
        }
        if($('#addComment').attr('attr_father_id') != '' && $('#addComment').attr('attr_type_id') == ''){
            var url = "{:U('Groups/comment')}";
            var group_id = $("input[name='group_id']").val();
            var father_id = $('#addComment').attr('attr_father_id');
            var type_id = $('#addComment').attr('attr_father_id');
            var data = {
                group_id : group_id,
                father_id : father_id,
                type_id : type_id,
                content : $('#product_contact_meto').val()
            };
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
            $.post(url, data, function (res) {
                if (res.status == 0) {
                    alert(res.msg);
                } else if (res.status == 1) {
                    alert(res.msg);
                    $('.assign .replys').append(
                            "<div class='reply' onclick='getFatherId("+ res.data['id'] +","+ res.data['type_id'] +")'>" +
                            "<div class='image'><img src='" + res.data['headImg'] + "' alt=''>回复：<img src='" + res.data['headImgs'] + "' alt=''></div><span class='text'>" + res.data['content'] + "</span>" +
                            "</div>"
                    );
                }
            }, 'json');
        }else if($('#addComment').attr('attr_father_id') != '' && $('#addComment').attr('attr_type_id') != '') {
            var url = "{:U('Groups/comment')}";
            var group_id = $("input[name='group_id']").val();
            var father_id = $('#addComment').attr('attr_father_id');
            var type_id = $('#addComment').attr('attr_type_id');
            var data = {};
            data.group_id= group_id;
            data.father_id= father_id;
            data.type_id = type_id;
            data.content= $('#product_contact_meto').val();
            $('.kap-background').css('display', 'none');
            $('.kap-comment').css('display', 'none');
            $("#product_contact_meto").val('');
            $.post(url, data, function (res) {
                if (res.status == 0) {
                    alert(res.msg);
                } else if (res.status == 1) {
                    alert(res.msg);
                    $('.assign .replys').append(
                            "<div class='reply' onclick='getFatherId("+ res.data['id'] +","+ res.data['type_id'] +")'>" +
                            "<div class='image'><img src='" + res.data['headImg'] + "' alt=''>回复：<img src='" + res.data['headImgs'] + "' alt=''></div><span class='text'>" + res.data['content'] + "</span>" +
                            "</div>"
                    );
                }
            }, 'json');
        }
    })
    //    机构
    function organ(id) {
        window.location.href = "{:U('Organization/home')}?id=" + id;
    }
</script>

<include file="Common:footer"/>
</body>
</html>
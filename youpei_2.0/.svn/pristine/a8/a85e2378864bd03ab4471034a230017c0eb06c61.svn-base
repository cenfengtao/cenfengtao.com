<include file="Common:header"/>
<style type="text/css">
    .layui-layer-title {
        height: 2.5rem;
        font-size: 1rem;
        line-height: 2.5rem;
    }

    .layui-layer-setwin {
        /*display: none;*/
    }
    .kap-page{
        background-color: #f1f1f1!important;
    }
    .surplus{
        margin-top: 2.8rem!important;  
    }
    .light{
        height: 13px;
        background-color: #f1f1f1;
        width: 100%;
    }
</style>
<div id="page_user" title="{$title}" class="kap-page kap-page-current">
    <div class="kap-top ty-menu-top">
        <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
            <span class="title">幸运大抽奖<span class="num"></span></span>
            <a href="javascript:history.go(-1);" class="btn left btn-user" title="返回" data-icon="ɒ"></a>
            <a href="{:U('Index/index',array('current'=>'1'))}" class="btn right btn-user" title="返回首页"
               data-icon="Ņ"></a>
        </div>
    </div>
    <section class="scroll">
        <div class="main">
            <div class="demo">
                <input type="hidden" name="activityid" id="activityid" value="{$activityid}">
                <input type="hidden" name="token" id="token" value="{$token}">
                <div class="surplus">剩余抽奖次数<span id="lotteryCount">{$lotteryCount|default='0'}</span><label class="rule"  id="exchangelott"
                    onclick="exchange()">抽奖规则</label>
                </div>
                <div class="light"></div>
                <ul id="prize" class="prize">
                    <li class="prize1" title="点击抽奖"></li>
                    <li class="prize2" title="点击抽奖"></li>
                    <li class="prize3" title="点击抽奖"></li>
                    <li class="prize4" title="点击抽奖"></li>
                    <li class="prize5" title="点击抽奖"></li>
                    <li class="prize6" title="点击抽奖"></li>
                    <div style="clear:both"></div>
                </ul>
                <div style="clear:both; margin-top:0px"></div>
                <div style="margin-top:1vh;">
                    <a href="javascript:void(0)" id="viewother">翻开其他</a>
                </div>
                <a href="javascript:void(0);" id="repeat"></a>
                <div id="data"></div>
                <div class="lottery-status">
                    <p id="status" style="text-align: center;">陛下，请翻牌~</p>
                </div>
                <!--  <div class="lottery-prize">恭喜抽中<span id="lotteryCount">{$lotteryCount|default='0'}微信2元红包</span><label class="receive">领奖</label></div> -->
                <!--  <p style="text-align: center;font-size:3vh;margin-top:2%;">你还可以抽
                     <span style="color:red" id="lotteryCount">{$lotteryCount|default='0'}</span>次
                 </p>
                 <p style="text-align: center;font-size:2vh;margin-top:1vh;">好友助力总次数<span style="color:red">{$total_scan}</span>次  &nbsp;
                     再助力<span style="color:red;">{$needScan}</span>次又能获得<span style="color:red;">1</span>次抽奖</p>-->
                <!--  <p style="width:16vh;text-align: center;height:5vh;line-height: 5vh;font-size:3vh;margin:0 auto;
                 background: #4daf7c;border:3px solid #00833f;border-radius: 5px;color:white;margin-top:3%" id="explain">
                     抽奖说明</p>
                 <p style="text-align: center"><a href="{:U('Lottery/lottery_record')}" id="history">抽奖记录</a></p> -->
                <!--   <div class="border">
                  <table border="1">
                  <tr>
                    <td><span><a href="{:U('Lottery/lottery_record')}">我的奖品</a></span></td>
                    <td><span><a href="{:U('Lottery/userAddress')}">地址管理</a></span></td>
                    <td><span id="explain"><a href="{:U('Lottery/rule')}">更多抽奖机会</a></span></td>
                  </tr>
                  </table>
                  </div> -->
                <div class="winners">
                    <span>—— 恭喜中奖者 ——</span>
                </div>
                <div id="scrollDiv">
                    <div class="scrollText">
                        <ul>
                            <volist name="re" id="vo" mod="2">
                                <li>
                                    <nobr><span>{$vo['username']}获得{$vo['prize']}</span></nobr>
                                </li>
                            </volist>
                        </ul>
                    </div>
                </div>
                <!-- 广告位置 -->
                <div class="adverts-img">
                    <a href="{$config['over_adv_link']}">
                        <img src="{$config['over_adv']}" width="100%" height="250">
                    </a>
                </div>
            </div>
        </div>
    </section>
    <div class="kap-bottom ty-menu-bottom">
        <div id="tools_idx" class="ty-tools ty-tools-idx ty-tools-current">
            <a href="{:U('Lottery/lottery_record')}">我的奖品</a>
            <i class="border"></i>
            <a href="{:U('Lottery/userAddress')}">地址管理</a>
            <i class="border"></i>
            <a href="{:U('Lottery/rule',array('token'=>$token,'activityid'=>$activityid))}">抽奖规则</a>
        </div>
    </div>
</div>

<script src="http://www.sucaihuo.com/Public/js/other/jquery.js"></script>

<include file="Common:footer"/>
<script src="__PUBLIC__/Home/js/jquery-ui-1.7.2.custom.min.js"></script>
<script src="__PUBLIC__/Home/js/jquery.flip.min.js"></script>
<script>
    $(function () {
        $("#prize li").each(function () {
            var p = $(this);
            p.css("background", "url(__PUBLIC__/images/lottery_change01.png) no-repeat").css("background-size", '100% 100%');
            p.click(function () {
                //判断是否有抽奖次数
                var count = $("#lotteryCount").text();
                if (parseInt(count) <= 0) {
                    return alert("点击下方抽奖说明获取更多抽奖机会");
                }
                $("#status").text("正在抽奖中...");
                $("#prize li").unbind('click'); //连续翻动
                var params = {};
                params.token = $('#token').val();
                params.activityid = $('#activityid').val();
                $.getJSON("{:U('Lottery/lottery')}", params, function (json) {
                    if (json.status == -1) {
                        $("#status").text('抽奖失败');
                        return alert(json.msg);
                    }
                    var prize = json.msg.yes['title']; //抽中的奖项
                    var pic = json.msg.yes['pic']; //抽中的pic地址
                    var prizeid = json.msg.yes['prizeid'];
                    var pid = json.msg['pid'];
                    var token = $('#token').val();
                    p.flip({
                        direction: 'rl', //翻动的方向rl：right to left
                        speed: 200,
//                        content: prize, //翻转后显示的内容即奖品
                        onEnd: function () { //翻转结束
                            p.css({
                                "background": "url(/" + pic + ") no-repeat",
                                "background-size": "100% 100%"
                            });
                            p.attr("id", "r"); //标记中奖方块的id
//                            $("#viewother").show(); //显示查看其他按钮
                            $("#prize li").unbind('click').css("cursor", "default").removeAttr("title");
                        }
                    });
                    $("#repeat").css('display', 'block');
                    if (json.status == 2) {
                        setTimeout(function () {
                            layer.open({
                                cornerRadius: 8,
                                type: 2 //Page层类型
                                ,
                                skin: 'layer-MyClass'
                                ,
                                area: ['100%', '100%']
                                ,
                                title: "获得了 " + json.msg.yes['title'] + ""
                                ,
                                shade: 0.9 //遮罩透明度
                                ,
                                anim: 1 //0-6的动画形式，-1不开启
                                ,
                                maxmin: true
                                ,
                                content: ["{:U('Lottery/userinfo')}?prizeid=" + prizeid + "&token=" + token + "&pid=" + pid, 'no']
                            });
                        }, 1500);

                    }
                    //临时活动
                    if (prize == "电影券") {
                        $("#status").text("微信添加\"youpeikefu01\"发送数字“1”登记领奖！").css({
                            'color': 'red',
                            'font-size': '1.8vh'
                        });
                    } else if (prize.indexOf("邦宝") >= 0) {
                        $("#status").text("微信添加\"youpeikefu01\"发送数字“1”登记领奖！").css({
                            'color': 'red',
                            'font-size': '1.8vh'
                        });
                    } else {
                        $("#status").text("恭喜你，抽中了" + prize).css({'color': 'red', 'font-size': '2.5vh'});
                    }
                    $("#lotteryCount").text(count - 1); //减少抽奖次数
//                    $("#data").data("nolist", json.msg.no); //保存未中奖信息

                    setTimeout(function () {
                        var mydata = json.msg.no; //获取数据
                        var mydata2 = eval(mydata);//通过eval()函数可以将JSON转换成数组
                        $("#prize li").not($('#r')[0]).each(function (index) {
                            var pr = $(this);
                            pr.flip({
                                direction: 'bt',
                                speed: 200,
                                onEnd: function () {
                                    pr.css({

                                        "background": "url(/" + mydata2[index]['pic'] + ") no-repeat",
                                        "background-size": "100% 100%",
                                        'opacity': '0.5',
                                    });
                                }
                            });
                        });
                        $("#data").removeData("nolist");
                    }, 1000);
                });
            });
        });
        $("#repeat").click(function () {
            window.location.href = window.location.href + "&id=" + 10000 * Math.random();
        });
        // $("#explain").click(function () {
        //     layer.open({
        //         cornerRadius: 8,
        //         type: 1 //Page层类型
        //         , skin: 'layer-MyClass'
        //         , area: ['80%', '50%']
        //         , title: '规则说明'
        //         , shade: 0.5 //遮罩透明度
        //         , anim: 5 //0-6的动画形式，-1不开启
        //         , content:
        //         '<p style="text-indent:20px;">1、通过分享抢课活动的专属海报(公众号菜单栏->红包提现->生成海报)，邀请好友助力扫码关注平台，每5次助力可获得1次抽奖机会</p>' +
        //         '<p style="text-indent:20px;">2、通过每日登陆优培圈平台签到可获得一次抽奖机会</p>' +
        //         '<p style="text-indent:20px;">3、奖品兑换按优培圈平台实际操作规定执行。</p>' +
        //         '<p style="text-indent:20px;">4、任何人不得利用平台技术漏洞或规则漏洞进行恶意攻击。使用攻击手段获得的抽奖次数，优培圈有权单方面予以修正。</p>'+
        //         '<p style="text-indent:20px;">5、优培圈平台对此规则拥有最终解释权。</p>'
        //     });
        // });
    });
    var bool=true;
    function exchange() {
        if(bool){
            bool=false;
            layer.open({
            type: 2,
            title: '兑换抽奖次数',
            shadeClose: false,
//          maxmin: true,
			closeBtn:1,
            shade: 5,
            area: ['80%', '50%'],
            content: ["{:U('Lottery/exchange')}", 'no'],
            cancel: function(){ 
                    bool=true;
                 }
            })
        }
    
    }
</script>
<script src="__PUBLIC__/Home/js/jQuery.textSlider.js"></script>
<script type="text/javascript">
    // $(function(){
    //     $(".scrollText ul li:old").css("background-color","#fefefe");

    //     $(".scrollText ul li:even").css("background-color","#f0f1f1");

    // })
    $(document).ready(function () {
        $("#scrollDiv").textSlider({line: 2, speed: 400, timer: 3000});
        $(".scrollText ul li").css("background-color","#f0f1f1");
        
        $(".scrollText ul li:even").css("background-color","#fefefe");
    })
</script>
</body>
</html>


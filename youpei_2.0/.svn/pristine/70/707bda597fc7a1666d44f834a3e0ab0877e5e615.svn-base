<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>投票活动</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/pageloader.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/voteList.css"/>
    <script type="text/javascript">
        if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
    </script>
    <!--  <script>
         var _hmt = _hmt || [];
         (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?548e13b07cb36e38bfd73870368a0253";
           var s = document.getElementsByTagName("script")[0];
           s.parentNode.insertBefore(hm, s);
         })();
     </script> -->
</head>
<body class="kap-loading ty-view-all">
<include file="Common:common"/>
<header class="header">
    <a href="javascript:history.back()" class="back">
        <img src="../../../../Public/images/back.png" alt="">
    </a>
    <h3>投票活动</h3>
    <a href="../Index/index.html" class="home" data-icon="Ņ"></a>
</header>
<article class="middle">
    <section class="advert">
        <img src="../../../../Public/images/advert.jpg" alt="">
    </section>
    <section class="people">
        <ul>
            <li>
                <span>已报名</span>
                <span><strong class="join">0</strong>人</span>
            </li>
            <li>
                <span>累计投票</span>
                <span><strong class="total">0</strong>票</span>
            </li>
            <li>
                <span>访问量</span>
                <span><strong class="access">0</strong>次</span>
            </li>
        </ul>
    </section>
    <section class="worksList">
        <ul class="vote-list">
        </ul>
    </section>
    <section class="joinWorks" style="display: none;">
        <a href="javascript:void(0)" onclick="join()">我也要参加</a>
    </section>
</article>
<footer class="footer">
    <ul class="icon">
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/voteList.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon1.png"/>
                <span>作品库</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userVote.html">
                <img src="__PUBLIC__/images/voteIcon2.png"/>
                <span>我的投票</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userWorks.html">
                <img src="__PUBLIC__/images/voteIcon3.png"/>
                <span>我的作品</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userBillboard.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon4.png"/>
                <span>榜单</span>
            </a>
        </li>
    </ul>
</footer>
<script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/voteList.js" type="text/javascript" charset="utf-8"></script>
<script>
    // $(function () {
    //     $.get("/index.php/Vote/ajaxVoteList", function (result) {
    //         if (result.status == 0) {
    //             return alert(result.message);
    //         } else {
    //             $.each(result.data,function (index,item) {
    //                 $('.vote-list').append(
    //                         "<li onclick='getDetail("+item['id']+")'>"+item['title']+"</li>"
    //                 );
    //             })
    //         }
    //     }, 'json');
    // });
    // function getDetail(id) {
    //     window.location.href = "http://www.baidu.com?id="+id;
    // }
    function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}
var id=GetRequest().vote_id;
    $.ajax({
        type:"get",
        url:"/index.php/Vote/ajaxVoteList",
        async: true,
        dataType:"json",
        data:{
            vote_id:id
        },
        success:function(data){
            if(data.status==0){
                setTimeout(function(){
                     alert(data.message)
                     history.back()
                },1000) 
            }
            if(data.status==1){
                $(".advert img").attr("src",data.data.background)
                var joinSum=data.data.joinSum;
                var visitSum=data.data.visitSum;
                var voteSum=data.data.voteSum;
                var joinUser=data.data.joinUser;
                var joinUserLength=joinUser.length;
                var upload_type=data.data.upload_type;
                if(data.data.isContribute==1){
                    $(".joinWorks").hide();
                }
                if(data.data.isContribute==2){
                    $(".joinWorks").show();
                }
                if(data.data.voteStatus==1){
                    setTimeout(function(){
                         alert("该活动已结束，欢迎下次来参加!")
                    })
                }
                if(data.data.voteStatus==2){
                    $(".join").html(joinSum);
                    $(".total").html(voteSum);
                    $(".access").html(visitSum);
                    // 图片数据
                    if(upload_type==1){
                        for(var i=0;i<joinUserLength; i++){
                            $(".vote-list").append(
                                '<li>'+
                                    '<div class="img">'+
                                         '<img src="'+joinUser[i].path+'" alt="">'+
                                    '</div>'+
                                    '<p class="name">名称：<span>'+joinUser[i].title+'</span></p>'+
                                    '<p>作者：<span>'+joinUser[i].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span>共<strong>'+joinUser[i].vote_count+'</strong>票</span>'+
                                        '<span class="vote" onclick="toVote('+joinUser[i].id+')">为TA投票</span>'+
                                    '</div>'+
                                '</li>'
                            )
                        }
                    }
                    // 视频数据
                    if(upload_type==2){
                        for(var j=0;j<joinUserLength; j++){
                            $(".vote-list").append(
                                '<li>'+
                                    '<div class="img">'+
                                         '<video src="'+joinUser[j].path+'" alt="" autoplay></video>'+
                                         // '<div class="play">'+
                                         //    '<img src="../../../../Public/images/play.png" alt="">'+
                                         // '</div>'+
                                    '</div>'+
                                    '<p class="name">名称：<span>'+joinUser[j].title+'</span></p>'+
                                    '<p>作者：<span>'+joinUser[j].username+'</span></p>'+
                                    '<div class="text">'+
                                        '<span>共<strong>'+joinUser[j].vote_count+'</strong>票</span>'+
                                        '<span class="vote" onclick="toVote('+joinUser[j].id+')">为TA投票</span>'+
                                    '</div>'+
                                '</li>'
                            )
                        } 
                    }
                }

            }
            
        }
    })    
    // $(function(){
    //     $(".vote").bind("click",function(){
    //         $(this).unbind('click');
    //         var number=parseInt($(this).prev().find("strong").html())
    //         number+=1;
    //         $(this).prev().find("strong").html(number)
    //         $.ajax({
    //             type:"post",
    //             url:"/index.php/Vote/ajaxContribution",
    //             async: true,
    //             dataType:"json",
    //             data:{

    //             },
    //             success:function(){

    //             }
    //         })
    //     })
    // })
    function toVote(id){
        window.location.href="/index.php/Vote/voteDetail.html?id="+id;
    }
    function join(){
         window.location.href="/index.php/Vote/contribution.html?vote_id="+id;
    }
</script>
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->

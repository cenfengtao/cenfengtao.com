<include file="Common:header"/>
<link rel="stylesheet" href="__PUBLIC__/Home/css/style_v3.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/new.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/new_menu.css">
<style>
    .list .empty{
        text-align: center;
        line-height: 2.3rem;
    }
</style>
<div id="page-user" title="{$title}" class="kap-page kap-page-current">
    <div class="kap-top ty-menu-top">
        <div id="tools-msg" class="ty-tools ty-tools-inner ty-tools-current">
            <span class="title">{$title}<span class="num"></span></span>
            <a href="javascript:void(0);" onclick="history.go(-1);" class="btn left btn-user" title="返回" data-icon="ɒ"></a>
            <a href="{:U('Index/index')}" class="btn right btn-user" title="返回首页" data-icon="Ņ"></a>
            <!--<a href="" class="saixuan"><img src="__PUBLIC__/images/saixuan.png" alt="">筛选</a>-->
        </div>
    </div>
    <div class="kap-wrap">
        <div id="page_hot" title="热推" class="kap-page kap-page-current"
             data-ty-tools="#tools_hot,#tools_idx,#side_common">
            <div class="ty-page">
                <div class="ty-cat-tags">
                    <ul class="list-rec">
                        <li class="item">
                            <div class="ty-rec-view ty-sc-h">
                                <foreach name="cateList" item="vo" key="k">
                                    <span attr_id="{$vo['id']}" class=" <if condition=" $cateId eq $vo['id']">on</if>"
                                    onclick="getCateListById({$vo['id']})">{$vo.title}</span>
                                </foreach>
                            </div>
                        </li>
                    </ul>
                    <foreach name="cateList" item="vo" key="k">
                        <span attr_id="{$vo['id']}" class="tag link <if condition=" $cateId eq $vo['id']">on</if>"
                        onclick="getCateListById({$vo['id']})">{$vo.title}</span>
                    </foreach>
                </div>
                <div class="timeline-product" style="margin-top:74px;padding-top: 106px;">
                    <ul class="list-card-timeline">
                        <volist name="articleList" id="val" offset="0" length="10">
                            <li class="item" data-ty-target="#detail_activity" onclick="getArticle({$val['id']})">
                                <span class="thumb"
                                      style="background-image:url({$val.image}); background-size:cover"></span>
                        <span class="desc">
                            <h3 class="title">{$val.title}</h3>
                            <span class="time"><span class="lef">{$val.time}</span><span class="rig">评论（{$val.count|default = 0}） <i></i> 收藏（{$val.collect|default = 0}）</span></span>
                            <span class="status dt">{$val.cate_title}</span>
                        </span>
                                <span class="icon-sale"></span>
                            </li>
                        </volist>
                    </ul>
                    <ul class="list-card-timeline list">
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部菜单 -->
    <div class="kap-bottom ty-menu-bottom" style="display: none">
        <div id="tools_idx" class="ty-tools ty-tools-idx ty-tools-current">
            <a href="{:U('Index/index',array('current'=>'1'))}" style="background: url('__PUBLIC__/images/1495008448.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%" <if condition='$current eq 1'>class="current"</if> data-icon="">首页</a>
            <!--<i class="border"></i>-->
            <a href="{:U('Discovery/index',array('current'=>'2'))}" style="background: url('__PUBLIC__/images/1495008486.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%" class="current" data-icon="" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '发现'])">发现</a>
            <!--<i class="border"></i>-->
            <a href="{:U('Association/index',array('current'=>'3'))}" style="background: url('__PUBLIC__/images/1495008503.png') no-repeat 0.7rem 1.2rem; background-size:20% 30%" <if condition='$current eq 3'>class="current"</if>  data-icon="" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '消息'])">社群<i id="new_msg_alert"></i></a>
            <!--<i class="border"></i>-->
            <a href="{:U('Personal/index',array('current'=>'4'))}" <if condition='$current eq 4'>class="current"</if> style="background: url('__PUBLIC__/images/1495008528.png') no-repeat 0.7rem 1.2rem; background-size:15% 30%" onclick="_hmt.push(['_trackEvent', 'footbar', 'click', '我的'])">个人中心</a>
        </div>
    </div>
</div>
<include file="Common:footer"/>
<script>
	
	$(function(){
		
		
//		var text=$(".dt").html();
//     if(text=="视频"){
//         $(".dt").css("background","#ea775b")
//     }
//     if(text=="育儿"){
//         $(".dt").css("background","#f59600")
//     }
//     if(text=="亲子"){
//         $(".dt").css("background","#19f724")
//     }
//     if(text=="故事"){
//         $(".dt").css("background","#1dd2a1")
//     }
//     if(text=="实验"){
//         $(".dt").css("background","#3176c3")
//     }
//     if(text=="绘本"){
//         $(".dt").css("background","#1996f7")
//     }
//     if(text=="福利"){
//         $(".dt").css("background","#ff84b0")
//     }
	})

     
     
     
     var itemL=$(".list-card-timeline li").length;
		for(var i=0; i<itemL; i++){
			var color=document.getElementsByClassName("dt")[i].innerHTML;
//			console.log(color)
//			console.log(color=="视频")
			if(color=="视频"){
//				console.log(1111)
           document.getElementsByClassName("dt")[i].style.backgroundColor="#ea775b";
	       }
	       if(color=="育儿"){
	          document.getElementsByClassName("dt")[i].style.backgroundColor="#f59600";
	       }
	       if(color=="亲子"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#19f724";
	       }
	       if(color=="故事"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#1dd2a1";
	       }
	       if(color=="实验"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#3176c3";
	       }
	       if(color=="绘本"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#1996f7";
	       }
	       if(color=="福利"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#ff84b0";
	       }
		}
    $(window).load(function (){
        setTimeout(function () {
            $('.kap-bottom').show();
        },2000)
    });
    var npage = 10;
    $(function () {
        $(window).scroll(function () {
            var scrollTop = $(this).scrollTop();
            var scrollHeight = $(document).height();
            var windowHeight = $(this).height();
            var cate_id = $('.ty-cat-tags .on').attr('attr_id');
            if (scrollTop + windowHeight == scrollHeight) {
                //加载层
                layer.load();
                setTimeout(function () {
                    layer.closeAll('loading');
                }, 1000);
                var url = "{:U('Article/loadingProduct')}";
                var params = {};
                params.cate_id = cate_id;
                params.npage = npage;
                $.post(url, params, function (result) {

                    if (result.status == 0) {
                        $(".empty").remove();
                        return $('.list').append("<li class='empty'>没有更多了</li>");
                    }

                    $.each(result.data, function (index, value) {
                        if(value['collect'] == null){
                            collect = 0;
                        }else{
                            collect = value['collect'];
                        }
                        if(value['count'] == null){
                            num = 0;
                        }else{
                            num = value['count'];
                        }
                        $(".list").append("<li class='item' onclick='getArticle( " + value['id'] + ")'>" +
                                "<img class='thumb' src='" + value['image'] + "' style='background-size:cover;'>" +
                                "<span class='desc'>" +
                                "<h3 class='title'>" + value['title'] + "</h3>" +
                                "<span class='time'><span class='lef'>" + value['time'] + "</span>" +
                                "<span class='rig'>评论（" + num + "） <i></i> 收藏（" + collect + "）</span></span>" +
                                "<span class='status dt'>" + value['cate_title'] + "</span>" +
                                "</span>" +
                                "<span class='icon-sale'></span>" +
                                "</li>");
                    });
                    var text=$(".dt").html();
			       if(text=="视频"){
			           $(".dt").css("background","#ea775b")
			       }
			       if(text=="育儿"){
			           $(".dt").css("background","#f59600")
			       }
			       if(text=="亲子"){
			           $(".dt").css("background","#19f724")
			       }
			       if(text=="故事"){
			           $(".dt").css("background","#1dd2a1")
			       }
			       if(text=="实验"){
			           $(".dt").css("background","#3176c3")
			       }
			       if(text=="绘本"){
			           $(".dt").css("background","#1996f7")
			       }
			       if(text=="福利"){
			           $(".dt").css("background","#ff84b0")
			       }
			       var itemL=$(".list-card-timeline li").length;
		for(var i=0; i<itemL; i++){
			var color=document.getElementsByClassName("dt")[i].innerHTML;
//			console.log(color)
//			console.log(color=="视频")
			if(color=="视频"){
//				console.log(1111)
           document.getElementsByClassName("dt")[i].style.backgroundColor="#ea775b";
	       }
	       if(color=="育儿"){
	          document.getElementsByClassName("dt")[i].style.backgroundColor="#f59600";
	       }
	       if(color=="亲子"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#19f724";
	       }
	       if(color=="故事"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#1dd2a1";
	       }
	       if(color=="实验"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#3176c3";
	       }
	       if(color=="绘本"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#1996f7";
	       }
	       if(color=="福利"){
	           document.getElementsByClassName("dt")[i].style.backgroundColor="#ff84b0";
	       }
		}
                })
                npage += 6;
            }
        });
    });

    function getArticle(id) {
        window.location.href = "{:U('Article/getArticle')}?art_id=" + id;
    }
    function getCateListById(id) {
        window.location.href = "{:U('Article/index')}?cate_id=" + id;
    }
    $(function () {
        $(".ty-cat-tags span").click(function () {
//            $(this).find("span").addClass("tag link on").parent().siblings().find("span").removeClass("on");

            $(this).siblings('span').removeClass('on');  // 删除其他兄弟元素的样式
            $(this).addClass('on');
        });

    });

</script>
</body>
</html>
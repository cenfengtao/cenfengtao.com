<include file="Common:header"/>
<style>
    body {
        height:auto;
    }
    .record {
        margin-top:5rem;
        width:100%;
    }
    .scroll {
        position: fixed;
        top: 2.5rem;
        width:100%;
        background: #66ccff;
        height:2.5rem;
        line-height: 2.5rem;
    }
    .scroll > span {
        width:49%;
        text-align: center;
        display: inline-block;
        color:#fff;
    }
</style>
<body>
<div class="container manage-container">
<div class="kap-top ty-menu-top">
    <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
        <span class="title">{$title}<span class="num"></span></span>
        <a href="javascript:void(0);" onclick="history.go(-1);" class="btn left btn-user" title="返回" data-icon="ɒ"></a>
       <a href="{:U('Index/index',array('current'=>'1'))}" class="btn right btn-user" title="返回首页"
           data-icon="Ņ"></a>
    </div>
</div>
    <div class="scroll">
        <span>奖品名称</span>
        <span>兑换状态</span>
    </div>
    <div class="main record">
        <section class="gift">
          <div class="list-record">
            <ul class="list">
           <volist name="Page['root']" id="val" key='i'>
           <if condition="($val['is_addr'] eq 2) and ($val['typeid'] eq 2) ">
             <li class="blue" id="li_{$val.id}">
                  <div class="list-h">
                  <span>{$val.prize}</span></div>
                  <div class="status-view"><span>未领取</span>
                  <div class="do-tasks" onclick="receive('{$val.id}','{$val.token}')">领取</div></div>
                  <div class="annioc">
                  <i onclick="open_info({$val.id})">&nbsp;</i></div>
              </li>
                   <ul class="prize-info li-{$val.id}" style="display:none;">
                        <li>奖品名称:{$val.prize}</li>
                        <li>奖品编码:{$val.code}</li>
                        <li>抽奖时间:{$val.create_time|date="Y-m-d",###}</li>
                        <li>说明:{$val.explain}</li>
                   </ul>


             <else/>

 <li id="li_{$val.id}">
  <div class="list-h">
               <span>{$val.prize}</span></div>
               <div class="status-view">
               <span>已领取</span>
               <if condition="$val['typeid'] eq 1">
               <div class="do-tasks" onclick="open_integrallist({$val.id})">查看</div></div>
               <elseif condition="$val['typeid'] eq 2"/>
               <div class="do-tasks" onclick="open_material({$val.id})">查看</div></div>
               <elseif condition="$val['typeid'] eq 3"/>
               <div class="do-tasks">查看</div></div>
               <else/>
                <div class="do-tasks">查看</div></div>
               </if>
               <div class="annioc">
               <i onclick="open_info({$val.id})">&nbsp;</i></div>
            </li>
                 <ul class="prize-info li-{$val.id}" style="display:none;">
                        <li>奖品名称:{$val.prize}</li>
                        <li>奖品编码:{$val.code}</li>
                        <li>抽奖时间:{$val.create_time|date="Y-m-d",###}</li>
                        <li>说明:{$val.explain}</li>
                   </ul>
                </if>
           </volist>
            </ul>
          </div>

        </section>
        <div id="foot" class="kap-bottom ty-menu-bottom" style="text-align: center;">
        <div id="tools_idx" class="ty-tools ty-tools-idx ty-tools-current">
            {$Page['pager']}
        </div>

           <!--  <div class="minute-page" style="">
               {$Page['pager']}
            </div>
            <br/>
            <footer>
                <nobr>本活动最终解释权归优培圈所有</nobr>
            </footer>
            <img class="zyj-footer-banner pt50" src="__PUBLIC__/images/footer_banner.jpg"> -->
        </div>
    </div>
</div>
</body>
<include file="Common:footer"/>
<!-- <script>
      <if condition="$Page['totalPage'] gt 1">
                $(document).ready(function(){
                    laypage({
                        cont: 'wst-page-items',
                        pages: {$Page['totalPage']}, //总页数
                        skip: true, //是否开启跳页
                        skin: '#e23e3d',
                        groups: 3, //连续显示分页数
                        curr: function(){ //通过url获取当前页，也可以同上（pages）方式获取
                            var page = location.search.match(/p=(\d+)/);
                            return page ? page[1] : 1;
                        }(), 
                        jump: function(e, first){ //触发分页后的回调
                            if(!first){ //一定要加此判断，否则初始时会无限刷新
                                var nuewurl = WST.splitURL("p");
                                var ulist = nuewurl.split("?");
                                if(ulist.length>1){
                                    location.href = nuewurl+'&p='+e.curr;
                                }else{
                                    location.href = '?p='+e.curr;
                                }
                                
                            }
                        }
                    });
                });
                </if>
    
    </script> -->
<script>
    function open_info(id){

        var displays =$(".li-" + id).css('display');
        if(displays == 'none'){
       $(".li-" + id).css("display","");
       $("#li_"+ id + " i").css("transform","rotate(180deg)");
     }else{
        $(".li-" + id).css("display","none");
        $("#li_"+ id + " i").css("transform","rotate(0deg)");
     }
    }

    function open_integrallist(){
         var url="{:U('MemberIntegral/integrallist')}";
         window.location.href = url;
    }

    function receive(pid,token){
        layer.open({
        cornerRadius: 8,
         type: 2 //Page层类型
        , skin: 'layer-MyClass'
        , area: ['100%', '100%']
        , title: "填写收货地址"
        , shade: 0.9 //遮罩透明度
        , anim: 1 //0-6的动画形式，-1不开启
        , maxmin: true
        , content:["{:U('Lottery/userinfo')}?pid=" + pid +"&token=" + token,'no']
        });
    }

    function open_material(pid){
        var params = {};
         params.pid=pid;
      $.post("{:U('Lottery/see')}",params,function(res){
        var status;
        if (res.status==1) {
             status = "已发送";
        }else{
             status = "未发送";
        }
        layer.open({
         type: 1, //Page层类型
         area: ['90%', '10em'],
         title: '礼品详情',
         shade: 0.5, //遮罩透明度
         anim: 5, //0-6的动画形式，-1不开启
         content:'<div style="padding:20px;">' +
                  '<p>收货人：'+res.receipt_name+'</p>'+
                  '<p>邮件地址： '+res.areaname1+res.areaname2+res.areaname3+res.address+'</p>' +'<p>状况： '+status+'</p>' +
                '</div>'
     });

  })


    }
</script>

</body>
</html>
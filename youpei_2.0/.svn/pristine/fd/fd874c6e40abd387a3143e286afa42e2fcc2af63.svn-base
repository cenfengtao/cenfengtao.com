var itemLe=$(".colorList li").length;
for(var j=0; j<itemLe; j++){
    var color=document.getElementsByClassName("font")[j].innerHTML;
    if(color=="早教"){
        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#f59600";
    }
    if(color=="画画"){
        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#19f724";
    }
    if(color=="积木"){
        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#1dd2a1";
    }
    if(color=="幼儿"){
        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#9fc4e0";
    }
    if(color=="钢琴"){
        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#ff84b0";
    }
}



$(function(){
    var width=$(window).width();
    if(width<=720){
        $(".original").css("font-size","22px")
        $(".now").css("font-size","22px")
        $(".now").css("margin-top","-24px")
    }
    $(window).resize(function(){
        var width=$(window).width();
        if(width<=720){
            $(".original").css("font-size","22x")
            $(".now").css("font-size","22x")
            $("now").css("margin-top","-24px")
        }
    })
})




$.ajax({
    type: "get",
    url: "/index.php/Index/indexTest",
    aysnc: true,
    dataType: "json",
    success: function (data) {
        //遍历循环picture数据
        var imgList = $(".imgLi");
        var picture = data.data.picture;
        var pic_html = "";
        for (var j = 0; j <= picture.length - 1; j++) {
            pic_html = '<li>' +
                '<a href="'+picture[j].url+'" class="dian">' +
                '<img src="/' + picture[j].image + '" alt="banner' + j + '">' +
                '</a>' +
                '</li>';
            imgList.append(pic_html)
            if (j == 1) {
                document.getElementsByClassName("dian")[j].setAttribute("class", "dianji");
                $(".dianji").attr("href", picture[j].url);
            }
        }
        $(function(){
            var winW=$(window).width();
            $(winW).resize(function(){
                location.reload()
            })
            $(window).resize(function(){
                location.reload()
            })
            //获取小圆点的集合
            var  circleList =  $(".hd ul>li");
            //获取banner图集合
            var bannerList = $(".bd ul li");
            var len=circleList.length;
            //左右箭头切换标记
            var circleTag = 0;
            var liLen=bannerList.length;
            //自动轮播标记
            var autoTag = 0;
            $(".bd ul").css({"width":winW*liLen+"px"});
            $(".bd li").width(winW);
            //小圆点切换banner图
            circleList.each(function(i){
                //为每一个小圆点绑定mouseover事件
                $(this).click(function(){
                    clearlunbo();
                    //鼠标移动到哪个圆点上，为该圆点增加active样式
                    circleList.eq(i).addClass("on");
                    //其他圆点取消active样式
                    circleList.not(circleList.eq(i)).removeClass("on");
                    //切换对应的banner图
                    bannerList.eq(i).show();
                    bannerList.not(bannerList.eq(i)).hide();

                    circleTag = i;
                    autoTag = i;
                })

            })
            //左箭头切换上一张
            function prev(){

                circleTag--;
                // console.log(circleTag)
                if(circleTag<0){
                    circleTag =len-1;
                }
                circleList.eq(circleTag).trigger("click");
            }

            //右箭头切换下一张
            function next(){
                circleTag++;
                //当下一页为最后一页时，则重置索引值，显示第一页
                if(circleTag>len-1){
                    circleTag =0;
                }
                circleList.eq(circleTag).trigger("click");
            }
            $(".bd ul li").swipe({
                swipeLeft: function(){
                    next();
//          clearlunbo();
                },
                swipeRight: function(){
                    prev();
//          clearlunbo();
                },
            })

            //自动轮播
            var autoTag=0;
//          var bool=true;
            var downtime =  setInterval(action,3000);//每隔一秒调用action函数
            //执行自动轮播的函数
            function action(){
                autoTag++;
                //如果已经是最后一页了，则重置为第一页
                if(autoTag>len-1){
                    autoTag = 0;
                }
                circleList.eq(autoTag).trigger("click")
            }
            function clearlunbo(){
                clearInterval(downtime);
                setTimeout(function(){
                    downtime=setInterval(action,3000)
                },1)
            }
        })
    }
})
$(function () {
    $(".ty-cat-tags a").click(function () {
        $(this).find("span").addClass("tag link on").parent().siblings().find("span").removeClass("on");
    });
    var first_class_id = $('#first_class').attr('attr_id');
    getProductByType(first_class_id);
});

function getProductByType(id) {
    page();
    var url = "/index.php/Index/getProductByType";
    $.post(url, {id: id}, function (result) {
        if (result.status == 1) {
            console.log(result)
            //加载层
            layer.load();
            setTimeout(function () {
                layer.closeAll('loading');
            }, 1000);
            $(".list-card li").remove();
            $.each(result.data, function (index, value) {
                if(value.bargain == 1){
                    $(".list-card").append("<li class='item'>" +
                        "<a href=/index.php/Product/productDetails?pro_id=" + value['id'] + ">" +
                        "<span class='thumb' style=''><img src='" + value['pic_url'] + "'>"+
                        "<span class='originalPrice'>原价：￥" + value['original_price'] + "</span>" +
                        "<span class='bargain'  style='display: none;' attr_bargain='" + value['bargain'] + "' onclick='getBargainId(event," + value['id'] + ")' >点我砍价"+
                        "<img src='../../../../Public/images/axe1.png'>"+
                        "</span>" +
                        "<div class='desc'>" +
                        "<span data-icon='Ć' class='loc'><a class='gps' href=/index.php/Map/GPS?id=" + value['id'] + ">"+ value['city'] + value['area'] + value['add'] +"</a></span>"+
                        "<div class='triangle'><p class='text font'>" + value['class_title'] + "</p></div>" +
                        "<h3 class='title'>" + value['title'] + "</h3>" +
                        "<span class='nowPrice'>现价：<span class='price'>￥"+ value['price'] + "</span></span>" +
                        "<span class='talent' onclick='getOrgId(" + value['org_id'] + ")'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>"+
                        "<div class='tags'>" +
                        "<span class='tag red'>" + value['tagA'] + "</span>" +
                        "<span class='tag'>" + value['tagB'] + "</span>" +
                        "<span class='tag'>" + value['tagC'] + "</span>" +
                        "</div>" +
                        "</div>" +
                        "</a>" +
                        "</li>");
                }else if(value.bargain == 2){
                    $(".list-card").append("<li class='item'>" +
                        "<a href=/index.php/Product/productDetails?pro_id=" + value['id'] + ">" +
                        "<span class='thumb' style=''><img src='" + value['pic_url'] + "'>"+
                        "<span class='originalPrice'>原价：￥" + value['original_price'] + "</span>" +
                        "<span class='bargain'  style='display: block;' attr_bargain='" + value['bargain'] + "' onclick='getBargainId(event," + value['id'] + ")' >点我砍价"+
                        "<img src='../../../../Public/images/axe1.png'>"+
                        "</span>" +
                        "<div class='desc'>" +
                        "<span data-icon='Ć' class='loc'><a class='gps' href=/index.php/Map/GPS?id=" + value['id'] + ">"+ value['city'] + value['area'] + value['add'] +"</a></span>"+
                        "<div class='triangle'><p class='text font'>" + value['class_title'] + "</p></div>" +
                        "<h3 class='title'>" + value['title'] + "</h3>" +
                        "<span class='nowPrice'>现价：<span class='price'>￥"+ value['price'] + "</span></span>" +
                        "<span class='talent' onclick='getOrgId(" + value['org_id'] + ")'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>"+
                        "<div class='tags'>" +
                        "<span class='tag red'>" + value['tagA'] + "</span>" +
                        "<span class='tag'>" + value['tagB'] + "</span>" +
                        "<span class='tag'>" + value['tagC'] + "</span>" +
                        "</div>" +
                        "</div>" +
                        "</a>" +
                        "</li>");
                }
            });

        } else {
            return $('.list-card').html("<li class='empty'>没有该类型商品</li>");
        }
        var itemLe=$(".colorList li").length;
        for(var j=0; j<itemLe; j++){
            var color=document.getElementsByClassName("font")[j].innerHTML;
            if(color=="早教"){
                document.getElementsByClassName("font")[j].parentNode.style.borderColor="#f59600";
            }
            if(color=="画画"){
                document.getElementsByClassName("font")[j].parentNode.style.borderColor="#19f724";
            }
            if(color=="积木"){
                document.getElementsByClassName("font")[j].parentNode.style.borderColor="#1dd2a1";
            }
            if(color=="幼儿"){
                document.getElementsByClassName("font")[j].parentNode.style.borderColor="#9fc4e0";
            }
            if(color=="钢琴"){
                document.getElementsByClassName("font")[j].parentNode.style.borderColor="#ff84b0";
            }
        }
    }, 'json');

}
function page() {
    return npage = 3;
}
var npage = 3;
$(function () {
    $(window).scroll(function () {
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height();
        var windowHeight = $(this).height();
        if (scrollTop + windowHeight == scrollHeight && npage != 0) {
            $(this).scrollTop(scrollHeight - 50);
            //加载层
            layer.load();
            setTimeout(function () {
                layer.closeAll('loading');
            }, 1000);
            var first_class_id = $('.ty-cat-tags .on').attr('attr_id');
            var url = "/index.php/Index/loadingProduct";
            var params = {};
            params.first_class_id = first_class_id;
            params.npage = npage;
            $.post(url, params, function (result) {
                if (result.status == 0) {
                    $(".empty").remove();
                    npage = 0;
                    return $('.list-card').append("<li class='empty'>没有更多了</li><li class='empty'>粤ICP备17008351号</li>");
                }
                $.each(result.data, function (index, value) {
                    if(value.bargain == 1){
                        $(".list-card").append("<li class='item'>" +
                            "<a href=/index.php/Product/productDetails?pro_id=" + value['id'] + ">" +
                            "<span class='thumb' style=''><img src='" + value['pic_url'] + "'>"+
                            "<span class='originalPrice'>原价：￥" + value['original_price'] + "</span>" +
                            "<span class='bargain' style='display: none;' attr_bargain='" + value['bargain'] + "' onclick='getBargainId(event," + value['id'] + ")' >点我砍价"+
                            "<img src='../../../../Public/images/axe1.png'>"+
                            "</span>" +
                            "<div class='desc'>" +
                            "<span data-icon='Ć' class='loc'><a class='gps' href=/index.php/Map/GPS?id=" + value['id'] + ">"+ value['city'] + value['area'] + value['add'] +"</a></span>"+
                            "<div class='triangle'><p class='text font'>" + value['class_title'] + "</p></div>" +
                            "<h3 class='title'>" + value['title'] + "</h3>" +
                            "<span class='nowPrice'>现价：<span class='price'>￥"+ value['price'] + "</span></span>" +
                            "<span class='talent' onclick='getOrgId(" + value['org_id'] + ")'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>"+
                            "<div class='tags'>" +
                            "<span class='tag red'>" + value['tagA'] + "</span>" +
                            "<span class='tag'>" + value['tagB'] + "</span>" +
                            "<span class='tag'>" + value['tagC'] + "</span>" +
                            "</div>" +
                            "</div>" +
                            "</a>" +

                            "</li>");
                    }else if(value.bargain == 2){
                        $(".list-card").append("<li class='item'>" +
                            "<a href=/index.php/Product/productDetails?pro_id=" + value['id'] + ">" +
                            "<span class='thumb' style=''><img src='" + value['pic_url'] + "'>"+
                            "<span class='originalPrice'>原价：￥" + value['original_price'] + "</span>" +
                            "<span class='bargain' style='display: block;' attr_bargain='" + value['bargain'] + "' onclick='getBargainId(event," + value['id'] + ")' >点我砍价"+
                            "<img src='../../../../Public/images/axe1.png'>"+
                            "</span>" +
                            "<div class='desc'>" +
                            "<span data-icon='Ć' class='loc'><a class='gps' href=/index.php/Map/GPS?id=" + value['id'] + ">"+ value['city'] + value['area'] + value['add'] +"</a></span>"+
                            "<div class='triangle'><p class='text font'>" + value['class_title'] + "</p></div>" +
                            "<h3 class='title'>" + value['title'] + "</h3>" +
                            "<span class='nowPrice'>现价：<span class='price'>￥"+ value['price'] + "</span></span>" +
                            "<span class='talent' onclick='getOrgId(" + value['org_id'] + ")'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>"+
                            "<div class='tags'>" +
                            "<span class='tag red'>" + value['tagA'] + "</span>" +
                            "<span class='tag'>" + value['tagB'] + "</span>" +
                            "<span class='tag'>" + value['tagC'] + "</span>" +
                            "</div>" +
                            "</div>" +
                            "</a>" +
                            "</li>");
                    }
                });
                var itemLe=$(".colorList li").length;
                for(var j=0; j<itemLe; j++){
                    var color=document.getElementsByClassName("font")[j].innerHTML;
                    if(color=="早教"){
                        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#f59600";
                    }
                    if(color=="画画"){
                        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#19f724";
                    }
                    if(color=="积木"){
                        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#1dd2a1";
                    }
                    if(color=="幼儿"){
                        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#9fc4e0";
                    }
                    if(color=="钢琴"){
                        document.getElementsByClassName("font")[j].parentNode.style.borderColor="#ff84b0";
                    }
                }
            })
            npage += 3;
        }
    });
});
/** ***********************广告显示 start************************ */

var curIndex = 0, //当前index
    imgLen = $(".imgList li").length; //图片总数

// 定时器自动变换2.5秒每次
var autoChange = setInterval(function () {
    if (curIndex < imgLen - 1) {
        curIndex++;
    } else {
        curIndex = 0;
    }
    //调用变换处理函数
    changeTo(curIndex);
}, 2500);
//左箭头滑入滑出事件处理
$("#prev").hover(function () {
    //滑入清除定时器
    clearInterval(autoChange);
}, function () {
    //滑出则重置定时器
    autoChangeAgain();
});
//左箭头点击处理
$("#prev").click(function () {
    //根据curIndex进行上一个图片处理
    curIndex = (curIndex > 0) ? (--curIndex) : (imgLen - 1);
    changeTo(curIndex);
});
//右箭头滑入滑出事件处理
$("#next").hover(function () {
    //滑入清除定时器
    clearInterval(autoChange);
}, function () {
    //滑出则重置定时器
    autoChangeAgain();
});
//右箭头点击处理
$("#next").click(function () {
    curIndex = (curIndex < imgLen - 1) ? (++curIndex) : 0;
    changeTo(curIndex);
});
//对右下角按钮index进行事件绑定处理等
$(".indexList").find("i").each(function (item) {
    $(this).hover(function () {
        clearInterval(autoChange);
        changeTo(item);
        curIndex = item;
    }, function () {
        autoChangeAgain();
    });
});
//清除定时器时候的重置定时器--封装
function autoChangeAgain() {
    autoChange = setInterval(function () {
        if (curIndex < imgLen - 1) {
            curIndex++;
        } else {
            curIndex = 0;
        }
        //调用变换处理函数
        changeTo(curIndex);
    }, 4000);
}
function changeTo(num) {
    var system = {
        win: false,
        mac: false,
        xll: false
    };
    var p = navigator.platform;
    system.win = p.indexOf("Win") == 0;
    system.mac = p.indexOf("Mac") == 0;
    system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
//跳转语句
    if (system.win || system.mac || system.xll) {

        var goLeft = num * 640;
        $(".imgList").animate({left: "-" + goLeft + "px"}, 500);
        $(".indexList").find("i").removeClass("indexOn").eq(num).addClass("indexOn");
    } else {
        var goLeft = num * 25;
        $(".imgList").animate({left: "-" + goLeft + "rem"}, 500);
        $(".indexList").find("i").removeClass("indexOn").eq(num).addClass("indexOn");
    }
}

//倒计时
var time_current = (new Date()).valueOf();//获取当前时间
$(function () {
    var dateTime = new Date();
    var difference = dateTime.getTime() - time_current;

    setInterval(function () {
        $(".endtime").each(function () {
            var obj = $(this);
            var endTime = new Date(parseInt(obj.attr('value')) * 1000);
            var nowTime = new Date();
            var nMS = endTime.getTime() - nowTime.getTime() + difference;
            var myD = Math.floor(nMS / (1000 * 60 * 60 * 24));
            var myH = Math.floor(nMS / (1000 * 60 * 60)) % 24;
            var myM = Math.floor(nMS / (1000 * 60)) % 60;
            var myS = Math.floor(nMS / 1000) % 60;
            var myMS = Math.floor(nMS / 100) % 10;
            if (myD >= 0) {
                var str = "剩余时间 还剩" + myD + "天  " + myH + ":" + myM + ":" + myS;
            } else {
                var str = "已结束！";
            }
            obj.html(str);
        });
    }, 100);
});

var mySwiper = new Swiper('.swiper-container', {
    pagination: '.pagination',
    loop: true,
    grabCursor: true,
    paginationClickable: true
})
$('.arrow-left').on('click', function (e) {
    e.preventDefault()
    mySwiper.swipePrev()
})
$('.arrow-right').on('click', function (e) {
    e.preventDefault()
    mySwiper.swipeNext()
})

function signin() {
    window.location.href = "/index.php/Sign/index";
}

//查看商品
function getProduct(id) {
    window.location.href = "/index.php/Product/productDetails?pro_id=" + id;
}

//砍价
function getBargainId(event,id) {
    event.preventDefault();
    if ($(event.target).is('.bargain')) {
        window.location.href = "/index.php/Product/bargain?pro_id=" + id;
    }
}


//机构
function getOrgId(id) {
    window.location.href = "/index.php/Organization/home?id=" + id;
}
var b=null;
function a(){
    b=setTimeout(function(){
        $(".bargain").animate({"bottom":"10px"},200,function(){
            $(".bargain").animate({"bottom":"0px"},200)
        })
        a()
    },200)
}
a()
<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>投票详情</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/pageloader.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/voteDetail.css"/>
    <script type="text/javascript">
        if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
    </script>
    <!--  <script>
         var _hmt = _hmt || [];
         (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?548e13b07cb36e38bfd73870368a0253";
           var s = document.getElementsByTagName("script")[0];
           s.parentNode.insertBefore(hm, s);
         })();
     </script> -->
</head>
<body class="kap-loading ty-view-all">
<include file="Common:common"/>
<header class="header">
    <a href="javascript:history.back()" class="back">
        <img src="../../../../Public/images/back.png" alt="">
    </a>
    <h3>投票详情</h3>
    <a href="../Index/index.html" class="home" data-icon="Ņ"></a>
</header>
<article class="middle">
    <section class="works">
        <div class="title">
           <span>已获<a href="###" class="nowNum">99</a>票</span>
        </div>
        <div class="type">
            <!-- <img src="../../../../Public/images/voteImage1.jpg" alt="" class="workImg"> -->
        </div>
        <div class="introduce">
           <p class="call"><span>作品名称：<strong class="workName">我和小星星</strong></span></p>
           <p class="name"><span>作者：<strong class="userName">优小培</strong></span></p>
        </div>
        <div class="vote">
            <p>
               <span>投TA</span>
               <input type="text" value="1" class="number" onchange="num(this)">
               <span>票</span>
               <a href="javascript:void(0)" class="confirm">确定</a>
            </p>       
        </div>
    </section>
   
    <section class="others">
        <div class="more" onclick="moreWorks()">
            <img src="../../../../Public/images/otherWorks.png" alt="">
            <span>其他作品</span>
            <a href="/index.php/Vote/voteList.html">更多 ></a>
        </div>
        <div class="img">
            <ul class="imgList">
                <!-- <li onclick="moreWorks()">
                    <a href="javascript:void(0)"><img src="../../../../Public/images/voteImage1.jpg" alt=""></a>
                </li>
                <li onclick="moreWorks()">
                    <a href="javascript:void(0)"><img src="../../../../Public/images/voteImage1.jpg" alt=""></a>
                </li> -->
            </ul>
        </div>
    </section>
    <section class="join">
        <a href="javascript:void(0)" onclick="join()">我也要参加</a>
    </section>
    <section class="text">
<!--         <p><span>· </span>活动介绍：我和家人绘画比赛，欢迎广大小画家参加。</p>
        <p><span>· </span> 活动奖品：书包、笔记本电脑、IphoneX。</p> -->
    </section>
</article>
<footer class="footer">
    <ul class="icon">
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/voteList.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon1.png"/>
                <span>作品库</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userVote.html">
                <img src="__PUBLIC__/images/voteIcon2.png"/>
                <span>我的投票</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userWorks.html">
                <img src="__PUBLIC__/images/voteIcon3.png"/>
                <span>我的作品</span>
            </a>
        </li>
        <li>
            <img src="__PUBLIC__/image/circle.png" alt="">
            <a href="/index.php/Vote/userBillboard.html?vote_id=4">
                <img src="__PUBLIC__/images/voteIcon4.png"/>
                <span>榜单</span>
            </a>
        </li>
    </ul>
</footer>
<script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/home/voteDetail.js" type="text/javascript" charset="utf-8"></script>
<script>
function num(obj){
	var num = obj.value;
	if(isNaN(num)){
		num = 1;
	}else if(num==""){
		num=1;
	}else if(num<1){
		num=1;
	}
	num = parseInt(num);
	obj.value = num;
}		

//    获取url参数
function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}
var id=GetRequest().id;
    // //投票
    // function toVote(id) {
    //     var url = "/index.php/Vote/toVote";
    //     var className = ".vote_count_" + id;
    //     var count = $(className).val();
    //     $.post(url, {count: count, id: id}, function (result) {
    //         if (result.status == 0) {
    //             return alert(result.message);
    //         }
    //         if (result.status == 1) {
    //             return alert(result.message);
    //         }
    //     }, 'json');
    // }
    $.ajax({
        type:"get",
        url:"/index.php/Vote/ajaxVoteDetail",
        async: true,
        dataType:"json",
        data:{
            id:id
        },
        success:function(data){
            if(data.status==0){
                setTimeout(function(){
                    alert(data.message)
                    history.back()
                },1000)  
                return
            }
            var vote_count=data.data.work.vote_count;
            var username=data.data.work.username;
            var title=data.data.work.title;
            var path=data.data.work.path;
            var desc=data.data.desc;
            var upload_type=data.data.upload_type;
            var more=data.data.more;
            var moreLength=data.data.more.length;
            $(".nowNum").html(vote_count);
            $(".workName").html(title);
            $(".userName").html(username);

            if(data.status==1){
                $(".text").html(desc)
                if(data.data.isContribute==1){
                    $(".join").hide()
                }
                if(data.data.isContribute==2){
                    $(".join").show()
                }
                if(upload_type==1){
                    $(".type").html('<img src="'+path+'" alt=""/>')
                    for(var i=0; i<moreLength; i++){
                        $(".imgList").append(
                            '<li onclick="moreWorks()">'+
                                '<a href="###"><img src="'+more[i].path+'" alt=""></a>'+
                            '</li>'
                        )
                    }
                }
                if(upload_type==2){
                    $(".type").html('<video src="'+path+'" alt="" autoplay></video>')
                    for(var j=0; j<moreLength; j++){
                         $(".imgList").append(
                            '<li onclick="moreWorks()">'+
                                '<a href="###"><video src="'+more[j].path+'" alt="" autoplay></video></a>'+
                            '</li>'
                        )
                     }
                }
            }
            
        }
    })
$(function(){
    $(".confirm").click(function(){
        var value=$(".number").val();
        $.ajax({
            type:"post",
            url:"/index.php/Vote/toVote",
            async:true,
            dataType:"json",
            data:{
                count:value,
                id:id
            },
            success:function(data){
                if(data.status==0){
                    alert(data.message)
                }
                if(data.status==1){
                    alert(data.message)
                }
            }
        })
    })
})
function moreWorks(){
    window.location.href="/index.php/Vote/voteList.html?vote_id="+id;
}
function join(){
    window.location.href="/index.php/Vote/contribution.html?vote_id="+id;
}
</script>
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->




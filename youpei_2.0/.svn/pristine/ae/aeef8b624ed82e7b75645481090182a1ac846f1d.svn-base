<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
        <title>课程选购</title>
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/common.css"/>
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/com.css"/>
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/checkOrderInformation.css"/>
        <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/home/pageloader.css"/>
        <!--<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>-->
        <script type="text/javascript">
            if(/msie/i.test(navigator.userAgent)){window.location.href="http://www.youpei-exc.com/"}
        </script>
        
    </head>
    <body class="kap-loading ty-view-all">
        <include file="Common:common"/>
        <header class="header">
            <a href="javascript:history.back()" class="back">
                <img src="/Public/images/back.png" alt="">
            </a>
            <h3>课程选购</h3>
            <a href="/index.php/Index/index.html" class="home" data-icon="Ņ"></a>
        </header>
        <article class="middle">
            <section class="img">
                <img src="{$product['pic_url']}" alt="">
                <div class="text">{$product['title']} {$product['price']['class_normal']}</div>
            </section>
            <section class="schedule" onclick="getClassTable()">
                <img src="/Public/images/schedule.png" alt="">
                <span>预约试听课</span>
                <img src="/Public/images/next.png" alt="">
            </section>
            <section class="choseNum">
                <img src="../../../../Public/images/num.png" alt="">
                <span>选择数量</span>
            </section>
            <section class="course">
                <div class="num">
                    <div style="width:1.7rem;">
                        <input type="text" value="1" min="1" max="100" id="amount" class="number" readonly="readonly">
                    </div>
                </div>
            </section>
            <!--<section class="use">-->
                <!--<img src="../../../../Public/images/usePaper.png" alt="">-->
                <!--<span>用券</span>-->
            <!--</section>-->
            <!--<section class="useImg">-->
                <!--<ul>-->
                    <!--<li><a href="###"><img src="../../../../Public/images/usePaper1.png" alt=""></a></li>-->
                    <!--<li><a href="###"><img src="../../../../Public/images/usePaper2.png" alt=""></a></li>-->
                    <!--<li><a href="###"><img src="../../../../Public/images/usePaper3.png" alt=""></a></li>-->
                <!--</ul>-->
            <!--</section>-->
            <section class="pay">
                <p class="all">合计：<span class="price-off">￥{$product['price']['now_price']}</span></p>
                <p class="really">实付：<strong class="price-full">￥{$product['bargain_price']}</strong></p>
                <div class="rule" style="display: none;">
                    <input type="checkbox" id="checkbox" style="display: none;" checked="checked">
                    <i></i>
                    <label for="checkbox"> 我已阅读同意<a href="javascript:void(0);" style="color:#299955;" onclick="agreement()">《服务协议》</a>
                        及<a href="javascript:void(0);" style="color:#299955;" onclick="Refund_rule()">《退款规则》</a></label>
                </div>
            </section>
            <form action="">
                <label class="name">
                    <span>*联系人：</span>
                    <input type="text" placeholder="姓名" name="name">
                </label>
                <label class="tel">
                    <span>*电话号码：</span>
                    <input type="tel" placeholder="电话" maxlength="11" onchange="testTel(this.value)" name="mobile">
                </label>
                <label class="address">
                    <span>*所在地区：</span>
                    <select class="province" name="province">
                        <option value="请选择省">省份</option>
                    </select>
                    <select class="city" name="city">
                        <option value="请选择市">市</option>
                    </select>
                    <select class="county" name="county">
                        <option value="请选择区">县/区</option>
                    </select>
                </label>
                <label class="address">
                    <span>*详细地址：</span>
                    <input type="text" maxlength="11" name="address">
                </label>
                <label class="details">
                    <span>留言：</span>
                    <textarea name="remark" id="remark"></textarea>
                </label>
            </form>
            <section class="nextStep">
                <a href="javascript:addOrder()">提交订单</a>
            </section>
        </article>
        <footer class="footer">
            
        </footer>
        <script src="__PUBLIC__/Home/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="/Public/js/layer/layer.js"></script>
        <script src="__PUBLIC__/Home/js/pageloader.js" type="text/javascript" charset="utf-8"></script>
        <script src="__PUBLIC__/js/home/rem.js" type="text/javascript" charset="utf-8"></script>
        <script src="__PUBLIC__/js/home/city.js" type="text/javascript" charset="utf-8"></script>
        <script>
            //城市级联的实现
            $(function(){
                $.getScript("../../../../Public/js/home/city.js",function(data){
                    var result=JSON.parse(data);
                    var cityArr = [];
                    var countyArr = [];
                    for(var i=0;i<result.length;i++){
                        if(result[i].ProSort){
                            $(".province").append("<option value='"+result[i].ProID+"'>"+result[i].name+"</option>")//把数据拼接到.province下的option里
                        }else if(result[i].CitySort){
                            cityArr.push(result[i]);//把符合的数据放入cityArr里
                        }else if(result[i].DisSort == null){
                            countyArr.push(result[i]);//把符合的数据放入countyArr里
                        }
                    }
                    $(".province").change(function(){
                        var value = $(this).val();
                        $(".city option").remove();
                        $(".province option").eq(0).remove();
                        for(var i=0;i<cityArr.length;i++){
                            if(cityArr[i].ProID == value){
                                $(".city").append("<option value='"+cityArr[i].CityID+"'>"+cityArr[i].name+"</option>"); //把数据拼接到.city下的option里
                            }
                        }

                        var value2=$(".city option").val();

                        $(".county option").remove();
                        for(var i=0;i<countyArr.length;i++){
                            if(countyArr[i].CityID == value2)
                                $(".county").append("<option>"+countyArr[i].DisName+"</option>")
                        }
                    })
                    $(".city").change(function(){
                        var value = $(this).val();
                        $(".county option").remove();
                        for(var i=0;i<countyArr.length;i++){
                            if(countyArr[i].CityID == value)
                                $(".county").append("<option>"+countyArr[i].DisName+"</option>")//把数据拼接到.county下的option里
                        }

                    })
                })
            })

            // 手机号码正则验证
            var testTel=function(value){
                var reg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;
                if(!reg.test(value)){
                    alert("你输入的手机号码不正确，请重新输入。")
                    return false;
                }
            };

            function addOrder() {
                var pro_id = getQueryString('pro_id');
                var amount = $("#amount").val();
                var key = getQueryString('key');
                var name = $('input[name="name"]').val();
                var mobile = $('input[name="mobile"]').val();
                var province = $('select[name="province"] option:selected').text();
                var city = $('select[name="city"] option:selected').text();
                var county = $('select[name="county"] option:selected').text();
                var address = $('input[name="address"]').val();
                var remark = $('#remark').val();
                if (name == '') {
                    alert('填写联系人姓名');
                    return;
                }
                if (mobile == '') {
                    alert('填写联系人电话');
                    return;
                }
                if (!/^1(3|4|5|7|8){1}\d{9}$/.test(mobile)) {
                    alert("手机号码格式不正确，请重新填写");
                    return;
                }
                var url = "/index.php/Orders/addBargainOrder";
                var data = {
                    pro_id: pro_id,
                    amount: amount,
                    name: name,
                    mobile: mobile,
                    message: remark,
                    address: province + city + county + address,
                    key:key
                };
                $.post(url, data, function (result) {
                    if (result.status == 0) {
                        return alert(result.msg);
                    } else {
                        window.location.href = "/index.php/WxPay/jsapiByBargain?orderId=" + result.orderId;
                    }
                }, 'json');
            }

            function agreement() {
                layer.open({
                    type: 1,
                    title: '服务协议',
                    shadeClose: false,
                    shade: 0.8,
                    area: ['80%', '70%'],
                    maxmin: true, //允许全屏最小化
                    anim: 2, //0-6的动画形式，-1不开启
                    content: "服务协议服务协议服务协议服务协议服务协议" //iframe的url
                });
            }

            function Refund_rule() {
                layer.open({
                    type: 1,
                    title: '退款规则',
                    shadeClose: false,
                    shade: 0.8,
                    area: ['80%', '70%'],
                    maxmin: true, //允许全屏最小化
                    anim: 2, //0-6的动画形式，-1不开启
                    content: "<ul><li>1、本套餐产品为特殊优惠活动，一经付款<strong>不支持退改</strong>；</li><li>2、成功购买本产品后，您将收到预约凭证&mdash;&mdash;电子码的短信消息（短信可能会被手机软件拦截）；</li><li>3、收到预约凭证后，请务必在指定时间内通过网站或电话进行预约，预约时所提交的姓名必须和入住人身份证上姓名一致；</li> <li>4、请务必提前3天或以上预约；周末房间紧张，建议提前至少2周预约；节假日房间务必第一时间预约，先到先得；</li><li>5、预约结果需以酒店或景区确认为准，如遇到预约日期无法预约，请和酒店或景区协商改期使用；</li><li>6、酒店或景区一旦确认核销电子码，此电子码立即失效，预约成功后不得更改或取消；电子码在没有核销前可转赠给亲友使用；</li><li>7、本产品截止前未支付款项则视为弃权，过期未预约或未使用则自动作废；</li><li>8、本产品为特价促销产品，不提供发票；</li> <li>9、最终解释权归<strong>优培</strong>官方所有。</li></ul>" //iframe的url
                });
            }

            function getClassTable() {
                var pro_id = getQueryString('pro_id');
                window.location.href = "/index.php/Product/getClassTable?pro_id="+pro_id;
            }

            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        </script>
    </body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->
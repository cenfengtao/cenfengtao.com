<?php
namespace Home\Controller;

use Think\Controller;
use Think\Exception;
use \Think\Image;

require_once __DIR__ . '/../../../ThinkPHP/Library/Org/Util/JSDDK.class.php';

class TestController extends Controller
{
    function setSessionTest()
    {
        $_SESSION['openid'] = $_GET['open_id'];
        $_SESSION['token'] = $_GET['token'];
        echo 'setSession and token ok';
    }

    function sendTest()
    {
        $wxuser = get_wxuser($_SESSION['token']);
        $jssdk = new \JSSDK($wxuser['appid'], $wxuser['appsecret']);
        $signPackage = $jssdk->GetSignPackage();
        $this->assign('signPackage', $signPackage);
        $this->display();
    }

    public function testUpload()
    {
        $this->display();
    }

    /**
     * 拼接图片
     * $photo:边框内的图片绝对路径：win:E:\xamp\htdocs\news\images/pic.png
     *                           linux:/usr/local/apache/htdocs/site/images/pic.png
     * $kuang:边框路径：与$photo格式相同
     */
    public function qrcodeByPoster()
    {
        if ($_POST) {
            if (!$_POST['background']) {
                return show(0, '背景图不能为空');
            }
            $background = $_POST['background'];
            if ($_POST['image'] && $_POST['type']) {
                //匹配出图片的格式
                if (preg_match('/^(data:\s*image\/(\w+);base64,)/', $_POST['image'], $result)) {
                    $type = $result[2];
                    $new_file = "Upload/Poster/".date('Ymd',time())."/";
                    if(!file_exists($new_file)){
                        //检查是否有该文件夹，如果没有就创建，并给予最高权限
                        mkdir($new_file, 0700);
                    }
                    $new_file = $new_file . time() . ".{$type}";
                    if (file_put_contents($new_file, base64_decode(str_replace($result[1], '', $_POST['image'])))) {
                        echo '新文件保存成功：', $new_file;
                    } else {
                        echo '新文件保存失败';
                    }
                }
            }
            $filename = [];
            foreach ($filename as $val) {
                $QR = imagecreatefromstring(file_get_contents($val['filename']));
                $background = imagecreatefromstring(file_get_contents($background));
                $QR_width = imagesx($QR);
                $QR_height = imagesy($QR);
                imagecopyresampled($background, $QR, $val['position'][0], $val['position'][1], 0, 0, 400, 400, $QR_width, $QR_height);
                $qrFilename = 'Upload/' . uniqid(time()) . '.png';
                imagepng($background, $qrFilename);
                $background = $qrFilename;
            }
//            Header("Content-type: image/png");  //      下面2句用来调试到页面上
//            imagepng($background);
//            return $qrFilename;
        } else {
            if (!$_GET['style_id']) {
                return show(0, '参数错误');
            }
            $posterStyle = D('PosterStyle')->find($_GET['style_id']);
            return show(1, '获取成功', $posterStyle);
        }
    }

    public function qrcodeBack()
    {
        $filename = "E:/WWW/youpei_2.0/Public/images/test.png";
        $background = "E:/WWW/youpei_2.0/Public/images/qrcode2.png";
        $QR = imagecreatefromstring(file_get_contents($filename));
        $background = imagecreatefromstring(file_get_contents($background));
        $QR_width = imagesx($QR);
        $QR_height = imagesy($QR);
        imagecopyresampled($background, $QR, 300, 400, 0, 0, 400, 400, $QR_width, $QR_height);
        //增加文字
        $font = 'arial.ttf';
        imagettftext($background, 30, 0, 111, 211, imagecolorallocate($background, 128, 128, 128), $font, "Hello World!");
        $qrFilename = 'Upload/' . uniqid(time()) . '.png';
//                imagepng($background, $qrFilename);
        Header("Content-type: image/png");  //      下面2句用来调试到页面上
        imagepng($background);
        return $qrFilename;
    }

    public function testEncode()
    {
        $baseStr = "data:image/jpg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAKAAD/4QNvaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MkIyNDFENjVDNjJFRTcxMTlCNzhDOUE0NDYyMEVEODQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDcwOTQwNEEzNjEwMTFFN0IyMkRFMjQ5QjU0RjIzNEQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDcwOTQwNDkzNjEwMTFFN0IyMkRFMjQ5QjU0RjIzNEQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMTc0OTFBRTMwNzgxMUU3OTM5NURFNTNBNzlFMDY1RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBMTc0OTFBRjMwNzgxMUU3OTM5NURFNTNBNzlFMDY1RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABQQEBkSGScXFycyJh8mMi4mJiYmLj41NTU1NT5EQUFBQUFBREREREREREREREREREREREREREREREREREREREQBFRkZIBwgJhgYJjYmICY2RDYrKzZERERCNUJERERERERERERERERERERERERERERERERERERERERERERERERERP/AABEIARABDAMBIgACEQEDEQH/xACmAAACAwEBAAAAAAAAAAAAAAAEBQECAwAGAQADAQEBAAAAAAAAAAAAAAABAgMEAAUQAAEDAQQFCQUFCAECBwEAAAEAAgMRITESBEFRcRMFYYGRodEiMlIUscFCchVigqIjBvDhksIzQ4MkJfFE8lNjc8M0RRYRAAICAQMDAwIEBQUBAAAAAAABEQIDITESQVEyYXEiEwSBkaFCwdHhUmLwcoIjFDP/2gAMAwEAAhEDEQA/APRZrP7t2CO8XlCevm83UOxDE1NTpXLM7NllVBXr5/N1DsXeuns72kaB2IZSBaNq5NzuBpQGnNyj4uoKpzs3m6gsiqFVbIm3rpvN1BR66bzdQQ5UISwhPrp/N1DsXeun83UOxCqV0s4I9fP5uodi718/m6h2IZchLOCfXz+bqHYu9fP5uodiGXLpZwT6+fzdQ7F3r5/N1DsQy5dLOCfXz+bqHYoOfn83UOxDKjnUXSzgl3Epx8XUOxYHiuZJsf8Ahb2IN7sWxcxpcaC9OI2Gt4nmnGgfb8rexGNzk4Fr6nYOxCRRiMWX6StErbGQR62bzdQXetm83UEOuXSzgj1s3m6gu9bN5uoIdculnBPrZvN1Bd62bzdQQy5dLOCfWzebqC71s3m6gh1y6WAI9ZN5uoLvWTebqCHXIyzguPPSNPetCY71uDeV7qRonEfTU+3TqRlnSAqVClZzScrNvCiilt6K3BbYuVUqSVUqpAqVaUMDvynFzafELj1KFCATlC5cgccuXKVwSFylcuOIUFSVRxouAQ51EM9+LYpe/FYLlDGF5oE6UCNyQxheaBHRxiMUHOujjDBQK6VuRkoOUqFyATlKhciAlcoXLjjlKhcuOJALjhaKk3AKXMdGcLxQ7aqvKL1wsRASpUKwC44hEU/1/v8AuWNFviHp/v8AuTQCQFSuUrOajlo1tlVQ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";
        //匹配出图片的格式
        if (preg_match('/^(data:\s*image\/(\w+);base64,)/', $baseStr, $result)) {
            $type = $result[2];
            $new_file = "Upload/";
            $new_file = $new_file . time() . ".{$type}";
            if (file_put_contents($new_file, base64_decode(str_replace($result[1], '', $baseStr)))) {
                echo '新文件保存成功：', $new_file;
            } else {
                echo '新文件保存失败';
            }
        }
    }
}

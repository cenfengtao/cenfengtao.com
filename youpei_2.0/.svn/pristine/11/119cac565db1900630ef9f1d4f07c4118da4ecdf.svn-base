<include file="Common:header"/>
<link rel="stylesheet" href="__PUBLIC__/Home/css/qiangou.css">
<style>
    .bor {
        border-bottom: 1px solid #ccc;
        margin-bottom: 20px;
    }

    .loc {
        color: #757575 !important;
        font-size: 0.85rem !important;
        font-weight: bold;
    }

    .iconfont, [data-icon]:before {
        font-size: 0.85rem !important;
    }

    .swiper-slide .rig .labels span {
        width: auto;
    }

    .gps {
        font-size: 1rem;
    }

    /*轮播 start*/
    .banner {
        clear: both;
        height: 33vw;
        overflow: hidden;
        position: relative;
    }

    .banner .bd {
        height: 33vw;
        overflow: hidden;
    }

    .banner .bd ul {
        overflow: hidden;
    }

    .banner .bd li {
        height: 33vw;
        overflow: hidden;
        float: left;
        width: 100%;
    }

    .banner .bd li img {
        height: 33vw;
        width: 100%;
        display: block;
    }

    .banner .hd {
        position: absolute;
        bottom: 0.3rem;
        text-align: center;
        width: 100%;
    }

    .banner .hd ul {
        display: inline-block;
        *display: inline;
        *zoom: 1;
    }

    .banner .hd ul li {
        width: .5rem;
        height: .5rem;
        text-align: center;
        display: inline-block;
        line-height: 24px;
        border-radius: 12px;
        background-color: #fff;
        color: white;
        cursor: pointer;
        margin: 0 .25rem;
        vertical-align: middle
    }

    .banner .hd ul li.on {
        background: #ffce55;
        font-weight: bold;
        color: white;;
    }
    .classes{
        white-space: nowrap;
        overflow-x:scroll;
    }
    .classes > a {
        margin-right: 0.4rem;;
    }

    .classes > a:nth-child(1) {
        margin-left: 0.4rem;
    }

    .classes a img {
        width: 30.5% !important;
    }
    .change-headernav ul li{
        width: 20%;
    }
</style>
<!-- 菜单 开始 -->
<div class="kap-top ty-menu-top">
    <div class="ty-announce" id="ty_announce_top" style="display:none;" data-ty-page="" data-ty-args="">
        <div class="content"></div>
        <span data-icon="ă" class="btn-close"></span>
    </div>
    <div id="tools_loading" class="ty-tools ty-tools-loading">
        <a href="javascript:void(0);" class="btn btn-back-loading" title="返回" data-icon="ɒ"></a>
    </div>
    <div id="tools_hot" class="ty-tools ty-tools-hot ty-tools-current" data-ty-autohide="false">
        <span class="title" data-icon=""><a href="/index.php/Company/introduce/token/g232238gc959"><img
                src='../../../../Public/images/5886c9b0d0eac.jpg' width="26%" height=""></a></span>
        <div class="ty-tools-search">
            <div class="input-jump" data-ty-target="#page_search"
                 onclick="window.location.href='/index.php/Index/search'">搜索精彩内容...
                <!--onclick="_hmt.push(['_trackEvent', 'topbar', 'click', '首页搜索']);">搜索精彩内容...-->
            </div>
            <i data-icon="Đ"></i>
        </div>
        <div class="ty-tools-cityswitch">
            <select id="sel_city_switch" data-kap-skin="sel-city-switch" data-icon-blue="Ė"
                    style="opacity: 0; position: absolute; border: medium none; left: 0px; top: 0px; width: 100%; height: 100%;">
                <option value="1">广州</option>
                <option value="2">深圳</option>
                <option value="0" selected="">全部</option>
            </select>
        </div>
    </div>
    <div id="tools_search" class="ty-tools ty-search-bar" data-ty-autohide="false">
        <a href="javascript:void(0);" class="btn-home" title="首页" data-icon="ɒ"></a>
        <div class="ty-tools-search">
            <form id="page_hot_search">
                <div class="ty-tools-typeswitch">
                    <div data-kap="_kap_1" class="kap-input sel-type-switch" style="position: relative;"><select
                            data-kap-skin="sel-type-switch" data-icon="Ė" id="sel_type_switch"
                            style="opacity: 0; position: absolute; border: medium none; left: 0px; top: 0px; width: 100%; height: 100%;">
                        <option value="1">活动</option>
                        <option value="2">达人</option>
                    </select><span data-icon="Ė" class="kap-input-value">活动</span></div>
                </div>
                <input class="input" id="page_hot_keyword" placeholder="搜索活动、达人..." type="search"></form>
            <i data-icon="Đ"></i>
        </div>
        <div class="btn-search">搜索</div>
    </div>
</div>
<div id="page_hot" title="热推" class="kap-page kap-page-current" data-ty-tools="#tools_hot,#tools_idx,#side_common">
    <div class="ty-page" data-ty-current="12" data-ty-total="377" data-filter-tags="" data-ty-seriesid="0"
         data-ty-title="" data-ty-talents="" data-ty-pic="">
        <section class="banner">
<!--             <span class="ty-banner-prev-btn" data-icon="Ĩ" id="prev" onclick="prev()"></span>
            <span class="ty-banner-next-btn" data-icon="Ĩ" id="next" onclick="next()"></span> -->
            <div class="bd">
                <ul class="imgLi">
                </ul>
            </div>
            <div class="hd">
                <ul>
                    <li class="on"></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
            <!--<span id="left"></span>-->
            <!--<span id="right"></span>-->
        </section>
        <div class="headernav headernav2 change-headernav clr">
            <ul class="list-tags clr homec">
            </ul>
        </div>
        <div class="limit-area on">
            <div class="limit-head">
                <span class="title" data-icon="⏰">今日限时抢购</span>
                <!--<span class="more" data-icon-after="Ĩ" data-ty-target="#page_activity_tag">查看更多<i-->
                <!--data-icon="ɑ"></i></span>-->
            </div>
            <div class="device">
                <!--<a class="arrow-left" href="#"></a>-->
                <!--<a class="arrow-right" href="#"></a>-->
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide banner0" style="width:100%;"></div>
                        <div class="swiper-slide banner1" style="width:100%;"></div>
                        <div class="swiper-slide banner2" style="width:100%;"></div>
                        <div class="swiper-slide banner3" style="width:100%;"></div>
                    </div>
                </div>
                <div class="pagination"></div>
            </div>
        </div>
        <ul class="list-rec">
            <li class="item">
                <div class="poster">
                    <a href="{:U('Groups/index')}">
                        <img src="../../../../Public/images/banner1.jpg"
                             data-kap-lazy="../../../../Public/images/banner1.jpg"
                             alt="" width="640" height="320">
                    </a>
                </div>
                <!--<div class="ty-rec-view ty-sc-h">-->
                <!--<a href="javascript:void(0);" class="item" data-ty-target="#detail_activity"-->
                <!--data-ty-seriesid="7624"><img src="../../../../Public/images/_20170508105533_01.jpg"-->
                <!--data-kap-lazy="../../../../Public/images/_20170508105533_01.jpg" alt="">-->
                <!--<p class="name">优培家教</p>-->
                <!--<p>团购更优惠</p><span class="price">5800</span></a>-->
                <!--<a href="javascript:void(0);" class="item" data-ty-target="#detail_activity"-->
                <!--data-ty-seriesid="7801"><img src="../../../../Public/images/_20170508105533_02.jpg"-->
                <!--data-kap-lazy="../../../../Public/images/_20170508105533_02.jpg" alt="">-->
                <!--<p class="name">户外活动</p>-->
                <!--<p>团购更优惠</p><span class="price">7800</span></a>-->
                <!--<a href="javascript:void(0);" class="item" data-ty-target="#detail_activity"-->
                <!--data-ty-seriesid="8354"><img src="../../../../Public/images/_20170508105533_03.jpg"-->
                <!--data-kap-lazy="../../../../Public/images/_20170508105533_03.jpg" alt="">-->
                <!--<p class="name">智趣乐园</p>-->
                <!--<p>团购更优惠</p><span class="price">2680</span></a>-->
                <!--<a href="javascript:void(0);" class="item" data-ty-target="#detail_activity"-->
                <!--data-ty-seriesid="7849"><img src="../../../../Public/images/_20170508105533_01.jpg"-->
                <!--data-kap-lazy="../../../../Public/images/_20170508105533_01.jpg" alt="">-->
                <!--<p>美娜多</p>-->
                <!--<p>8天7夜</p><span class="price">12800</span></a>-->
                <!--</div>-->
            </li>
        </ul>

        <h2 class="ty-title red bor">课程精选</h2>
        <div class="classes">
            <a href="###"><img src="" alt=""></a>
            <a href="###"><img src="" alt=""></a>
            <a href="###"><img src="" alt=""></a>
            <a href="###"><img src="" alt=""></a>
        </div>
        <h2 class="ty-title red">热门课程</h2>
        <div class="ty-cat-tags homep">
            <a href="javascript:;" onclick="getProductByType(0)"> <span
                    class="tag link on" id="first_class" attr_id="0">热门</span></a>
            <!-- <span class="show-all off" data-icon="?">展开</span> -->
        </div>
        <ul class="list-card">

        </ul>

    </div>
</div>
<include file="Common:menu"/>
<!-- 独立弹窗 结束 -->
<span id="btn_top" class="iconfont btn-top-hide">Ė</span>
<script src="../../../../Public/Home/js/idangerous.swiper.min.js"></script>
<include file="Common:footer"/>
<script type="text/javascript">
    $(function () {
        $(".ty-cat-tags a").click(function () {
            $(this).find("span").addClass("tag link on").parent().siblings().find("span").removeClass("on");
        });
        var first_class_id = $('#first_class').attr('attr_id');
        getProductByType(first_class_id);
    });

    function getProductByType(id) {
        page();
        var url = "{:U('Index/getProductByType')}";
        $.post(url, {id: id}, function (result) {
            if (result.status == 1) {
                //加载层
                layer.load();
                setTimeout(function () {
                    layer.closeAll('loading');
                }, 1000);

                $(".list-card li").remove();
                $.each(result.data, function (index, value) {
                    $(".list-card").append("<li class='item'>" +
                            "<a href={:U('Product/productDetails')}?pro_id=" + value['id'] + ">" +
                            "<span class='thumb' style=''><img src='" + value['pic_url'] + "'></span>" +
                            "<div class='desc'>" +
                            "<span data-icon='Ć' class='loc'><a class='gps' href={:U('Map/GPS')}?id=" + value['id'] + ">" + value['city'] + value['area'] + value['add'] + "</a></span>" +
                            "<div class='triangle'><p class='text'>" + value['class_title'] + "</p></div>" +
                            "<h3 class='title'>" + value['title'] + "</h3>" +
                            "<span class='price'>" + value['price'] + "</span>" +
                            "<span class='talent'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>" +
                            "<div class='tags'>" +
                            "<span class='tag red'>" + value['tagA'] + "</span>" +
                            "<span class='tag'>" + value['tagB'] + "</span>" +
                            "<span class='tag'>" + value['tagC'] + "</span>" +
                            "</div>" +
                            "</div>" +
                            "</a>" +
                            "</li>");
                });
            } else {
                return $('.list-card').html("<li class='empty'>没有该类型商品</li>");
            }
        }, 'json');

    }
    function page() {
        return npage = 3;
    }
    var npage = 3;
    $(function () {
        $(window).scroll(function () {
            var scrollTop = $(this).scrollTop();
            var scrollHeight = $(document).height();
            var windowHeight = $(this).height();
            if (scrollTop + windowHeight == scrollHeight && npage != 0) {
                $(this).scrollTop(scrollHeight - 50);
                //加载层
                layer.load();
                setTimeout(function () {
                    layer.closeAll('loading');
                }, 1000);
                var first_class_id = $('.ty-cat-tags .on').attr('attr_id');
                var url = "{:U('Index/loadingProduct')}";
                var params = {};
                params.first_class_id = first_class_id;
                params.npage = npage;
                $.post(url, params, function (result) {
                    if (result.status == 0) {
                        $(".empty").remove();
                        npage = 0;
                        return $('.list-card').append("<li class='empty'>没有更多了</li><li class='empty'>粤ICP备17008351号</li>");
                    }
                    $.each(result.data, function (index, value) {
                        $(".list-card").append("<li class='item'>" +
                                "<a href={:U('Product/productDetails')}?pro_id=" + value['id'] + ">" +
                                "<span class='thumb' style=''><img src='" + value['pic_url'] + "'></span>" +
                                "<div class='desc'>" +
                                "<span data-icon='Ć' class='loc'><a class='gps' href={:U('Map/GPS')}?id=" + value['id'] + ">" + value['city'] + value['area'] + value['add'] + "</a></span>" +
                                "<div class='triangle'><p class='text'>" + value['class_title'] + "</p></div>" +
                                "<h3 class='title'>" + value['title'] + "</h3>" +
                                "<span class='price'>" + value['price'] + "</span>" +
                                "<span class='talent'><i class='avatar'><img src='" + value['image'] + "' alt=''></i></span>" +
                                "<div class='tags'>" +
                                "<span class='tag red'>" + value['tagA'] + "</span>" +
                                "<span class='tag'>" + value['tagB'] + "</span>" +
                                "<span class='tag'>" + value['tagC'] + "</span>" +
                                "</div>" +
                                "</div>" +
                                "</a>" +
                                "</li>");
                    });
                })
                npage += 3;
            }
        });
    });
    /** ***********************广告显示 start************************ */

    var curIndex = 0, //当前index
            imgLen = $(".imgList li").length; //图片总数

    // 定时器自动变换2.5秒每次
    var autoChange = setInterval(function () {
        if (curIndex < imgLen - 1) {
            curIndex++;
        } else {
            curIndex = 0;
        }
        //调用变换处理函数
        changeTo(curIndex);
    }, 2500);
    //左箭头滑入滑出事件处理
    $("#prev").hover(function () {
        //滑入清除定时器
        clearInterval(autoChange);
    }, function () {
        //滑出则重置定时器
        autoChangeAgain();
    });
    //左箭头点击处理
    $("#prev").click(function () {
        //根据curIndex进行上一个图片处理
        curIndex = (curIndex > 0) ? (--curIndex) : (imgLen - 1);
        changeTo(curIndex);
    });
    //右箭头滑入滑出事件处理
    $("#next").hover(function () {
        //滑入清除定时器
        clearInterval(autoChange);
    }, function () {
        //滑出则重置定时器
        autoChangeAgain();
    });
    //右箭头点击处理
    $("#next").click(function () {
        curIndex = (curIndex < imgLen - 1) ? (++curIndex) : 0;
        changeTo(curIndex);
    });
    //对右下角按钮index进行事件绑定处理等
    $(".indexList").find("i").each(function (item) {
        $(this).hover(function () {
            clearInterval(autoChange);
            changeTo(item);
            curIndex = item;
        }, function () {
            autoChangeAgain();
        });
    });
    //清除定时器时候的重置定时器--封装
    function autoChangeAgain() {
        autoChange = setInterval(function () {
            if (curIndex < imgLen - 1) {
                curIndex++;
            } else {
                curIndex = 0;
            }
            //调用变换处理函数
            changeTo(curIndex);
        }, 4000);
    }
    function changeTo(num) {
        var system = {
            win: false,
            mac: false,
            xll: false
        };
        var p = navigator.platform;
        system.win = p.indexOf("Win") == 0;
        system.mac = p.indexOf("Mac") == 0;
        system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
//跳转语句
        if (system.win || system.mac || system.xll) {

            var goLeft = num * 640;
            $(".imgList").animate({left: "-" + goLeft + "px"}, 500);
            $(".indexList").find("i").removeClass("indexOn").eq(num).addClass("indexOn");
        } else {
            var goLeft = num * 25;
            $(".imgList").animate({left: "-" + goLeft + "rem"}, 500);
            $(".indexList").find("i").removeClass("indexOn").eq(num).addClass("indexOn");
        }
    }

    //倒计时
    var time_current = (new Date()).valueOf();//获取当前时间
    $(function () {
        var dateTime = new Date();
        var difference = dateTime.getTime() - time_current;

        setInterval(function () {
            $(".endtime").each(function () {
                var obj = $(this);
                var endTime = new Date(parseInt(obj.attr('value')) * 1000);
                var nowTime = new Date();
                var nMS = endTime.getTime() - nowTime.getTime() + difference;
                var myD = Math.floor(nMS / (1000 * 60 * 60 * 24));
                var myH = Math.floor(nMS / (1000 * 60 * 60)) % 24;
                var myM = Math.floor(nMS / (1000 * 60)) % 60;
                var myS = Math.floor(nMS / 1000) % 60;
                var myMS = Math.floor(nMS / 100) % 10;
                if (myD >= 0) {
                    var str = myD + "天  " + myH + ":" + myM + ":" + myS;
                } else {
                    var str = "已结束！";
                }
                obj.html(str);
            });
        }, 100);
    });

    var mySwiper = new Swiper('.swiper-container', {
        pagination: '.pagination',
        loop: true,
        grabCursor: true,
        paginationClickable: true
    });
    $('.arrow-left').on('click', function (e) {
        e.preventDefault();
        mySwiper.swipePrev()
    });
    $('.arrow-right').on('click', function (e) {
        e.preventDefault();
        mySwiper.swipeNext()
    });

    function signin() {
        window.location.href = "{:U('Sign/index')}";
    }

    //查看商品
    $(".swiper-slide").click(function () {
        var id = $(this).attr('attr_id');
        window.location.href = "{:U('Product/productDetails')}?pro_id=" + id;
    });
    $.ajax({
        type: "get",
        url: "{:U('Index/indexTest')}",
        aysnc: true,
        dataType: "json",
        success: function (data) {
            //遍历循环picture数据
            var imgList = $(".imgLi");
            var picture = data.data.picture;
            var pic_html = "";
            for (var j = 0; j <= picture.length - 1; j++) {
                pic_html = '<li>' +
                        '<a href="###" class="dian">' +
                        '<img src="/' + picture[j].image + '" alt="banner' + j + '">' +
                        '</a>' +
                        '</li>';
                imgList.append(pic_html);
                if (j == 1) {
                    document.getElementsByClassName("dian")[j].setAttribute("class", "dianji");
                    $(".dianji").attr("href", picture[j].url);
                }
            }
$(function(){
      var winW=$(window).width();
    $(winW).resize(function(){
        location.reload()
    })
            //获取小圆点的集合
        var  circleList =  $(".hd ul>li");
        //获取banner图集合
        var bannerList = $(".bd ul li");
    var len=circleList.length;
        //左右箭头切换标记
        var circleTag = 0;
        var liLen=bannerList.length;
        //自动轮播标记
              var autoTag = 0;
        $(".bd ul").css({"width":winW*liLen+"px"});
        $(".bd li").width(winW);
        //小圆点切换banner图
        circleList.each(function(i){
            //为每一个小圆点绑定mouseover事件
            $(this).click(function(){
                clearlunbo();
                //鼠标移动到哪个圆点上，为该圆点增加active样式
              circleList.eq(i).addClass("on");
                //其他圆点取消active样式
                circleList.not(circleList.eq(i)).removeClass("on");
                //切换对应的banner图
                bannerList.eq(i).show();
                bannerList.not(bannerList.eq(i)).hide();
                
                    circleTag = i;
                    autoTag = i;
            })
            
        })
            //左箭头切换上一张
        function prev(){
                
                circleTag--;
                // console.log(circleTag)
                if(circleTag<0){
                    circleTag =len-1;
                }
                circleList.eq(circleTag).trigger("click");
            }
        
        //右箭头切换下一张
        function next(){
                circleTag++;
                //当下一页为最后一页时，则重置索引值，显示第一页
                if(circleTag>len-1){
                    circleTag =0;
                }
                circleList.eq(circleTag).trigger("click");
        }
      $(".bd ul li").swipe({
        swipeLeft: function(){
            next();
//          clearlunbo();
        },
        swipeRight: function(){
            prev();
//          clearlunbo();
        },
    })
        
            //自动轮播
        var autoTag=0;
//          var bool=true;
        var downtime =  setInterval(action,3000);//每隔一秒调用action函数
        //执行自动轮播的函数
        function action(){
                autoTag++;
            //如果已经是最后一页了，则重置为第一页
            if(autoTag>len-1){
                autoTag = 0;
            }
            circleList.eq(autoTag).trigger("click") 
        }       
        function clearlunbo(){
            clearInterval(downtime);
            setTimeout(function(){
                downtime=setInterval(action,3000)
            },1)
        }
})
            //遍历循环homec数据
            var homec = $(".homec");
            var c = data.data.Homec;
            for (i in c) {
                homec.append('<li><a href="' + c[i].url + '"><div class="ico"><img src="/' + c[i].image + '" alt=""></div><div class="fz16"><span>' + c[i].title + '</span></a></div>')
                if (c[i].title == '签到') {
                    document.getElementsByClassName("fz16")[i].setAttribute("class", "button fz16");
                    $(".button >a").attr("href", "###")
                }
            }
            $(".button").click(function () {
                signin()
            })
            ////遍历循环homep数据
            var homep = $(".homep");
            var p = data.data.Homep;
            var html = "";
            for (var i = 0; i <= p.length - 1; i++) {
                html = '<a href="javascript:;" onclick="getProductByType(' + p[i].id + ')">' +
                        '<span class="tag link" attr_id="' + p[i].id + '">' + p[i].title + '</span>' +
                        '</a>';
                homep.append(html)
            }
            //点击切换当前对象
            $(".tag").click(function () {
                $(this).parent().siblings().find("span").removeClass("on");
                $(this).addClass("on");
            })
            $.each(data['data']['limitBuy'], function (index, item) {
                var className = ".banner" + index;
                $(className).attr('attr_id', item['id']);
                $(className).append(
                        "<img class='thumb' src='" + item['thumb_image'] + "'>" +
                        "<div class='rig'>" +
                        "<div class='triangle'><p class='text'>折扣</p></div><div class='title'>" + item['title'] + "</div>" +
                        "<div class='labels'></div>" +
                        "<div class='price'>" +
                        "<span class='original'>原价:￥" + parseInt(item['original_price']) + "</span>" +
                        "<span class='current'>抢购价:￥" + parseInt(item['rush_price']) + "</span>" +
                        "</div>" +
                        "</div>" +
                        "<div class='bot'>剩余时间 还剩<em class='endtime showtime' value=" + item['end_time'] + "></em></div>"
                );
                if (item['tagA']) {
                    $(className).find('.labels').append(
                            "<span class='label1'>" + item['tagA'] + "</span>"
                    );
                }
                ;
                if (item['tagB']) {
                    $(className).find('.labels').append(
                            "<span class='label2'>" + item['tagB'] + "</span>"
                    );
                }
                ;
                if (item['tagC']) {
                    $(className).find('.labels').append(
                            "<span class='label3'>" + item['tagC'] + "</span>"
                    );
                }
                ;
            });
            //遍历循环sifts数据
            var classes = $(".classes");
            var sifts = data.data.sifts;
            var sifts_html = "";
            for (var l = 0; l <= sifts.length - 1; l++) {
                sifts_html += '<a class="item" href={:U('
                ProductproductDetails
                ')}?pro_id=' + sifts[l].id + '">' +
                '<img style=width:31%;height:12vh;margin:0 1%; src="' + sifts[l].thumb_image + '" alt="">' +
                '</a>'
            }
            classes.html(sifts_html)
        },
        error: function () {

        }
    })
    $(function () {
        $(window).resize(function () {
            location.reload();
        })

    })
</script>
</body>
</html>
<!--tailTrap<body></body><head></head><html></html>-->
<include file="Common:header"/>
<link href="__PUBLIC__/Home/css/style.css" rel="stylesheet"/>
<link rel="stylesheet" href="__PUBLIC__/css/home/faxian.css">
<style>
    .selling .price{
        line-height: 2rem;
    }
    .map{
        display: inline-block;
        width: 100%;
        height:13rem;
        z-index: 10000;
        position: absolute;
    }
     /*轮播 start*/
    .banner {
        clear: both;
        height: 30vw;
        overflow: hidden;
        position: relative;
        margin-top: 2.5rem;
        border-bottom: 0.01rem solid #F0F1F1;
    }

    .banner .bd {
        height: 30vw;
        overflow: hidden;
    }

    .banner .bd ul {
        overflow: hidden;
    }

    .banner .bd li {
        height: 30vw;
        overflow: hidden;
        float: left;
        width: 100%;
    }

    .banner .bd li img {
        height: 30vw;
        width: 100%;
        display: block;
    }

    .banner .hd {
        position: absolute;
        bottom: 0.3rem;
        text-align: center;
        width: 100%;
    }

    .banner .hd ul {
        display: inline-block;
        *display: inline;
        *zoom: 1;
    }

    .banner .hd ul li {
        width: .5rem;
        height: .5rem;
        text-align: center;
        display: inline-block;
        line-height: 24px;
        border-radius: 12px;
        background-color: #fff;
        color: white;
        cursor: pointer;
        margin: 0 .25rem;
        vertical-align: middle
    }

    .banner .hd ul li.on {
        background: red;
        font-weight: bold;
        color: white;;
    }
    .toptitle::before{
        height: 0rem!important;
    }
    .ty-view-all .ty-page {
    padding: 0rem 0 6.25rem 0!important;
}
</style>
<script src="__PUBLIC__/Home/js/common.js"></script>
<div id="page_activity" class="kap-page kap-page-current" title="{$title}">
     <div class="kap-top ty-menu-top">
    <div id="tools_msg" class="ty-tools ty-tools-inner ty-tools-current">
        <span class="title">{$title}<span class="num"></span></span>
        <a href="javascript:history.go(-1);" class="btn left btn-user" title="返回" data-icon="ɒ"></a>
        <a href="{:U('Index/index')}" class="btn right btn-user" title="返回首页" data-icon="Ņ"></a>
    </div>
</div>
<section class="banner">
    <div class="bd">
        <ul class="imgLi">
        <li>
            <a href="/index.php/Poster/index.html?style_id=4"><img src="../../../../Public/images/fffffff.png" alt=""></a>
        </li>    
        <li>
            <a href="/index.php/Sign/index.html"><img src="../../../../Public/images/red.jpg" alt=""></a>
        </li>   
        <li>
            <a href="/index.php/Product/productDetails.html?pro_id=57"><img src="/Upload/adspic/2017-09/59ad05e3955d7.jpg"></a>
        </li>   
        </ul>
    </div>
    <div class="hd">
        <ul>
            <li class="on"></li>
            <li></li>
            <li></li>
        </ul>
    </div>
</section>
    <div class="ty-page" data-ty-current="12" data-ty-total="115" data-filter-tags="" data-filter-type="6"
         data-filter-age="0" data-filter-days="0" data-filter-status="0" data-filter-beans="0" data-filter-keyword=""
         data-sort-key="0">

        <div class="headernav headernav2 change-headernav clr toptitle finder">
            <ul class="list-tags clr">
                <li>
                    <a href="{:U('Map/index')}" onclick="">
                        <div class="ico"><img src="__PUBLIC__/images/Finder_5.png" alt="">
                        </div>
                        <div class="fz16">
                            <span>地图</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{:U('Article/index',array('cate_id'=>1))}" >
                        <div class="ico"><img src="__PUBLIC__/images/Finder_1.png" alt="">
                        </div>
                        <div class="fz16">
                            <span>文章</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{:U('Boutique/index')}">
                        <div class="ico"><img src="__PUBLIC__/images/Finder_3.png" alt="">
                        </div>
                        <div class="fz16">
                            <span>精品</span>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="{:U('Article/index',array('cate_id'=>9))}">
                        <div class="ico"><img src="__PUBLIC__/images/Finder_2.png" alt="">
                        </div>
                        <div class="fz16">
                            <span>福利</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="hotel-cat"></div>
        <a href="{:U('Map/index')}" class="map" ></a>
        <iframe src="{:U('Map/index')}" style="width:100%; height:13rem;z-index: 10" frameborder="0" onload="hideHead(this)"></iframe>
        <ul class="list-card list-height">
            <li class="item" data-ty-target="#detail_activity" data-ty-seriesid="8798">
                <div class="device">
                    <a class="arrow-left" href="#"></a>
                    <a class="arrow-right" href="#"></a>
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <volist name="helpChildList" id="val">
                            <div class="swiper-slide" onclick="getArticle({$val['id']})">
                                <img src="{$val['image']}">
                                <div class="triangle left" style=""><p class="text" style="">热帖</p></div>
                                <div class="black">{$val.title|mb_substr=###,0,17,'utf-8'}</div>
                            </div>
                            </volist>
                        </div>
                    </div>
                    <div class="pagination"></div>
                </div>
                <!--<div class="mainvisual">
                    &lt;!&ndash;<div class="flickingcon">&ndash;&gt;
                    &lt;!&ndash;<a href="#"></a>&ndash;&gt;
                    &lt;!&ndash;<a href="#"></a>&ndash;&gt;
                    &lt;!&ndash;<a href="#"></a>&ndash;&gt;
                    &lt;!&ndash;<a href="#"></a>&ndash;&gt;
                    &lt;!&ndash;<a href="#"></a>&ndash;&gt;
                    &lt;!&ndash;</div>&ndash;&gt;
                    <div class="mainimage">
                        <ul>
                            <volist name="helpChildList" id="val">
                                <li onclick="getArticle({$val['id']})">
                                    <span class="thumb"
                                          style="background-image:url({$val['image']}); background-size:cover"></span>
                                    <div class="triangle left" style=""><p class="text" style="">热帖</p></div>
                                    <div class="desc row">
                                        <label class="size red" style="color:#ffffff;text-align: center;display: block;line-height: 0.8rem;margin-left: -0.5rem;">{$val.title|mb_substr=###,0,17,'utf-8'}</label>
                                        &lt;!&ndash;<div class="tags bp">&ndash;&gt;
                                        &lt;!&ndash;<span class="tag red">自营11</span>&ndash;&gt;
                                        &lt;!&ndash;<span class="tag">自营</span>&ndash;&gt;
                                        &lt;!&ndash;</div>&ndash;&gt;
                                    </div>
                                </li>
                            </volist>
                        </ul>
                        &lt;!&ndash;<span class="title">精选育儿文章</span>&ndash;&gt;
                        <a href="javascript:;" id="btnprev"></a>
                        <a href="javascript:;" id="btnnext"></a>
                    </div>
                </div>-->
            </li>

            <li class="item-more selected"> —— 精选福利 ——</li>
            <li class="item" data-ty-target="#detail_activity" data-ty-seriesid="8798">
                <div class="device">
                    <a class="arrow-left1" href="#"></a>
                    <a class="arrow-right1" href="#"></a>
                    <div class="swiper-container1">
                        <div class="swiper-wrapper">
                            <volist name="parentList" id="val">
                                <div class="swiper-slide" onclick="getArticle({$val['id']})">
                                    <img src="{$val['image']}">
                                    <div class="triangle left" style=""><p class="text" style="">热帖</p></div>
                                    <div class="black">{$val.title|mb_substr=###,0,17,'utf-8'}</div>
                                </div>
                            </volist>
                        </div>
                    </div>
                    <div class="pagination1"></div>
                </div>
            </li>
            <li class="item mtop">
            <a href="{:U('Lottery/index')}?token=g232238gc959">
            <span class="thumb" style="background-image:url(/Public/images/1495531071.png); background-size:100% 100%"></span>
            </a>
            </li>
            <li class="item-more selected"> —— 热销商品 ——</li>
            <div style="" class="goods">
                <volist name="saleProduct" id="val">
                    <li class="item selling" onclick="getProduct({$val['id']})">
                        <img class="thumb" src="{$val['pic_url']}" style="width:23vh;height:18vh;">
                        <div class="triangle"><p class="text" style="">折扣 </p><i class="fireico">&nbsp;</i></div>
                        <span class="title"><nobr>{$val['title']}</nobr></span>
                        <span class="abstract">简介：{$val['f_title']}</span>
                        <span class="discounts">优惠价：<span class="price">{$val['price']}</span></span>
                    </li>
                </volist>
            </div>
            <div class="goods goodss"></div>
            <!--<li data-icon="Ĩ" class="item-more">-->
                <!--点击载入更多-->
            <!--</li>-->

        </ul>
    </div>
    <include file="Common:menu"/>
</div>

</div>
<script src="__PUBLIC__/Home/js/jquery.event.drag-1.5.min.js"></script>
<script src="__PUBLIC__/Home/js/jquery.touchSlider.js"></script>
<script src="__PUBLIC__/Home/js/idangerous.swiper.min.js"></script>
<script src="__PUBLIC__/Home/js/kap.js"></script>
<script src="__PUBLIC__/Home/layer/layer.js"></script>
<script src="__PUBLIC__/Home/js/idangerous.swiper.min.js"></script>
<script type="text/javascript">
$(function(){
    var winW=$(window).width();
    $(winW).resize(function(){
        location.reload()
    })
            //获取小圆点的集合
        var  circleList =  $(".hd ul>li");
        //获取banner图集合
        var bannerList = $(".bd ul li");
    var len=circleList.length;
        //左右箭头切换标记
        var circleTag = 0;
        var liLen=bannerList.length;
        //自动轮播标记
              var autoTag = 0;
        $(".bd ul").css({"width":winW*liLen+"px"});
        $(".bd li").width(winW);
        //小圆点切换banner图
        circleList.each(function(i){
            //为每一个小圆点绑定mouseover事件
            $(this).click(function(){
                clearlunbo();
                //鼠标移动到哪个圆点上，为该圆点增加active样式
              circleList.eq(i).addClass("on");
                //其他圆点取消active样式
                circleList.not(circleList.eq(i)).removeClass("on");
                //切换对应的banner图
                bannerList.eq(i).show();
                bannerList.not(bannerList.eq(i)).hide();
                
                    circleTag = i;
                    autoTag = i;
            })
            
        })
            //左箭头切换上一张
        function prev(){
                
                circleTag--;
                // console.log(circleTag)
                if(circleTag<0){
                    circleTag =len-1;
                }
                circleList.eq(circleTag).trigger("click");
            }
        
        //右箭头切换下一张
        function next(){
                circleTag++;
                //当下一页为最后一页时，则重置索引值，显示第一页
                if(circleTag>len-1){
                    circleTag =0;
                }
                circleList.eq(circleTag).trigger("click");
        }
      $(".bd ul li").swipe({
        swipeLeft: function(){
            next();
//          clearlunbo();
        },
        swipeRight: function(){
            prev();
//          clearlunbo();
        },
    })
        
            //自动轮播
        var autoTag=0;
//          var bool=true;
        var downtime =  setInterval(action,3000);//每隔一秒调用action函数
        //执行自动轮播的函数
        function action(){
                autoTag++;
            //如果已经是最后一页了，则重置为第一页
            if(autoTag>len-1){
                autoTag = 0;
            }
            circleList.eq(autoTag).trigger("click") 
        }       
        function clearlunbo(){
            clearInterval(downtime);
            setTimeout(function(){
                downtime=setInterval(action,3000)
            },1)
        }
})





    var mySwiper = new Swiper('.swiper-container',{
        pagination: '.pagination',
        loop:true,
        grabCursor: true,
        paginationClickable: true
    });
    $('.arrow-left').on('click', function(e){
        e.preventDefault();
        mySwiper.swipePrev();
    });
    $('.arrow-right').on('click', function(e){
        e.preventDefault();
        mySwiper.swipeNext();
    });
    var mySwiper1 = new Swiper('.swiper-container1',{
        pagination: '.pagination1',
        loop:true,
        grabCursor: true,
        paginationClickable: true
    });
    $('.arrow-left1').on('click', function(e){
        e.preventDefault();
        mySwiper1.swipePrev();
    });
    $('.arrow-right1').on('click', function(e){
        e.preventDefault();
        mySwiper1.swipeNext();
    });
    var npage = 7;
    $(function() {
        $(window).scroll(function() {
            var scrollTop = $(this).scrollTop();
            var scrollHeight = $(document).height();
            var windowHeight = $(this).height();
            if (scrollTop + windowHeight == scrollHeight) {
                //加载层
                layer.load();
                setTimeout(function(){layer.closeAll('loading');}, 1000);
                var url = "{:U('Discovery/loadingProduct')}";
                var params = {};
                params.npage = npage;
                $.post(url,params,function(result) {
                    if (result.status == 0) {
                        $(".empty").remove();
                        return $('.goodss').append("<li class='empty'>没有更多了</li>");
                    }
                    $.each(result.data, function (index, value) {
                        $(".goodss").append("<li class='item selling' onclick='getProduct( " + value['id'] + ")'>" +
                                "<img class='thumb'  style='width:23vh;height:18vh;' src='" + value['pic_url'] + "'>" +
                                "<div class='triangle'><p class='text'>折扣</p><i class='fireico'>&nbsp;</i></div>" +
                                "<span class='title'><nobr>" + value['title'] + "</nobr></span>" +
                                "<span class='abstract'>简介：" + value['f_title'] + "</span>" +
                                "<span class='discounts'>优惠价：<span class='price'>" + value['price'] + "</span></span>" +
                                "</li>");
                    });
                });
                npage += 6;
            }
        });
    });
    function getCateListById(id){
        window.location.href = "{:U('Article/index')}?cate_id="+ id;
    }
    $(document).ready(function () {
        // $(".mainvisual").hover(function(){
        //     $("#btnprev,#btnnext").fadeIn()
        // },function(){
        //     $("#btnprev,#btnnext").fadeOut()
        // });
        $dragBln = false;
        $(".mainimage").touchSlider({
            flexible: true,
            speed: 500,
            btn_prev: $("#btnprev"),
            btn_next: $("#btnnext"),
            paging: $(".flickingcon a"),
            counter: function (e) {
                $(".flickingcon a").removeClass("on").eq(e.current - 1).addClass("on");
            }
        });
        $(".mainimage").bind("mousedown", function () {
            $dragBln = false;
        });
        $(".mainimage").bind("dragstart", function () {
            $dragBln = true;
        });
        $(".mainimage a").click(function () {
            if ($dragBln) {
                return false;
            }
        });
        // timer = setInterval(function(){
        //     $("#btnnext").click();
        // }, 5000);

        // $(".mainvisual").hover(function(){
        //     clearInterval(timer);
        // },function(){
        //     timer = setInterval(function(){
        //         $("#btnnext").click();
        //     },5000);
        // });

        // $(".mainimage").bind("touchstart",function(){
        //     clearInterval(timer);
        // }).bind("touchend", function(){
        //     timer = setInterval(function(){
        //         $("#btnnext").click();
        //     }, 5000);
        // });
    });
    $(document).ready(function () {
        $dragBln = false;
        $(".mainimage1").touchSlider({
            flexible: true,
            speed: 500,
            btn_prev: $("#btnprev1"),
            btn_next: $("#btnnext1"),
            paging: $(".flickingcon1 a"),
            counter: function (e) {
                $(".flickingcon1 a").removeClass("on").eq(e.current - 1).addClass("on");
            }
        });
        $(".mainimage1").bind("mousedown", function () {
            $dragBln = false;
        });
        $(".mainimage1").bind("dragstart", function () {
            $dragBln = true;
        });
        $(".mainimage1 a").click(function () {
            if ($dragBln) {
                return false;
            }
        });
        // timer = setInterval(function(){
        //     $("#btnnext1").click();
        // }, 5000);

        // $(".mainvisual1").hover(function(){
        //     clearInterval(timer);
        // },function(){
        //     timer = setInterval(function(){
        //         $("#btnnext1").click();
        //     },5000);
        // });

        // $(".mainimage1").bind("touchstart",function(){
        //     clearInterval(timer);
        // }).bind("touchend", function(){
        //     timer = setInterval(function(){
        //         $("#btnnext1").click();
        //     }, 5000);
        // });
    });
    function getArticle(id) {
        window.location.href = "{:U('Article/getArticle')}?art_id=" + id;
    }
    function getProduct(id) {
        window.location.href = "{:U('Product/productDetails')}?pro_id=" + id;
    }
    function hideHead(i) {
        var head = i.contentWindow.document.getElementById('headTitle');
        head.style.display = 'none';
        var top = i.contentWindow.document.getElementById('qiandao');
        top.style.margin = '-13rem auto 0 auto';
        var allmap = i.contentWindow.document.getElementById('allmap');
        allmap.style.height = '26rem';
        var message = i.contentWindow.document.getElementById('message a');
        message.style.size = '6vh';
    }
</script>
<script src="__PUBLIC__/Home/js/selectivizr.js?v1.3"></script>
<!--加载 -->
<script src="__PUBLIC__/Home/js/pageloader.js"></script>
<script>
    jQuery(window).resize(function () {
        resizenow();
    });
    function resizenow() {
        var browserwidth = jQuery(window).width();
        var browserheight = jQuery(window).height();
        jQuery('.bonfire-pageloader-icon').css('right', ((browserwidth - jQuery(".bonfire-pageloader-icon").width()) / 2)).css('top', ((browserheight - jQuery(".bonfire-pageloader-icon").height()) / 2));
    }
    ;
    resizenow();
    wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: "{$signPackage['appId']}", // 必填，公众号的唯一标识
        timestamp: "{$signPackage['timestamp']}", // 必填，生成签名的时间戳
        nonceStr: "{$signPackage['nonceStr']}", // 必填，生成签名的随机串
        signature: "{$signPackage['signature']}",// 必填，签名，见附录1
        jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideOptionMenu', 'showOptionMenu', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'closeWindow', 'chooseImage', 'uploadImage', 'getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    });
    wx.ready(function () {
        wx.getLocation({
            success: function (res) {
                $.ajax({
                    url: "/index.php/Map/tranPosition",
                    type: "POST",
                    data: JSON.stringify(res),
                    dataType: "json",
                    success: function(json){
                        var latitudeNew = json.latitudeNew;
                        var longitudeNew = json.longitudeNew;
                        $('#lng').val(longitudeNew);
                        $('#lat').val(latitudeNew);
                        //创建小狐狸
                        var pt = new BMap.Point(longitudeNew, latitudeNew);
                        var myIcon = new BMap.Icon("http://www.youpei-exc.com/Public/images/blank.gif", new BMap.Size(14,14));
                        var marker2 = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
                        map.addOverlay(marker2);              // 将标注添加到地图中
                    },
                    error: function(){
                        alert("有错误！");
                    }
                })
            }
        });
        wx.onMenuShareAppMessage({
            title: "{$shareData['share_title']}",
            desc: "{$shareData['share_desc']}",
            link: "{$shareData['share_url']}",
            imgUrl: "{$shareData['share_img']}",
            success: function () {
                alert('分享成功');
            },
            cancel: function () {
                alert('已取消');
            }
        });
        wx.onMenuShareTimeline({
            title: "{$shareData['share_title']}",
            link: "{$shareData['share_url']}",
            imgUrl: "{$shareData['share_img']}",
            success: function () {
                alert('分享成功');// 用户确认分享后执行的回调函数
            },
            cancel: function () {
                alert('已取消');// 用户取消分享后执行的回调函数
            }
        });
        wx.error(function (res) {
            alert(JSON.stringify(res));
        });9
    })
</script>
</body>
</html>
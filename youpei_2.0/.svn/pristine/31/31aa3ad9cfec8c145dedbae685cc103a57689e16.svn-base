<include file="Common:header"/>
<!-- iCheck -->
<link href="__PUBLIC__/vendors/iCheck/skins/flat/green.css" rel="stylesheet">
<link rel="stylesheet" href="__PUBLIC__/css/admin/main.css">
<link rel="stylesheet" href="__PUBLIC__/js/webuploader/webuploader.css"/>
<body class="nav-md">
<div class="container body">
    <div class="main_container">
        <include file="Common:menu"/>
        <!-- page content -->
        <div class="right_col" role="main">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>添加消息</h2>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <br/>
                            <form id="myform" data-parsley-validate
                                  class="form-horizontal form-label-left form-youpei">
                            <input type='hidden' id='id' class='form-control' value='{$object.id}'/>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">标题 <span
                                            class="required">*</span></label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" value="{$object['title']}" id="title" name="title" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">内容</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <textarea id="msgContent" name="msgContent">{$object['msgcontent']}</textarea>
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">是否发送模板消息 <span
                                            class="required">*</span>
                                    </label>
                                    <div class="col-md-3 col-sm-6 col-xs-12 form_radio">
                                        否: <input type="radio" id="is_send_template" class="icheckbox_flat-green form-control" name="is_send_template" value="0" checked=""
                                         <if condition="$object['is_send_template'] == 0 ">checked</if>/>
                                        是: <input type="radio" id="is_send_template" class="icheckbox_flat-green form-control" name="is_send_template" value="1" <if condition="$object['is_send_template'] == 1 ">checked</if>/>
                                    </div>
                                </div>
                                <div id="org" <if condition="$object['is_send_template'] == 1 ">style="display: block;<else/>style="display: none;</if>">
                            
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">通知标题</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_title" name="template_title" value="{$object['template_title']}"
                                               class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">通知名称</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_first" name="template_first" value="{$object['template_first']}"
                                               class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">通知编号</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_second" name="template_second" value="{$object['template_second']}" class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">通知摘要</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_third" name="template_third" value="{$object['template_third']}"
                                               class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">备注信息</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_remark" name="template_remark"
                                               value="{$object['template_remark']}"
                                               class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12">跳转地址</label>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <input type="text" id="template_url" name="template_url" value="{$object['template_url']}"
                                               class="form-control col-md-7 col-xs-12">
                                    </div>
                                </div>
                          </div>
                                <div class="ln_solid"></div>
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                        <button class="btn btn-primary" type="reset">重置</button>
                                        <button type="submit"  class="btn btn-success btn_access" access_id="243">提交
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /page content -->
        <!-- footer content -->
        <include file="Common:footer"/>
        <!-- /footer content -->
    </div>
</div>
<!-- bootstrap-progressbar -->
<script src="__PUBLIC__/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
<!-- iCheck -->
<script src="__PUBLIC__/vendors/iCheck/icheck.min.js"></script>
<!-- self -->
<script src="__PUBLIC__/js/common.js"></script>
<script src="__PUBLIC__/js/formValidator/formValidator-4.1.3.js"></script>
<script src="__PUBLIC__/js/plugins/plugins.js"></script>
<script src="__PUBLIC__/js/upload.js"></script>
<script src="__PUBLIC__/js/webuploader/webuploader.js"></script>
<!-- uEditor -->
<script src="__PUBLIC__/vendors/ueditor/ueditor.config.js"></script>
<script src="__PUBLIC__/vendors/ueditor/ueditor.all.min.js"></script>
<script src="__PUBLIC__/vendors/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" charset="utf-8">
    window.UEDITOR_HOME_URL = "__PUBLIC__/vendors/ueditor/";
    $(document).ready(function () {
        UE.getEditor('msgContent', {initialFrameWidth: 900, initialFrameHeight: 400, serverUrl: "__PUBLIC__/vendors/ueditor/php/controller.php"});
    });

    // var SCOPE = {
    //     'jump_url': '{:U("Messages/addMessages")}',
    //     'success_url': '{:U("Messages/index")}'
    // };

     $('input[name="is_send_template"]').click(function () {
        if ($('input[name="is_send_template"]:checked').val() == 1) {
            $("#org").show();
        } else {
            $("#org").hide();
        }
    });
     $(  function () {
           $.formValidator.initConfig({
           theme:'Default',mode:'AutoTip',formID:"myform",debug:true,submitOnce:true,onSuccess:function(){
                   add();
                   return false;
            },onError:function(msg){
        }});

           $("#title").formValidator({onShow:"",onFocus:"请输入标题名",onCorrect:""}).inputValidator({min:1,max:20,onError:"标题不能为空,请确认"});
     });
     function add(){
        var params = WST.fillForm('.form-control');
        params.msgContent = $('textarea[name="msgContent"]').val();
        if(params.msgContent==''){
         Plugins.Tips({title:'信息提示',icon:'error',content:'消息内容不能空!',timeout:1000});
         return;
         }
      if(params.is_send_template==1){
        if(params.template_title==''){
         Plugins.Tips({title:'信息提示',icon:'error',content:'通知标题不能空!',timeout:1000});
         return;
         }
          if(params.template_first==''){
         Plugins.Tips({title:'信息提示',icon:'error',content:'通知名称不能空!',timeout:1000});
         return;
         }
         if(params.template_second==''){
         Plugins.Tips({title:'信息提示',icon:'error',content:'通知编号不能空!',timeout:1000});
         return;
         }
         if(params.template_third==''){
         Plugins.Tips({title:'信息提示',icon:'error',content:'通知摘要不能空!',timeout:1000});
         return;
         }
       
     }
       Plugins.waitTips({title:'信息提示',content:'正在提交数据，请稍后...'});
         $.post("{:U('Messages/editmessages')}",params,function(data,textStatus){
            var json = WST.toJson(data);
              if(json.status=='1'){
            Plugins.setWaitTipsMsg({ content:'操作成功',timeout:1000,callback:function(){
            location.href='{:U("Messages/index")}';
        }});
      }else{
        Plugins.closeWindow();
        Plugins.Tips({title:'信息提示',icon:'error',content:json.msg||'操作失败',timeout:1000});
           }
        })
 }
      
</script>
</body>
</html>
